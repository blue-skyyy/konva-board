{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/eslint-loader/index.js??ref--13-0!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/components/Item.js","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/components/Item.js","mtime":1599816203767},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/eslint-loader/index.js","mtime":1591241791494}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9Vc2Vycy9oYW9wZWl3ZWkvRG9jdW1lbnRzL2hwdy93ZWItYm9hcmQva29udmEtYm9hcmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMvaGFvcGVpd2VpL0RvY3VtZW50cy9ocHcvd2ViLWJvYXJkL2tvbnZhLWJvYXJkL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCB7IGlzSW1hZ2VWYWlsZCBhcyBfaXNJbWFnZVZhaWxkIH0gZnJvbSAiLi4vdXRpbHMuanMiOyAvLyDmr4/lvKDluKbkv67ppbDlm77niYfkuqfnlJ/kuIDkuKrlrp7kvosKCnZhciBJdGVtID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBJdGVtKG9wdGlvbnMpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJdGVtKTsKCiAgICB0aGlzLnNjYWxlID0gMTsKICAgIHRoaXMuaGlzdG9yeUxpc3QgPSBbXTsKICAgIHRoaXMuaGlzdG9yeUluZGV4ID0gLTE7CiAgICB0aGlzLnVybCA9IG9wdGlvbnMudXJsOwogICAgdGhpcy5jYW52YXMgPSBvcHRpb25zLmNhbnZhczsKICAgIHRoaXMub3JpZ2luU3RhdGUgPSBudWxsOwogICAgdGhpcy5oNSA9IHsKICAgICAgb3JpZ2luU3RhdGU6IG51bGwsCiAgICAgIGNhbnZhczogb3B0aW9ucy5oNWNhbnZhcywKICAgICAgaGlzdG9yeUxpc3Q6IFtdLAogICAgICBoaXN0b3J5SW5kZXg6IC0xCiAgICB9OwogIH0KCiAgX2NyZWF0ZUNsYXNzKEl0ZW0sIFt7CiAgICBrZXk6ICJnZXRIaXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEhpcygpIHsKICAgICAgY29uc29sZS5sb2coImdldEhpcy0tLWxlbmd0aCIsIHRoaXMuaGlzdG9yeUxpc3QubGVuZ3RoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRDdXJyU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEN1cnJTdGF0ZShpbmRleCkgewogICAgICAvLyDlvZPliY3nirbmgIEKICAgICAgaWYgKCF0aGlzLmhpc3RvcnlMaXN0Lmxlbmd0aCkgcmV0dXJuOwogICAgICB2YXIgaGlzdG9yeUxpc3QgPSB0aGlzLmhpc3RvcnlMaXN0OwoKICAgICAgaWYgKGluZGV4IDw9IDApIHsKICAgICAgICAvLyDlt6bovrnnlYwKICAgICAgICB0aGlzLmg1LmNhbnZhcy5wdXRJbWFnZURhdGEodGhpcy5oNS5vcmlnaW5TdGF0ZSwgMCwgMCk7CiAgICAgICAgdGhpcy5oaXN0b3J5TGlzdCA9IFtdOwogICAgICAgIHJldHVybiB0aGlzLm9yaWdpblN0YXRlOwogICAgICB9CgogICAgICB0aGlzLmhpc3RvcnlMaXN0ID0gdGhpcy5oaXN0b3J5TGlzdC5zbGljZSgwLCBpbmRleCArIDEpOwogICAgICB2YXIgZGF0YSA9IGhpc3RvcnlMaXN0W2luZGV4XS5kYXRhOwoKICAgICAgaWYgKGhpc3RvcnlMaXN0W2luZGV4XS50eXBlID09PSAiaDUiKSB7CiAgICAgICAgLy8g5Y6f55SfCiAgICAgICAgLy8gY29uc29sZS5sb2coImRhdGEiLCBkYXRhKTsKICAgICAgICB0aGlzLmg1LmNhbnZhcy5wdXRJbWFnZURhdGEoZGF0YSwgMCwgMCk7IC8vIHRoaXMuaDUuY2FudmFzLnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwogICAgICAgIC8vIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBmYWJpcmMKICAgICAgICByZXR1cm4gaGlzdG9yeUxpc3RbaW5kZXhdLmRhdGE7CiAgICAgIH0gLy8gdGhpcwoKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZmluZEhpc3RvcnkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9maW5kSGlzdG9yeSgpIHsKICAgICAgLy8gaDUgZiBmIGg1CiAgICAgIC8vIOWbnumAgOeahOaVsOaNruWNs+WwseaYr+ebuOWQjHR5cGXlt6bovrnot53mnIDov5FkYXRhCiAgICAgIC8vIOayoeacieWOhuWPsuiusOW9leWNs+S4uuWIneWni+eKtuaAgQogICAgICBpZiAodGhpcy5oaXN0b3J5TGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gW3sKICAgICAgICAgIHR5cGU6ICJoNSIsCiAgICAgICAgICBkYXRhOiB0aGlzLmg1Lm9yaWdpblN0YXRlCiAgICAgICAgfSwgewogICAgICAgICAgdHlwZTogImZhYnJpYyIsCiAgICAgICAgICBkYXRhOiB0aGlzLm9yaWdpblN0YXRlCiAgICAgICAgfV07CiAgICAgIH0KCiAgICAgIHZhciBoaXN0b3J5TGlzdCA9IHRoaXMuaGlzdG9yeUxpc3Q7CiAgICAgIHZhciBsZW5ndGggPSB0aGlzLmhpc3RvcnlMaXN0Lmxlbmd0aCAtIDE7CiAgICAgIGNvbnNvbGUubG9nKCJ0eXBlIiwgInRoaXMuaGlzdG9yeUxpc3QiLCB0aGlzLmhpc3RvcnlMaXN0KTsKICAgICAgdmFyIHR5cGUgPSB0aGlzLmhpc3RvcnlMaXN0W2xlbmd0aF0udHlwZTsKICAgICAgdmFyIGxpc3QgPSBbXS5jb25jYXQodGhpcy5oaXN0b3J5TGlzdCkucmV2ZXJzZSgpLnNsaWNlKDEpOwogICAgICB2YXIgaGlzdG9yeSA9IG51bGw7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobGlzdFtpXS50eXBlID09PSB0eXBlKSB7CiAgICAgICAgICBoaXN0b3J5ID0gbGlzdFtpXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSAvLyDkuLTnlYznirbmgIEg6L+U5Zue5Yid5aeL54q25oCBCgoKICAgICAgaWYgKCFoaXN0b3J5KSB7CiAgICAgICAgaGlzdG9yeSA9IHR5cGUgPT09ICJmYWJyaWMiID8gewogICAgICAgICAgdHlwZTogImZhYnJpYyIsCiAgICAgICAgICBkYXRhOiB0aGlzLm9yaWdpblN0YXRlCiAgICAgICAgfSA6IHsKICAgICAgICAgIHR5cGU6ICJoNSIsCiAgICAgICAgICBkYXRhOiB0aGlzLmg1Lm9yaWdpblN0YXRlCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgdGhpcy5oaXN0b3J5TGlzdCA9IGhpc3RvcnlMaXN0LnNsaWNlKDAsIGxlbmd0aCk7CiAgICAgIGNvbnNvbGUubG9nKCJfX19fX2ZpbmRIaXN0b3J5IiwgdGhpcy5oaXN0b3J5TGlzdCk7CiAgICAgIHJldHVybiBoaXN0b3J5OwogICAgfQogIH0sIHsKICAgIGtleTogImdldFByZUhpc3RvcnkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFByZUhpc3RvcnkoKSB7CiAgICAgIHZhciBoaXN0b3J5ID0gdGhpcy5fZmluZEhpc3RvcnkoKTsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KGhpc3RvcnkpKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBoaXN0b3J5SW5kZXggPSB0aGlzLmhpc3RvcnlJbmRleCAtIDE7CiAgICAgIHRoaXMuaGlzdG9yeUluZGV4ID0gaGlzdG9yeUluZGV4OwogICAgICBjb25zb2xlLmxvZygiZ2V0UHJlSGlzdG9yeS0tYWZ0ZXIiLCB0aGlzLmhpc3RvcnlJbmRleCk7CiAgICAgIHJldHVybiBoaXN0b3J5OwogICAgfQogIH0sIHsKICAgIGtleTogImlzSW1hZ2VWYWlsZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNJbWFnZVZhaWxkKCkgewogICAgICByZXR1cm4gX2lzSW1hZ2VWYWlsZCh0aGlzLnVybCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3Vyckl0ZW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGN1cnJJdGVtKCkge30KICB9LCB7CiAgICBrZXk6ICJnZXRDdXJyU3RhdGVJbmRleCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q3VyclN0YXRlSW5kZXgoKSB7CiAgICAgIHJldHVybiB0aGlzLmhpc3RvcnlJbmRleDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzYXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlKHR5cGUsIGRhdGEpIHsKICAgICAgdmFyIGZsYWcgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwogICAgICBjb25zb2xlLmxvZygiLS0taXRlbS0tLXNhdmUtLS0iKTsKCiAgICAgIGlmIChmbGFnID09PSAiaW5pdCIpIHsKICAgICAgICBpZiAodHlwZSA9PT0gImg1IikgewogICAgICAgICAgdGhpcy5oNS5vcmlnaW5TdGF0ZSA9IGRhdGE7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAiZmFicmljIikgewogICAgICAgICAgdGhpcy5vcmlnaW5TdGF0ZSA9IGRhdGE7CiAgICAgICAgfSAvLyB0aGlzLmhpc3RvcnlMaXN0LnB1c2goe2g1OiB7ZGF0YTogfX0pCgogICAgICB9CgogICAgICBpZiAoIWZsYWcpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZygiLS0taXRlbS0tLXNhdmUtLS1iYmJiYiIpOwogICAgICAgIGlmICh0aGlzLmhpc3RvcnlMaXN0Lmxlbmd0aCkgewogICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KGRhdGEpID09PSBKU09OLnN0cmluZ2lmeSh0aGlzLmhpc3RvcnlMaXN0W3RoaXMuaGlzdG9yeUxpc3QubGVuZ3RoIC0gMV0uZGF0YSkpIHsKICAgICAgICAgICAgLy8g54q25oCB55u4562J5LiN5L+d5a2YCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIOiusOW9leS/ruaUueWOhuWPsgogICAgICAgIC8vIOacquiAg+iZkeS/neWtmOWOhuWPsuiusOW9leaVsOmHj+i/h+Wkp+eahOaDheWGtQoKCiAgICAgICAgdmFyIGhpc3RvcnlMaXN0ID0gdGhpcy5oaXN0b3J5TGlzdDsKICAgICAgICB2YXIgaGlzdG9yeUluZGV4ID0gdGhpcy5oaXN0b3J5SW5kZXg7CiAgICAgICAgY29uc29sZS5sb2coInR5cGUiLCB0eXBlLCAic2F2ZS0tLWJlZm9yZSIsIHRoaXMuaGlzdG9yeUluZGV4LCAibGVuZ3RoIiwgdGhpcy5oaXN0b3J5TGlzdC5sZW5ndGgpOyAvLyDoi6Xku47ljoblj7LorrDlvZXkuK3nmoTpnZ7nu4jngrnlvIDlp4vov5vooYzkuobkv67mlLkKICAgICAgICAvLyDliJnpnIDopoHnp7vpmaTkuYvlkI7nmoTljoblj7LorrDlvZXvvIzlubblsIblvZPliY3kvZzkuLrmlrDnmoTnu4jngrkKICAgICAgICAvLyAh5rOo5oSP77yM5Y2z5L2/6ZKI5a+55b2T5YmN5Y6G5Y+y6K6w5b2V5rKh5pyJ5L+u5pS577yM5Lmf5Lya6L+b6KGM5L+d5a2Y77yM5bm25oq55o6J5LmL5ZCO55qE5Y6G5Y+y6K6w5b2VCgogICAgICAgIGlmIChoaXN0b3J5SW5kZXggPCBoaXN0b3J5TGlzdC5sZW5ndGggLSAxKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygieWVzIik7CiAgICAgICAgICBoaXN0b3J5TGlzdCA9IGhpc3RvcnlMaXN0LnNsaWNlKDAsIGhpc3RvcnlJbmRleCArIDEpOwogICAgICAgIH0KCiAgICAgICAgaGlzdG9yeUxpc3QucHVzaCh7CiAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgdHlwZTogdHlwZQogICAgICAgIH0pOwogICAgICAgIGhpc3RvcnlJbmRleCArPSAxOwogICAgICAgIHRoaXMuaGlzdG9yeUxpc3QgPSBoaXN0b3J5TGlzdDsKICAgICAgICB0aGlzLmhpc3RvcnlJbmRleCA9IGhpc3RvcnlJbmRleDsKICAgICAgfSAvLyAidGhpcy5oaXN0b3J5TGlzdCIsCiAgICAgIC8vIHRoaXMuaGlzdG9yeUxpc3QKCgogICAgICBjb25zb2xlLmxvZygic2F2ZS0tLS1hZnRlciIsIHRoaXMuaGlzdG9yeUluZGV4LCAibGVuZ3RoIiwgdGhpcy5oaXN0b3J5TGlzdC5sZW5ndGgpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldGg1U3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldGg1U3RhdGUoZmxhZykgewogICAgICBpZiAoIXRoaXMuaDUuaGlzdG9yeUxpc3QubGVuZ3RoKSByZXR1cm47CiAgICAgIHZhciBpbWFnZURhdGE7CgogICAgICBpZiAoZmxhZyA9PT0gInVuZG8iICYmIHRoaXMuaDUuaGlzdG9yeUluZGV4ID4gMCkgewogICAgICAgIC8vIOWbnumAgAogICAgICAgIGltYWdlRGF0YSA9IHRoaXMuaDUuaGlzdG9yeUxpc3RbdGhpcy5oNS5oaXN0b3J5SW5kZXggLSAxXTsKICAgICAgICB0aGlzLmg1LmNhbnZhcy5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsKICAgICAgICB0aGlzLmg1Lmhpc3RvcnlJbmRleCAtPSAxOyAvLyDlp4vnu4jkv53lrZjmnIDljp/lp4vorrDlvZUKCiAgICAgICAgdGhpcy5oNS5oaXN0b3J5TGlzdCA9IHRoaXMuaDUuaGlzdG9yeUxpc3Quc2xpY2UoMCwgdGhpcy5oNS5oaXN0b3J5SW5kZXggPT09IDAgPyAxIDogdGhpcy5oNS5oaXN0b3J5SW5kZXgpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiaDV1bmRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoNXVuZG8oKSB7CiAgICAgIGlmICghdGhpcy5oNS5oc3RvcnlMaXN0Lmxlbmd0aCkgcmV0dXJuOwogICAgICB2YXIgaW1hZ2VEYXRhID0gdGhpcy5oNS5oaXN0b3J5TGlzdFt0aGlzLmg1Lmhpc3RvcnlJbmRleCAtIDFdOwogICAgICB0aGlzLmN0eC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsKICAgICAgdGhpcy5oNS5oaXN0b3J5SW5kZXggLT0gMTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJoNWV4cHJvdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaDVleHByb3QoKSB7CiAgICAgIHJldHVybiB0aGlzLmg1LmNhbnZhcy5leHBvcnQoKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBJdGVtOwp9KCk7CgpleHBvcnQgeyBJdGVtIGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/components/Item.js"],"names":["isImageVaild","Item","options","scale","historyList","historyIndex","url","canvas","originState","h5","h5canvas","console","log","length","index","putImageData","slice","data","type","list","concat","reverse","history","i","_findHistory","Array","isArray","flag","JSON","stringify","push","imageData","hstoryList","ctx","export"],"mappings":"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","sourcesContent":["import { isImageVaild } from \"../utils.js\";\n// 每张带修饰图片产生一个实例\nexport default class Item {\n  constructor(options) {\n    this.scale = 1;\n    this.historyList = [];\n    this.historyIndex = -1;\n    this.url = options.url;\n    this.canvas = options.canvas;\n    this.originState = null;\n    this.h5 = {\n      originState: null,\n      canvas: options.h5canvas,\n      historyList: [],\n      historyIndex: -1\n    };\n  }\n  getHis() {\n    console.log(\"getHis---length\", this.historyList.length);\n  }\n\n  getCurrState(index) {\n    // 当前状态\n    if (!this.historyList.length) return;\n\n    let historyList = this.historyList;\n    if (index <= 0) {\n      // 左边界\n      this.h5.canvas.putImageData(this.h5.originState, 0, 0);\n      this.historyList = [];\n      return this.originState;\n    }\n    this.historyList = this.historyList.slice(0, index + 1);\n    let data = historyList[index].data;\n    if (historyList[index].type === \"h5\") {\n      // 原生\n      // console.log(\"data\", data);\n      this.h5.canvas.putImageData(data, 0, 0);\n      // this.h5.canvas.putImageData(imageData, 0, 0);\n      // return;\n    } else {\n      // fabirc\n      return historyList[index].data;\n    }\n    // this\n  }\n  _findHistory() {\n    // h5 f f h5\n    // 回退的数据即就是相同type左边距最近data\n\n    // 没有历史记录即为初始状态\n    if (this.historyList.length === 0) {\n      return [\n        { type: \"h5\", data: this.h5.originState },\n        { type: \"fabric\", data: this.originState }\n      ];\n    }\n    let historyList = this.historyList;\n    let length = this.historyList.length - 1;\n    console.log(\"type\", \"this.historyList\", this.historyList);\n    let type = this.historyList[length].type;\n    let list = []\n      .concat(this.historyList)\n      .reverse()\n      .slice(1);\n    let history = null;\n    for (let i = 0; i < list.length; i++) {\n      if (list[i].type === type) {\n        history = list[i];\n        break;\n      }\n    }\n    // 临界状态 返回初始状态\n    if (!history) {\n      history =\n        type === \"fabric\"\n          ? { type: \"fabric\", data: this.originState }\n          : { type: \"h5\", data: this.h5.originState };\n    }\n    this.historyList = historyList.slice(0, length);\n    console.log(\"_____findHistory\", this.historyList);\n    return history;\n  }\n  getPreHistory() {\n    let history = this._findHistory();\n    if (Array.isArray(history)) {\n      return null;\n    }\n    let historyIndex = this.historyIndex - 1;\n    this.historyIndex = historyIndex;\n    console.log(\"getPreHistory--after\", this.historyIndex);\n    return history;\n  }\n\n  isImageVaild() {\n    return isImageVaild(this.url);\n  }\n  currItem() {}\n  getCurrStateIndex() {\n    return this.historyIndex;\n  }\n  save(type, data, flag = false) {\n    console.log(\"---item---save---\");\n    if (flag === \"init\") {\n      if (type === \"h5\") {\n        this.h5.originState = data;\n      } else if (type === \"fabric\") {\n        this.originState = data;\n      }\n\n      // this.historyList.push({h5: {data: }})\n    }\n    if (!flag) {\n      // console.log(\"---item---save---bbbbb\");\n      if (this.historyList.length) {\n        if (\n          JSON.stringify(data) ===\n          JSON.stringify(this.historyList[this.historyList.length - 1].data)\n        ) {\n          // 状态相等不保存\n          return;\n        }\n      }\n      // 记录修改历史\n      // 未考虑保存历史记录数量过大的情况\n      let historyList = this.historyList;\n      let historyIndex = this.historyIndex;\n      console.log(\n        \"type\",\n        type,\n        \"save---before\",\n        this.historyIndex,\n        \"length\",\n        this.historyList.length\n      );\n      // 若从历史记录中的非终点开始进行了修改\n      // 则需要移除之后的历史记录，并将当前作为新的终点\n      // !注意，即使针对当前历史记录没有修改，也会进行保存，并抹掉之后的历史记录\n      if (historyIndex < historyList.length - 1) {\n        console.log(\"yes\");\n        historyList = historyList.slice(0, historyIndex + 1);\n      }\n\n      historyList.push({ data, type });\n\n      historyIndex += 1;\n      this.historyList = historyList;\n\n      this.historyIndex = historyIndex;\n    }\n    // \"this.historyList\",\n    // this.historyList\n    console.log(\n      \"save----after\",\n      this.historyIndex,\n      \"length\",\n      this.historyList.length\n    );\n  }\n\n  geth5State(flag) {\n    if (!this.h5.historyList.length) return;\n    let imageData;\n    if (flag === \"undo\" && this.h5.historyIndex > 0) {\n      // 回退\n      imageData = this.h5.historyList[this.h5.historyIndex - 1];\n      this.h5.canvas.putImageData(imageData, 0, 0);\n      this.h5.historyIndex -= 1;\n      // 始终保存最原始记录\n      this.h5.historyList = this.h5.historyList.slice(\n        0,\n        this.h5.historyIndex === 0 ? 1 : this.h5.historyIndex\n      );\n    }\n  }\n  h5undo() {\n    if (!this.h5.hstoryList.length) return;\n    let imageData = this.h5.historyList[this.h5.historyIndex - 1];\n    this.ctx.putImageData(imageData, 0, 0);\n    this.h5.historyIndex -= 1;\n  }\n  h5exprot() {\n    return this.h5.canvas.export();\n  }\n}\n"]}]}