{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/eslint-loader/index.js??ref--13-0!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/Item.js","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/Item.js","mtime":1612432466658},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/eslint-loader/index.js","mtime":1591241791494}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMvaGFvcGVpd2VpL0RvY3VtZW50cy9ocHcvd2ViLWJvYXJkL2tvbnZhLWJvYXJkL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL1VzZXJzL2hhb3BlaXdlaS9Eb2N1bWVudHMvaHB3L3dlYi1ib2FyZC9rb252YS1ib2FyZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwoKLyoKICog5Y2V5byg5Zu+54mH5omA5Luj6KGo55qE57G7CiAqLwovLyBpbXBvcnQgaW52YWxpZEltZ1VybCBmcm9tICIuL2ltYWdlLWludmFsaWQiOwppbXBvcnQgeyBzY2FsZVdIIH0gZnJvbSAiLi91dGlsLmpzIjsgLy8gaW1wb3J0IHsgY2JydCB9IGZyb20gImNvcmUtanMvZm4vbnVtYmVyIjsKCnZhciBJdGVtID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBJdGVtKG9wdGlvbnMsIGNiKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJdGVtKTsKCiAgICAvLyDorr7nva7pu5jorqTlsZ7mgKcKICAgIHRoaXMuc2NhbGUgPSAxOwogICAgdGhpcy5zaXplUmF0aW8gPSAxOwogICAgdGhpcy5oaXN0b3J5TGlzdCA9IFtdOwogICAgdGhpcy5oaXN0b3J5SW5kZXggPSAtMTsKICAgIHRoaXMuaW1hZ2VJbmZvID0ge307CiAgICB0aGlzLm9yaWdpblVybCA9IG9wdGlvbnMudXJsOwogICAgdGhpcy51cmwgPSBvcHRpb25zLnVybDsKICAgIHRoaXMuaW52YWxpZCA9IGZhbHNlOwogICAgdGhpcy5yb3RhdGUgPSAwOwogICAgdGhpcy5zY2FsZVdIID0gZmFsc2U7CiAgICB0aGlzLmNhbnZhcyA9IG9wdGlvbnMuY2FudmFzOwogICAgdGhpcy56b29tID0gMTsKICAgIHRoaXMuY29uV0ggPSBvcHRpb25zLmNvbldIOwogICAgdGhpcy5iZ0ltZyA9IG9wdGlvbnMuYmdJbWc7CiAgICB0aGlzLnNjYWxlWCA9IDE7CiAgICB0aGlzLnNjYWxlWSA9IDE7IC8vIOiOt+WPluWbvueJh3NpemXvvIzlkIzml7bmo4DmtYvlm77niYfmmK/lkKblkIjms5UKICAgIC8vIFRPRE8g6ICD6JmR5pS55Li65byC5q2l5omn6KGMCiAgICAvLyB0aGlzLl9nZXRJbWFnZVNpemUoKGVycikgPT4gewogICAgLy8gICBpZiAoZXJyKSB7CiAgICAvLyAgICAgdGhpcy5pbnZhbGlkID0gdHJ1ZTsKICAgIC8vICAgICB0aGlzLnVybCA9ICJoZGFzZGEiOwogICAgLy8gICB9CiAgICAvLyAgIGNiKGVycik7CiAgICAvLyB9KTsKCiAgICB0aGlzLl9nZXRJbWFnZUluZm8oKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgLy8gZG8gc29tZWh0aW5nCiAgICAgIGNiKCk7CiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgIGNvbnNvbGUubG9nKCJlcnIiLCBlcnIpOyAvLyDkuIvovb3lpLHotKUg55So5bGV5L2N5Zu+CgogICAgICBfdGhpcy5pbnZhbGlkID0gdHJ1ZTsKICAgIH0pOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEl0ZW0sIFt7CiAgICBrZXk6ICJzYXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlKGhpc3RvcnkpIHsKICAgICAgLy8gY29uc29sZS5sb2coImhpc3RvcnkiLCBoaXN0b3J5KQogICAgICAvLyBjb25zb2xlLmxvZygic2F2ZS0tLS0tLS1oaXN0b3J5IiwgaGlzdG9yeSk7CiAgICAgIHZhciBqc29uU3RhdGUgPSBKU09OLnN0cmluZ2lmeShoaXN0b3J5KTsgLy8g5rKh5pyJ6L+b6KGM5Lu75L2V5L+u5pS577yM5YiZ5LiN5Lqn55Sf5paw55qE5Y6G5Y+y6K6w5b2VCgogICAgICB2YXIgbGFzdFN0YXRlID0gdGhpcy5nZXRMYXN0U3RhdGUoKTsKCiAgICAgIGlmIChqc29uU3RhdGUgPT09IGxhc3RTdGF0ZSkgewogICAgICAgIGNvbnNvbGUud2Fybigibm8gY2hhbmdlLCByZXR1cm4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8g5L+d5a2Y5pyA5paw55qE5Zu+54mHCiAgICAgIC8vIHRoaXMudXJsID0gbmV3VXJsOwogICAgICAvLyDorrDlvZXkv67mlLnljoblj7IKCgogICAgICB2YXIgaGlzdG9yeUxpc3QgPSB0aGlzLmhpc3RvcnlMaXN0OwogICAgICB2YXIgaGlzdG9yeUluZGV4ID0gdGhpcy5oaXN0b3J5SW5kZXg7IC8vIOiLpeS7juWOhuWPsuiusOW9leS4reeahOmdnue7iOeCueW8gOWni+i/m+ihjOS6huS/ruaUue+8jAogICAgICAvLyDliJnpnIDopoHnp7vpmaTkuYvlkI7nmoTljoblj7LorrDlvZXvvIzlubblsIblvZPliY3kvZzkuLrmlrDnmoTnu4jngrkKICAgICAgLy8gIeazqOaEj++8jOWNs+S9v+mSiOWvueW9k+WJjeWOhuWPsuiusOW9leayoeacieS/ruaUue+8jOS5n+S8mui/m+ihjOS/neWtmO+8jOW5tuaKueaOieS5i+WQjueahOWOhuWPsuiusOW9lQoKICAgICAgaWYgKGhpc3RvcnlJbmRleCA8IGhpc3RvcnlMaXN0Lmxlbmd0aCAtIDEpIHsKICAgICAgICBoaXN0b3J5TGlzdCA9IGhpc3RvcnlMaXN0LnNsaWNlKDAsIGhpc3RvcnlJbmRleCArIDEpOwogICAgICB9CgogICAgICBoaXN0b3J5TGlzdC5wdXNoKGpzb25TdGF0ZSk7CiAgICAgIGhpc3RvcnlJbmRleCArPSAxOwogICAgICB0aGlzLmhpc3RvcnlMaXN0ID0gaGlzdG9yeUxpc3Q7CiAgICAgIHRoaXMuaGlzdG9yeUluZGV4ID0gaGlzdG9yeUluZGV4OwogICAgfQogIH0sIHsKICAgIGtleTogImNsZWFySGlzdG9yeWxpc3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNsZWFySGlzdG9yeWxpc3QoKSB7CiAgICAgIHRoaXMuaGlzdG9yeUxpc3QgPSBbXTsKICAgICAgdGhpcy5oaXN0b3J5SW5kZXggPSAtMTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJleHBvcnRJbWFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZXhwb3J0SW1hZ2UoKSB7CiAgICAgIC8vIOWbvueJh+aXoOaViO+8jOaIluWbvueJh+acquS9nOS7u+S9leS/ruaUueeahOaDheWGteS4i++8jOi/lOWbnuWOn+Wni3VybAogICAgICByZXR1cm4gdGhpcy5pbnZhbGlkIHx8IHRoaXMuaGlzdG9yeUxpc3QubGVuZ3RoIDw9IDEgPyB0aGlzLm9yaWdVcmwgOiB0aGlzLnVybDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXNldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzZXQoKSB7CiAgICAgIHRoaXMudXJsID0gdGhpcy5vcmlnVXJsOwogICAgICB0aGlzLmhpc3RvcnlMaXN0ID0gdGhpcy5oaXN0b3J5TGlzdC5zbGljZSgwLCAxKTsKICAgICAgdGhpcy5oaXN0b3J5SW5kZXggPSAwOwogICAgfQogIH0sIHsKICAgIGtleTogImdldE9yaWdpblN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRPcmlnaW5TdGF0ZSgpIHsKICAgICAgdmFyIHN0YXRlID0gdGhpcy5oaXN0b3J5TGlzdFswXTsKICAgICAgdGhpcy5oaXN0b3J5SW5kZXggPSAwOwogICAgICByZXR1cm4gc3RhdGU7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TGFzdFN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMYXN0U3RhdGUoKSB7CiAgICAgIHJldHVybiB0aGlzLmhpc3RvcnlMaXN0W3RoaXMuaGlzdG9yeUxpc3QubGVuZ3RoIC0gMV07CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0UHJlSGlzdG9yeSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UHJlSGlzdG9yeSgpIHsKICAgICAgdmFyIGhpc3RvcnlJbmRleCA9IHRoaXMuaGlzdG9yeUluZGV4IC0gMTsKCiAgICAgIGlmIChoaXN0b3J5SW5kZXggPCAwKSB7CiAgICAgICAgY29uc29sZS5sb2coImhpc3RvcnkgaW5kZXggb3V0IG9mIHJhbmdlIik7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBoaXN0b3J5ID0gdGhpcy5oaXN0b3J5TGlzdFtoaXN0b3J5SW5kZXhdOwoKICAgICAgaWYgKCFoaXN0b3J5KSB7CiAgICAgICAgY29uc29sZS5sb2coIm5vIGhpc3RvcnkiKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdGhpcy5oaXN0b3J5SW5kZXggPSBoaXN0b3J5SW5kZXg7CiAgICAgIHJldHVybiBoaXN0b3J5OwogICAgfQogIH0sIHsKICAgIGtleTogImdldE5leHRIaXN0b3J5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXROZXh0SGlzdG9yeSgpIHsKICAgICAgdmFyIGhpc3RvcnlJbmRleCA9IHRoaXMuaGlzdG9yeUluZGV4ICsgMTsKCiAgICAgIGlmIChoaXN0b3J5SW5kZXggPj0gdGhpcy5oaXN0b3J5TGlzdC5sZW5ndGgpIHsKICAgICAgICBjb25zb2xlLmxvZygiaGlzdG9yeSBpbmRleCBvdXQgb2YgcmFuZ2UiKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIGhpc3RvcnkgPSB0aGlzLmhpc3RvcnlMaXN0W2hpc3RvcnlJbmRleF07CgogICAgICBpZiAoIWhpc3RvcnkpIHsKICAgICAgICBjb25zb2xlLmxvZygibm8gaGlzdG9yeSIpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB0aGlzLmhpc3RvcnlJbmRleCA9IGhpc3RvcnlJbmRleDsKICAgICAgcmV0dXJuIGhpc3Rvcnk7CiAgICB9CiAgfSwgewogICAga2V5OiAicm90YXRlVG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvdGF0ZVRvKGRpcmVjdGlvbikgewogICAgICBjb25zb2xlLmxvZygiLS0tIiwgdGhpcyk7CiAgICAgIHZhciByb3RhdGUgPSB0aGlzLnJvdGF0ZTsKICAgICAgdmFyIGRpZmYgPSBkaXJlY3Rpb24gPT09ICJsZWZ0IiA/IC05MCA6IDkwOwogICAgICByb3RhdGUgKz0gZGlmZjsKICAgICAgaWYgKHJvdGF0ZSA+PSAzNjApIHJvdGF0ZSA9IDA7CiAgICAgIGlmIChyb3RhdGUgPD0gLTM2MCkgcm90YXRlID0gMDsKICAgICAgdGhpcy5yb3RhdGUgPSByb3RhdGU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Wm9vbU1vZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFpvb21Nb2RlKG1vZGUpIHsKICAgICAgdGhpcy56b29tTW9kZSA9IG1vZGU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Um90YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRSb3RhdGUocm90YXRlKSB7CiAgICAgIHRoaXMucm90YXRlID0gcm90YXRlOwogICAgfQogIH0sIHsKICAgIGtleTogIl9nZXRJbWFnZUluZm8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRJbWFnZUluZm8oKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7IC8vIGltZy5jcm9zc09yaWdpbiA9ICJBbm9ueW1vdXMiOwoKICAgICAgICBpbWcuc3JjID0gX3RoaXMyLnVybDsKCiAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBjb25XSCA9IF90aGlzMi5jb25XSDsKCiAgICAgICAgICB2YXIgX3NjYWxlV0ggPSBzY2FsZVdIKGltZy53aWR0aCwgaW1nLmhlaWdodCwgY29uV0gud2lkdGgsIGNvbldILmhlaWdodCksCiAgICAgICAgICAgICAgd2lkdGggPSBfc2NhbGVXSC53aWR0aCwKICAgICAgICAgICAgICBoZWlnaHQgPSBfc2NhbGVXSC5oZWlnaHQ7IC8vIOe8qeaUvueahOWuvemrmAoKCiAgICAgICAgICB2YXIgc2NhbGVYID0gTnVtYmVyKHdpZHRoIC8gaW1nLndpZHRoKTsKICAgICAgICAgIHZhciBzY2FsZVkgPSBOdW1iZXIoaGVpZ2h0IC8gaW1nLmhlaWdodCk7CiAgICAgICAgICBfdGhpczIuc2NhbGVYID0gc2NhbGVYOwogICAgICAgICAgX3RoaXMyLnNjYWxlWSA9IHNjYWxlWTsKICAgICAgICAgIF90aGlzMi5pbWFnZUluZm8gPSB7CiAgICAgICAgICAgIG9yaWdpbjogewogICAgICAgICAgICAgIHdpZHRoOiBpbWcud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0OiBpbWcuaGVpZ2h0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNjYWxlOiB7CiAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoLAogICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0CiAgICAgICAgICAgIH0KICAgICAgICAgIH07IC8vIGNvbnNvbGUubG9nKCJ0aGlzLmltYWdlSW5mIiwgdGhpcy5pbWFnZUluZm8pOwogICAgICAgICAgLy8g6buY6K6k5oOF5Ya15LiLIHNjYWxlLndpZHRo44CBc2NhbGUuaGVpZ2h05b+F54S25LiN5aSn5LqO5aSW5bGC5a655Zmo5a696auYCiAgICAgICAgICAvLyDmraTml7blr7nmjaLlrr3pq5jljbPlj68KICAgICAgICAgIC8vIGlmIChzY2FsZS53aWR0aCA8PSBjb25XSC5oZWlnaHQgfHwgc2NhbGUuaGVpZ2h0IDw9IGNvbldILndpZHRoKSB7CiAgICAgICAgICAvLyAgIC8vIHNjYWxlIOWuvemrmOmDveWwj+S6juWuueWZqOWuvemrmOaDheWGtQogICAgICAgICAgLy8gICB0aGlzLmltYWdlSW5mby5zY3JvbGxXSCA9IHsKICAgICAgICAgIC8vICAgICB3aWR0aDogc2NhbGUuaGVpZ2h0LAogICAgICAgICAgLy8gICAgIGhlaWdodDogc2NhbGUud2lkdGgsCiAgICAgICAgICAvLyAgICAgdG9TbWFsbDogMSwKICAgICAgICAgIC8vICAgICB0b0JpZzogMQogICAgICAgICAgLy8gICB9OwogICAgICAgICAgLy8gfQogICAgICAgICAgLy8g5peL6L2s5LmL5ZCOIOWuvemrmOWvueiwgyDkv53or4HkuI3lh7rnjrDmu5rliqjmnaEKICAgICAgICAgIC8vIGlmICh3aWR0aCA+IGgpIHsKICAgICAgICAgIC8vICAgbGV0IHNjcm9sbFdIID0gc2NhbGVXSChoZWlnaHQsIHdpZHRoLCB3LCBoKTsKICAgICAgICAgIC8vICAgdGhpcy5pbWFnZUluZm8uc2Nyb2xsV0ggPSB7CiAgICAgICAgICAvLyAgICAgd2lkdGg6IHNjcm9sbFdILndpZHRoLAogICAgICAgICAgLy8gICAgIGhlaWdodDogc2Nyb2xsV0guaGVpZ2h0LAogICAgICAgICAgLy8gICAgIHRvU21hbGw6IE51bWJlcihzY3JvbGxXSC5oZWlnaHQgLyB3aWR0aCksCiAgICAgICAgICAvLyAgICAgdG9CaWc6IE51bWJlcih3aWR0aCAvIHNjcm9sbFdILmhlaWdodCkKICAgICAgICAgIC8vICAgfTsKICAgICAgICAgIC8vIH0KICAgICAgICAgIC8vIGlmIChoZWlnaHQgPiB3KSB7CiAgICAgICAgICAvLyAgIGxldCBzY3JvbGxXSCA9IHNjYWxlV0god2lkdGgsIGhlaWdodCwgdywgaCk7CiAgICAgICAgICAvLyAgIHRoaXMuaW1hZ2VJbmZvLnNjcm9sbFdIID0gewogICAgICAgICAgLy8gICAgIHdpZHRoOiBzY3JvbGxXSC53aWR0aCwKICAgICAgICAgIC8vICAgICBoZWlnaHQ6IHNjcm9sbFdILmhlaWdodCwKICAgICAgICAgIC8vICAgICB0b1NtYWxsOiBOdW1iZXIoc2Nyb2xsV0gud2lkdGggLyBoZWlnaHQpLAogICAgICAgICAgLy8gICAgIHRvQmlnOiBOdW1iZXIoaGVpZ2h0IC8gc2Nyb2xsV0gud2lkdGgpCiAgICAgICAgICAvLyAgIH07CiAgICAgICAgICAvLyB9CgogICAgICAgICAgcmVzb2x2ZSgib2siKTsKICAgICAgICB9OwoKICAgICAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJJdGVtIGltYWdlIGxvYWQgZXJyb3I6ICAgIiArIGVycik7CiAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICB9OwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRab29tIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRab29tKHpvb20pIHsKICAgICAgdGhpcy56b29tID0gem9vbTsKICAgIH0KICB9XSk7CgogIHJldHVybiBJdGVtOwp9KCk7CgpleHBvcnQgZGVmYXVsdCBJdGVtOw=="},{"version":3,"sources":["/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/Item.js"],"names":["scaleWH","Item","options","cb","scale","sizeRatio","historyList","historyIndex","imageInfo","originUrl","url","invalid","rotate","canvas","zoom","conWH","bgImg","scaleX","scaleY","_getImageInfo","then","catch","err","console","log","history","jsonState","JSON","stringify","lastState","getLastState","warn","length","slice","push","origUrl","state","direction","diff","mode","zoomMode","Promise","resolve","reject","img","Image","src","onload","width","height","Number","origin","onerror"],"mappings":"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","sourcesContent":["/*\n * 单张图片所代表的类\n */\n// import invalidImgUrl from \"./image-invalid\";\nimport { scaleWH } from \"./util.js\";\n// import { cbrt } from \"core-js/fn/number\";\n\nclass Item {\n  constructor(options, cb) {\n    // 设置默认属性\n    this.scale = 1;\n    this.sizeRatio = 1;\n    this.historyList = [];\n    this.historyIndex = -1;\n    this.imageInfo = {};\n    this.originUrl = options.url;\n    this.url = options.url;\n    this.invalid = false;\n    this.rotate = 0;\n    this.scaleWH = false;\n    this.canvas = options.canvas;\n    this.zoom = 1;\n    this.conWH = options.conWH;\n    this.bgImg = options.bgImg;\n    this.scaleX = 1;\n    this.scaleY = 1;\n\n    // 获取图片size，同时检测图片是否合法\n    // TODO 考虑改为异步执行\n    // this._getImageSize((err) => {\n    //   if (err) {\n    //     this.invalid = true;\n    //     this.url = \"hdasda\";\n    //   }\n\n    //   cb(err);\n    // });\n\n    this._getImageInfo()\n      .then(() => {\n        // do somehting\n        cb();\n      })\n      .catch((err) => {\n        console.log(\"err\", err);\n        // 下载失败 用展位图\n        this.invalid = true;\n      });\n  }\n\n  save(history) {\n    // console.log(\"history\", history)\n    // console.log(\"save-------history\", history);\n    let jsonState = JSON.stringify(history);\n\n    // 没有进行任何修改，则不产生新的历史记录\n    let lastState = this.getLastState();\n    if (jsonState === lastState) {\n      console.warn(\"no change, return\");\n      return;\n    }\n\n    // 保存最新的图片\n    // this.url = newUrl;\n\n    // 记录修改历史\n    let historyList = this.historyList;\n    let historyIndex = this.historyIndex;\n\n    // 若从历史记录中的非终点开始进行了修改，\n    // 则需要移除之后的历史记录，并将当前作为新的终点\n    // !注意，即使针对当前历史记录没有修改，也会进行保存，并抹掉之后的历史记录\n    if (historyIndex < historyList.length - 1) {\n      historyList = historyList.slice(0, historyIndex + 1);\n    }\n\n    historyList.push(jsonState);\n    historyIndex += 1;\n    this.historyList = historyList;\n    this.historyIndex = historyIndex;\n  }\n\n  clearHistorylist() {\n    this.historyList = [];\n    this.historyIndex = -1;\n  }\n\n  exportImage() {\n    // 图片无效，或图片未作任何修改的情况下，返回原始url\n    return this.invalid || this.historyList.length <= 1\n      ? this.origUrl\n      : this.url;\n  }\n\n  reset() {\n    this.url = this.origUrl;\n    this.historyList = this.historyList.slice(0, 1);\n    this.historyIndex = 0;\n  }\n\n  getOriginState() {\n    let state = this.historyList[0];\n    this.historyIndex = 0;\n    return state;\n  }\n\n  getLastState() {\n    return this.historyList[this.historyList.length - 1];\n  }\n\n  getPreHistory() {\n    let historyIndex = this.historyIndex - 1;\n    if (historyIndex < 0) {\n      console.log(\"history index out of range\");\n      return null;\n    }\n\n    let history = this.historyList[historyIndex];\n    if (!history) {\n      console.log(\"no history\");\n      return null;\n    }\n\n    this.historyIndex = historyIndex;\n\n    return history;\n  }\n\n  getNextHistory() {\n    let historyIndex = this.historyIndex + 1;\n    if (historyIndex >= this.historyList.length) {\n      console.log(\"history index out of range\");\n      return null;\n    }\n\n    let history = this.historyList[historyIndex];\n    if (!history) {\n      console.log(\"no history\");\n      return null;\n    }\n\n    this.historyIndex = historyIndex;\n    return history;\n  }\n\n  rotateTo(direction) {\n\n    console.log(\"---\", this)\n    let rotate = this.rotate;\n\n    let diff = direction === \"left\" ? -90 : 90;\n    rotate += diff;\n    if (rotate >= 360) rotate = 0;\n    if (rotate <= -360) rotate = 0;\n\n    this.rotate = rotate;\n  }\n\n  setZoomMode(mode) {\n    this.zoomMode = mode;\n  }\n\n  setRotate(rotate) {\n    this.rotate = rotate;\n  }\n\n  _getImageInfo() {\n    return new Promise((resolve, reject) => {\n      let img = new Image();\n      // img.crossOrigin = \"Anonymous\";\n      img.src = this.url;\n      img.onload = () => {\n        const { conWH } = this;\n        const { width, height } = scaleWH(\n          img.width,\n          img.height,\n          conWH.width,\n          conWH.height\n        );\n\n        // 缩放的宽高\n        let scaleX = Number(width / img.width);\n        let scaleY = Number(height / img.height);\n        this.scaleX = scaleX;\n        this.scaleY = scaleY;\n\n        this.imageInfo = {\n          origin: {\n            width: img.width,\n            height: img.height\n          },\n          scale: {\n            width,\n            height\n          }\n        };\n\n        // console.log(\"this.imageInf\", this.imageInfo);\n\n        // 默认情况下 scale.width、scale.height必然不大于外层容器宽高\n        // 此时对换宽高即可\n        // if (scale.width <= conWH.height || scale.height <= conWH.width) {\n        //   // scale 宽高都小于容器宽高情况\n        //   this.imageInfo.scrollWH = {\n        //     width: scale.height,\n        //     height: scale.width,\n        //     toSmall: 1,\n        //     toBig: 1\n        //   };\n        // }\n        // 旋转之后 宽高对调 保证不出现滚动条\n        // if (width > h) {\n        //   let scrollWH = scaleWH(height, width, w, h);\n        //   this.imageInfo.scrollWH = {\n        //     width: scrollWH.width,\n        //     height: scrollWH.height,\n        //     toSmall: Number(scrollWH.height / width),\n        //     toBig: Number(width / scrollWH.height)\n        //   };\n        // }\n        // if (height > w) {\n        //   let scrollWH = scaleWH(width, height, w, h);\n        //   this.imageInfo.scrollWH = {\n        //     width: scrollWH.width,\n        //     height: scrollWH.height,\n        //     toSmall: Number(scrollWH.width / height),\n        //     toBig: Number(height / scrollWH.width)\n        //   };\n        // }\n\n        resolve(\"ok\");\n      };\n      img.onerror = (err) => {\n        console.log(\"Item image load error:   \" + err);\n        reject(err);\n      };\n    });\n  }\n\n  setZoom(zoom) {\n    this.zoom = zoom;\n  }\n}\n\nexport default Item;\n"]}]}