{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/eslint-loader/index.js??ref--13-0!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/Item.js","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/Item.js","mtime":1600766993697},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/eslint-loader/index.js","mtime":1591241791494}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMvaGFvcGVpd2VpL0RvY3VtZW50cy9ocHcvd2ViLWJvYXJkL2tvbnZhLWJvYXJkL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL1VzZXJzL2hhb3BlaXdlaS9Eb2N1bWVudHMvaHB3L3dlYi1ib2FyZC9rb252YS1ib2FyZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwoKLyoKICog5Y2V5byg5Zu+54mH5omA5Luj6KGo55qE57G7CiAqLwovLyBpbXBvcnQgaW52YWxpZEltZ1VybCBmcm9tICIuL2ltYWdlLWludmFsaWQiOwppbXBvcnQgeyBzY2FsZVdIIH0gZnJvbSAiLi91dGlsLmpzIjsgLy8gaW1wb3J0IHsgY2JydCB9IGZyb20gImNvcmUtanMvZm4vbnVtYmVyIjsKCnZhciBJdGVtID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBJdGVtKG9wdGlvbnMsIGNiKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJdGVtKTsKCiAgICAvLyDorr7nva7pu5jorqTlsZ7mgKcKICAgIHRoaXMuc2NhbGUgPSAxOwogICAgdGhpcy5zaXplUmF0aW8gPSAxOwogICAgdGhpcy5oaXN0b3J5TGlzdCA9IFtdOwogICAgdGhpcy5oaXN0b3J5SW5kZXggPSAtMTsKICAgIHRoaXMuaW1hZ2VJbmZvID0ge307CiAgICB0aGlzLm9yaWdpblVybCA9IG9wdGlvbnMudXJsOwogICAgdGhpcy51cmwgPSBvcHRpb25zLnVybDsKICAgIHRoaXMubGFzdFN0YXRlID0gbnVsbDsKICAgIHRoaXMuaW52YWxpZCA9IGZhbHNlOwogICAgdGhpcy5yb3RhdGUgPSAwOwogICAgdGhpcy5zY2FsZVdIID0gZmFsc2U7CiAgICB0aGlzLmNhbnZhcyA9IG9wdGlvbnMuY2FudmFzOwogICAgdGhpcy56b29tID0gMTsKICAgIHRoaXMuY29uV0ggPSBvcHRpb25zLmNvbldIOwogICAgdGhpcy5iZ0ltZyA9IG9wdGlvbnMuYmdJbWc7CiAgICB0aGlzLnNjYWxlWCA9IDE7CiAgICB0aGlzLnNjYWxlWSA9IDE7IC8vIOiOt+WPluWbvueJh3NpemXvvIzlkIzml7bmo4DmtYvlm77niYfmmK/lkKblkIjms5UKICAgIC8vIFRPRE8g6ICD6JmR5pS55Li65byC5q2l5omn6KGMCiAgICAvLyB0aGlzLl9nZXRJbWFnZVNpemUoKGVycikgPT4gewogICAgLy8gICBpZiAoZXJyKSB7CiAgICAvLyAgICAgdGhpcy5pbnZhbGlkID0gdHJ1ZTsKICAgIC8vICAgICB0aGlzLnVybCA9ICJoZGFzZGEiOwogICAgLy8gICB9CiAgICAvLyAgIGNiKGVycik7CiAgICAvLyB9KTsKCiAgICB0aGlzLl9nZXRJbWFnZUluZm8oKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgLy8gZG8gc29tZWh0aW5nCiAgICAgIGNiKCk7CiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgIGNvbnNvbGUubG9nKCJlcnIiLCBlcnIpOyAvLyDkuIvovb3lpLHotKUg55So5bGV5L2N5Zu+CgogICAgICBfdGhpcy5pbnZhbGlkID0gdHJ1ZTsKICAgIH0pOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEl0ZW0sIFt7CiAgICBrZXk6ICJzYXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlKGhpc3RvcnkpIHsKICAgICAgLy8gY29uc29sZS5sb2coInNhdmUtLS0tLS0taGlzdG9yeSIsIGhpc3RvcnkpOwogICAgICB2YXIganNvblN0YXRlID0gSlNPTi5zdHJpbmdpZnkoaGlzdG9yeSk7IC8vIOayoeaciei/m+ihjOS7u+S9leS/ruaUue+8jOWImeS4jeS6p+eUn+aWsOeahOWOhuWPsuiusOW9lQoKICAgICAgaWYgKGpzb25TdGF0ZSA9PT0gdGhpcy5sYXN0U3RhdGUpIHsKICAgICAgICBjb25zb2xlLmxvZygibm8gY2hhbmdlLCByZXR1cm4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8g5L+d5a2Y5pyA5paw55qE5Zu+54mHCiAgICAgIC8vIHRoaXMudXJsID0gbmV3VXJsOwogICAgICAvLyDorrDlvZXkv67mlLnljoblj7IKICAgICAgLy8gVE9ETyDogIPomZHkv53lrZjljoblj7LorrDlvZXmlbDph4/ov4flpKfnmoTmg4XlhrUKCgogICAgICB2YXIgaGlzdG9yeUxpc3QgPSB0aGlzLmhpc3RvcnlMaXN0OwogICAgICB2YXIgaGlzdG9yeUluZGV4ID0gdGhpcy5oaXN0b3J5SW5kZXg7IC8vIOiLpeS7juWOhuWPsuiusOW9leS4reeahOmdnue7iOeCueW8gOWni+i/m+ihjOS6huS/ruaUue+8jAogICAgICAvLyDliJnpnIDopoHnp7vpmaTkuYvlkI7nmoTljoblj7LorrDlvZXvvIzlubblsIblvZPliY3kvZzkuLrmlrDnmoTnu4jngrkKICAgICAgLy8gIeazqOaEj++8jOWNs+S9v+mSiOWvueW9k+WJjeWOhuWPsuiusOW9leayoeacieS/ruaUue+8jOS5n+S8mui/m+ihjOS/neWtmO+8jOW5tuaKueaOieS5i+WQjueahOWOhuWPsuiusOW9lQoKICAgICAgaWYgKGhpc3RvcnlJbmRleCA8IGhpc3RvcnlMaXN0Lmxlbmd0aCAtIDEpIHsKICAgICAgICBoaXN0b3J5TGlzdCA9IGhpc3RvcnlMaXN0LnNsaWNlKDAsIGhpc3RvcnlJbmRleCArIDEpOwogICAgICB9CgogICAgICBoaXN0b3J5TGlzdC5wdXNoKGpzb25TdGF0ZSk7CiAgICAgIGhpc3RvcnlJbmRleCArPSAxOwogICAgICB0aGlzLmxhc3RTdGF0ZSA9IGpzb25TdGF0ZTsKICAgICAgdGhpcy5oaXN0b3J5TGlzdCA9IGhpc3RvcnlMaXN0OwogICAgICB0aGlzLmhpc3RvcnlJbmRleCA9IGhpc3RvcnlJbmRleDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJleHBvcnRJbWFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZXhwb3J0SW1hZ2UoKSB7CiAgICAgIC8vIOWbvueJh+aXoOaViO+8jOaIluWbvueJh+acquS9nOS7u+S9leS/ruaUueeahOaDheWGteS4i++8jOi/lOWbnuWOn+Wni3VybAogICAgICByZXR1cm4gdGhpcy5pbnZhbGlkIHx8IHRoaXMuaGlzdG9yeUxpc3QubGVuZ3RoIDw9IDEgPyB0aGlzLm9yaWdVcmwgOiB0aGlzLnVybDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXNldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzZXQoKSB7CiAgICAgIHRoaXMudXJsID0gdGhpcy5vcmlnVXJsOwogICAgICB0aGlzLmhpc3RvcnlMaXN0ID0gdGhpcy5oaXN0b3J5TGlzdC5zbGljZSgwLCAxKTsKICAgICAgdGhpcy5oaXN0b3J5SW5kZXggPSAwOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEN1cnJTdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q3VyclN0YXRlKCkgewogICAgICByZXR1cm4gdGhpcy5oaXN0b3J5TGlzdFt0aGlzLmhpc3RvcnlJbmRleF07CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0UHJlSGlzdG9yeSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UHJlSGlzdG9yeSgpIHsKICAgICAgdmFyIGhpc3RvcnlJbmRleCA9IHRoaXMuaGlzdG9yeUluZGV4IC0gMTsKCiAgICAgIGlmIChoaXN0b3J5SW5kZXggPCAwKSB7CiAgICAgICAgY29uc29sZS5sb2coImhpc3RvcnkgaW5kZXggb3V0IG9mIHJhbmdlIik7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBoaXN0b3J5ID0gdGhpcy5oaXN0b3J5TGlzdFtoaXN0b3J5SW5kZXhdOwoKICAgICAgaWYgKCFoaXN0b3J5KSB7CiAgICAgICAgY29uc29sZS5sb2coIm5vIGhpc3RvcnkiKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdGhpcy5oaXN0b3J5SW5kZXggPSBoaXN0b3J5SW5kZXg7CiAgICAgIHJldHVybiBoaXN0b3J5OwogICAgfQogIH0sIHsKICAgIGtleTogImdldE5leHRIaXN0b3J5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXROZXh0SGlzdG9yeSgpIHsKICAgICAgdmFyIGhpc3RvcnlJbmRleCA9IHRoaXMuaGlzdG9yeUluZGV4ICsgMTsKCiAgICAgIGlmIChoaXN0b3J5SW5kZXggPj0gdGhpcy5oaXN0b3J5TGlzdC5sZW5ndGgpIHsKICAgICAgICBjb25zb2xlLmxvZygiaGlzdG9yeSBpbmRleCBvdXQgb2YgcmFuZ2UiKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIGhpc3RvcnkgPSB0aGlzLmhpc3RvcnlMaXN0W2hpc3RvcnlJbmRleF07CgogICAgICBpZiAoIWhpc3RvcnkpIHsKICAgICAgICBjb25zb2xlLmxvZygibm8gaGlzdG9yeSIpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB0aGlzLmhpc3RvcnlJbmRleCA9IGhpc3RvcnlJbmRleDsKICAgICAgcmV0dXJuIGhpc3Rvcnk7CiAgICB9CiAgfSwgewogICAga2V5OiAicm90YXRlVG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvdGF0ZVRvKGRpcmVjdGlvbikgewogICAgICB2YXIgcm90YXRlID0gdGhpcy5yb3RhdGU7CiAgICAgIHZhciBkaWZmID0gZGlyZWN0aW9uID09PSAibGVmdCIgPyAtOTAgOiA5MDsKICAgICAgcm90YXRlICs9IGRpZmY7CiAgICAgIGlmIChyb3RhdGUgPj0gMzYwKSByb3RhdGUgPSAwOwogICAgICBpZiAocm90YXRlIDw9IC0zNjApIHJvdGF0ZSA9IDA7CiAgICAgIHRoaXMucm90YXRlID0gcm90YXRlOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFpvb21Nb2RlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRab29tTW9kZShtb2RlKSB7CiAgICAgIHRoaXMuem9vbU1vZGUgPSBtb2RlOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFJvdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Um90YXRlKHJvdGF0ZSkgewogICAgICB0aGlzLnJvdGF0ZSA9IHJvdGF0ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0SW1hZ2VJbmZvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0SW1hZ2VJbmZvKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOyAvLyBpbWcuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsKCiAgICAgICAgaW1nLnNyYyA9IF90aGlzMi51cmw7CgogICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgY29uV0ggPSBfdGhpczIuY29uV0g7CgogICAgICAgICAgdmFyIF9zY2FsZVdIID0gc2NhbGVXSChpbWcud2lkdGgsIGltZy5oZWlnaHQsIGNvbldILndpZHRoLCBjb25XSC5oZWlnaHQpLAogICAgICAgICAgICAgIHdpZHRoID0gX3NjYWxlV0gud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0ID0gX3NjYWxlV0guaGVpZ2h0OyAvLyDnvKnmlL7nmoTlrr3pq5gKCgogICAgICAgICAgdmFyIHNjYWxlWCA9IE51bWJlcih3aWR0aCAvIGltZy53aWR0aCk7CiAgICAgICAgICB2YXIgc2NhbGVZID0gTnVtYmVyKGhlaWdodCAvIGltZy5oZWlnaHQpOwogICAgICAgICAgX3RoaXMyLnNjYWxlWCA9IHNjYWxlWDsKICAgICAgICAgIF90aGlzMi5zY2FsZVkgPSBzY2FsZVk7CiAgICAgICAgICBfdGhpczIuaW1hZ2VJbmZvID0gewogICAgICAgICAgICBvcmlnaW46IHsKICAgICAgICAgICAgICB3aWR0aDogaW1nLndpZHRoLAogICAgICAgICAgICAgIGhlaWdodDogaW1nLmhlaWdodAogICAgICAgICAgICB9LAogICAgICAgICAgICBzY2FsZTogewogICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCwKICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodAogICAgICAgICAgICB9CiAgICAgICAgICB9OyAvLyBjb25zb2xlLmxvZygidGhpcy5pbWFnZUluZiIsIHRoaXMuaW1hZ2VJbmZvKTsKICAgICAgICAgIC8vIOm7mOiupOaDheWGteS4iyBzY2FsZS53aWR0aOOAgXNjYWxlLmhlaWdodOW/heeEtuS4jeWkp+S6juWkluWxguWuueWZqOWuvemrmAogICAgICAgICAgLy8g5q2k5pe25a+55o2i5a696auY5Y2z5Y+vCiAgICAgICAgICAvLyBpZiAoc2NhbGUud2lkdGggPD0gY29uV0guaGVpZ2h0IHx8IHNjYWxlLmhlaWdodCA8PSBjb25XSC53aWR0aCkgewogICAgICAgICAgLy8gICAvLyBzY2FsZSDlrr3pq5jpg73lsI/kuo7lrrnlmajlrr3pq5jmg4XlhrUKICAgICAgICAgIC8vICAgdGhpcy5pbWFnZUluZm8uc2Nyb2xsV0ggPSB7CiAgICAgICAgICAvLyAgICAgd2lkdGg6IHNjYWxlLmhlaWdodCwKICAgICAgICAgIC8vICAgICBoZWlnaHQ6IHNjYWxlLndpZHRoLAogICAgICAgICAgLy8gICAgIHRvU21hbGw6IDEsCiAgICAgICAgICAvLyAgICAgdG9CaWc6IDEKICAgICAgICAgIC8vICAgfTsKICAgICAgICAgIC8vIH0KICAgICAgICAgIC8vIOaXi+i9rOS5i+WQjiDlrr3pq5jlr7nosIMg5L+d6K+B5LiN5Ye6546w5rua5Yqo5p2hCiAgICAgICAgICAvLyBpZiAod2lkdGggPiBoKSB7CiAgICAgICAgICAvLyAgIGxldCBzY3JvbGxXSCA9IHNjYWxlV0goaGVpZ2h0LCB3aWR0aCwgdywgaCk7CiAgICAgICAgICAvLyAgIHRoaXMuaW1hZ2VJbmZvLnNjcm9sbFdIID0gewogICAgICAgICAgLy8gICAgIHdpZHRoOiBzY3JvbGxXSC53aWR0aCwKICAgICAgICAgIC8vICAgICBoZWlnaHQ6IHNjcm9sbFdILmhlaWdodCwKICAgICAgICAgIC8vICAgICB0b1NtYWxsOiBOdW1iZXIoc2Nyb2xsV0guaGVpZ2h0IC8gd2lkdGgpLAogICAgICAgICAgLy8gICAgIHRvQmlnOiBOdW1iZXIod2lkdGggLyBzY3JvbGxXSC5oZWlnaHQpCiAgICAgICAgICAvLyAgIH07CiAgICAgICAgICAvLyB9CiAgICAgICAgICAvLyBpZiAoaGVpZ2h0ID4gdykgewogICAgICAgICAgLy8gICBsZXQgc2Nyb2xsV0ggPSBzY2FsZVdIKHdpZHRoLCBoZWlnaHQsIHcsIGgpOwogICAgICAgICAgLy8gICB0aGlzLmltYWdlSW5mby5zY3JvbGxXSCA9IHsKICAgICAgICAgIC8vICAgICB3aWR0aDogc2Nyb2xsV0gud2lkdGgsCiAgICAgICAgICAvLyAgICAgaGVpZ2h0OiBzY3JvbGxXSC5oZWlnaHQsCiAgICAgICAgICAvLyAgICAgdG9TbWFsbDogTnVtYmVyKHNjcm9sbFdILndpZHRoIC8gaGVpZ2h0KSwKICAgICAgICAgIC8vICAgICB0b0JpZzogTnVtYmVyKGhlaWdodCAvIHNjcm9sbFdILndpZHRoKQogICAgICAgICAgLy8gICB9OwogICAgICAgICAgLy8gfQoKICAgICAgICAgIHJlc29sdmUoIm9rIik7CiAgICAgICAgfTsKCiAgICAgICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiSXRlbSBpbWFnZSBsb2FkIGVycm9yOiAgICIgKyBlcnIpOwogICAgICAgICAgcmVqZWN0KGVycik7CiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Wm9vbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Wm9vbSh6b29tKSB7CiAgICAgIHRoaXMuem9vbSA9IHpvb207CiAgICB9CiAgfV0pOwoKICByZXR1cm4gSXRlbTsKfSgpOwoKZXhwb3J0IGRlZmF1bHQgSXRlbTs="},{"version":3,"sources":["/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/Item.js"],"names":["scaleWH","Item","options","cb","scale","sizeRatio","historyList","historyIndex","imageInfo","originUrl","url","lastState","invalid","rotate","canvas","zoom","conWH","bgImg","scaleX","scaleY","_getImageInfo","then","catch","err","console","log","history","jsonState","JSON","stringify","length","slice","push","origUrl","direction","diff","mode","zoomMode","Promise","resolve","reject","img","Image","src","onload","width","height","Number","origin","onerror"],"mappings":"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","sourcesContent":["/*\n * 单张图片所代表的类\n */\n// import invalidImgUrl from \"./image-invalid\";\nimport { scaleWH } from \"./util.js\";\n// import { cbrt } from \"core-js/fn/number\";\n\nclass Item {\n  constructor(options, cb) {\n    // 设置默认属性\n    this.scale = 1;\n    this.sizeRatio = 1;\n    this.historyList = [];\n    this.historyIndex = -1;\n    this.imageInfo = {};\n    this.originUrl = options.url;\n    this.url = options.url;\n    this.lastState = null;\n    this.invalid = false;\n    this.rotate = 0;\n    this.scaleWH = false;\n    this.canvas = options.canvas;\n    this.zoom = 1;\n    this.conWH = options.conWH;\n    this.bgImg = options.bgImg;\n    this.scaleX = 1;\n    this.scaleY = 1;\n\n    // 获取图片size，同时检测图片是否合法\n    // TODO 考虑改为异步执行\n    // this._getImageSize((err) => {\n    //   if (err) {\n    //     this.invalid = true;\n    //     this.url = \"hdasda\";\n    //   }\n\n    //   cb(err);\n    // });\n\n    this._getImageInfo()\n      .then(() => {\n        // do somehting\n        cb();\n      })\n      .catch((err) => {\n        console.log(\"err\", err);\n        // 下载失败 用展位图\n        this.invalid = true;\n      });\n  }\n\n  save(history) {\n    // console.log(\"save-------history\", history);\n    let jsonState = JSON.stringify(history);\n    // 没有进行任何修改，则不产生新的历史记录\n    if (jsonState === this.lastState) {\n      console.log(\"no change, return\");\n      return;\n    }\n\n    // 保存最新的图片\n    // this.url = newUrl;\n\n    // 记录修改历史\n    // TODO 考虑保存历史记录数量过大的情况\n    let historyList = this.historyList;\n    let historyIndex = this.historyIndex;\n\n    // 若从历史记录中的非终点开始进行了修改，\n    // 则需要移除之后的历史记录，并将当前作为新的终点\n    // !注意，即使针对当前历史记录没有修改，也会进行保存，并抹掉之后的历史记录\n    if (historyIndex < historyList.length - 1) {\n      historyList = historyList.slice(0, historyIndex + 1);\n    }\n\n    historyList.push(jsonState);\n    historyIndex += 1;\n    this.lastState = jsonState;\n    this.historyList = historyList;\n    this.historyIndex = historyIndex;\n  }\n\n  exportImage() {\n    // 图片无效，或图片未作任何修改的情况下，返回原始url\n    return this.invalid || this.historyList.length <= 1\n      ? this.origUrl\n      : this.url;\n  }\n\n  reset() {\n    this.url = this.origUrl;\n    this.historyList = this.historyList.slice(0, 1);\n    this.historyIndex = 0;\n  }\n\n  getCurrState() {\n    return this.historyList[this.historyIndex];\n  }\n\n  getPreHistory() {\n    let historyIndex = this.historyIndex - 1;\n    if (historyIndex < 0) {\n      console.log(\"history index out of range\");\n      return null;\n    }\n\n    let history = this.historyList[historyIndex];\n    if (!history) {\n      console.log(\"no history\");\n      return null;\n    }\n\n    this.historyIndex = historyIndex;\n\n    return history;\n  }\n\n  getNextHistory() {\n    let historyIndex = this.historyIndex + 1;\n    if (historyIndex >= this.historyList.length) {\n      console.log(\"history index out of range\");\n      return null;\n    }\n\n    let history = this.historyList[historyIndex];\n    if (!history) {\n      console.log(\"no history\");\n      return null;\n    }\n\n    this.historyIndex = historyIndex;\n    return history;\n  }\n\n  rotateTo(direction) {\n    let rotate = this.rotate;\n\n    let diff = direction === \"left\" ? -90 : 90;\n    rotate += diff;\n    if (rotate >= 360) rotate = 0;\n    if (rotate <= -360) rotate = 0;\n\n    this.rotate = rotate;\n  }\n\n  setZoomMode(mode) {\n    this.zoomMode = mode;\n  }\n\n  setRotate(rotate) {\n    this.rotate = rotate;\n  }\n\n  _getImageInfo() {\n    return new Promise((resolve, reject) => {\n      let img = new Image();\n      // img.crossOrigin = \"Anonymous\";\n      img.src = this.url;\n      img.onload = () => {\n        const { conWH } = this;\n        const { width, height } = scaleWH(\n          img.width,\n          img.height,\n          conWH.width,\n          conWH.height\n        );\n\n        // 缩放的宽高\n        let scaleX = Number(width / img.width);\n        let scaleY = Number(height / img.height);\n        this.scaleX = scaleX;\n        this.scaleY = scaleY;\n\n        this.imageInfo = {\n          origin: {\n            width: img.width,\n            height: img.height\n          },\n          scale: {\n            width,\n            height\n          }\n        };\n\n        // console.log(\"this.imageInf\", this.imageInfo);\n\n        // 默认情况下 scale.width、scale.height必然不大于外层容器宽高\n        // 此时对换宽高即可\n        // if (scale.width <= conWH.height || scale.height <= conWH.width) {\n        //   // scale 宽高都小于容器宽高情况\n        //   this.imageInfo.scrollWH = {\n        //     width: scale.height,\n        //     height: scale.width,\n        //     toSmall: 1,\n        //     toBig: 1\n        //   };\n        // }\n        // 旋转之后 宽高对调 保证不出现滚动条\n        // if (width > h) {\n        //   let scrollWH = scaleWH(height, width, w, h);\n        //   this.imageInfo.scrollWH = {\n        //     width: scrollWH.width,\n        //     height: scrollWH.height,\n        //     toSmall: Number(scrollWH.height / width),\n        //     toBig: Number(width / scrollWH.height)\n        //   };\n        // }\n        // if (height > w) {\n        //   let scrollWH = scaleWH(width, height, w, h);\n        //   this.imageInfo.scrollWH = {\n        //     width: scrollWH.width,\n        //     height: scrollWH.height,\n        //     toSmall: Number(scrollWH.width / height),\n        //     toBig: Number(height / scrollWH.width)\n        //   };\n        // }\n\n        resolve(\"ok\");\n      };\n      img.onerror = (err) => {\n        console.log(\"Item image load error:   \" + err);\n        reject(err);\n      };\n    });\n  }\n\n  setZoom(zoom) {\n    this.zoom = zoom;\n  }\n}\n\nexport default Item;\n"]}]}