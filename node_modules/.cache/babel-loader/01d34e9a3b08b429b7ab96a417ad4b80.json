{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/download.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/download.vue","mtime":1600055487525},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1592981491866}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGljb25zIGZyb20gIi4uL2ljb25zLmpzIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJkb3dubG9hZCIsCiAgcHJvcHM6IHsKICAgIG1vZGU6IHsKICAgICAgZGVmYXVsdDogIiIsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKICAgIGNhbnZhczogewogICAgICBkZWZhdWx0OiBmdW5jdGlvbiBfZGVmYXVsdCgpIHt9LAogICAgICB0eXBlOiBPYmplY3QKICAgIH0sCiAgICBvcmlnaW5Vcmw6IHsKICAgICAgZGVmYXVsdDogIiIsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKICAgIGV4cG9ydEltYWdlOiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IEZ1bmN0aW9uCiAgICB9CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZG93bmxvYWRJY29uOiBpY29ucy5kb3dubG9hZCwKICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UgLy8gaXNTaG93OiBmYWxzZQoKICAgIH07CiAgfSwKICB3YXRjaDogey8vIG1vZGUobmV3bW9kZSkgewogICAgLy8gICBpZiAobmV3bW9kZSA9PT0gImVyYXNlciIpIHsKICAgIC8vICAgICB0aGlzLmVyYXNlckljb24gPSBpY29ucy5hY3RpdmVFcmFzZXI7CiAgICAvLyAgIH0gZWxzZSB7CiAgICAvLyAgICAgdGhpcy5lcmFzZXJJY29uID0gaWNvbnMuZXJhc2VyOwogICAgLy8gICB9CiAgICAvLyB9LAogICAgLy8gY2FudmFzKG5ld0NhbnZhcykgewogICAgLy8gICBuZXdDYW52YXMub24oIm1vdXNlOmRvd24iLCB0aGlzLmRlYWxNb3VzZWRvd24pOwogICAgLy8gICBuZXdDYW52YXMub24oIm9iamVjdDpvdmVyIiwgdGhpcy5kZWFsTW91c2VvdmVyKTsKICAgIC8vIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGRvd25sb2FkOiBmdW5jdGlvbiBkb3dubG9hZCh0eXBlKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAodHlwZSA9PT0gIm9yaWdpbiIpIHsKICAgICAgICBpZiAoIXRoaXMub3JpZ2luVXJsKSByZXR1cm47CiAgICAgICAgZmV0Y2godGhpcy5vcmlnaW5VcmwpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgcmV0dXJuIHJlcy5ibG9iKCk7CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgdmFyIGRvd25sb2FkTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgIGRvd25sb2FkTGluay5ocmVmID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoZGF0YSk7CiAgICAgICAgICBkb3dubG9hZExpbmsuZG93bmxvYWQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArICIuanBlZyI7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRvd25sb2FkTGluayk7CiAgICAgICAgICBkb3dubG9hZExpbmsuY2xpY2soKTsKICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZG93bmxvYWRMaW5rKTsKICAgICAgICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKGRvd25sb2FkTGluay5ocmVmKTsKICAgICAgICAgIF90aGlzLmRpYWxvZ1Zpc2libGUgPSBmYWxzZTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICBfdGhpcy4kbWVzc2FnZS5lcnJvcihlcnIgKyAi5LiL6L295aSx6LSlIik7CgogICAgICAgICAgX3RoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAodHlwZSA9PT0gImN1cnJlbnQiKSB7CiAgICAgICAgdGhpcy5leHBvcnRJbWFnZSgic2luZ2xlIikudGhlbihmdW5jdGlvbiAodXJsKSB7CiAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7IC8vIOiOt+WPluimgeS4i+i9veeahOWbvueJhwoKICAgICAgICAgIGltZy5zcmMgPSB1cmw7CgogICAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7IC8vIOWIm+W7uuS4gOS4qmHoioLngrnmj5LlhaXnmoRkb2N1bWVudAoKICAgICAgICAgICAgdmFyIGV2ZW50ID0gbmV3IE1vdXNlRXZlbnQoImNsaWNrIik7IC8vIOaooeaLn+m8oOagh2NsaWNr54K55Ye75LqL5Lu2CgogICAgICAgICAgICBhLmRvd25sb2FkID0gImRvd25JbWciOyAvLyDorr7nva5h6IqC54K555qEZG93bmxvYWTlsZ7mgKflgLwKCiAgICAgICAgICAgIGEuaHJlZiA9IHVybDsgLy8g5bCG5Zu+54mH55qEc3Jj6LWL5YC857uZYeiKgueCueeahGhyZWYKCiAgICAgICAgICAgIGEuZGlzcGF0Y2hFdmVudChldmVudCk7IC8vIOinpuWPkem8oOagh+eCueWHu+S6i+S7tgoKICAgICAgICAgICAgX3RoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICBhLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIGltZy5vbmVycm9yID0gZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICBfdGhpcy4kbWVzc2FnZS5lcnJvcihlcnIgKyAi5LiL6L295aSx6LSlIik7CgogICAgICAgICAgICBfdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZGVhbENsaWNrOiBmdW5jdGlvbiBkZWFsQ2xpY2soKSB7CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7CiAgICB9CiAgfQp9Ow=="},{"version":3,"sources":["download.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <div class=\"menu_download\">\n      <div @click=\"dealClick\" v-html=\"downloadIcon\" class=\"eraser_icon\"></div>\n    </div>\n\n    <el-dialog\n      title=\"请选择下载图片类型\"\n      :visible.sync=\"dialogVisible\"\n      :modal-append-to-body=\"false\"\n    >\n      <el-button type=\"warning\" @click.stop=\"download('origin')\"\n        >下载原始图片</el-button\n      >\n      <el-button type=\"danger\" @click.stop=\"download('current')\"\n        >下载当前图片</el-button\n      >\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport icons from \"../icons.js\";\n\nexport default {\n  name: \"download\",\n  props: {\n    mode: {\n      default: \"\",\n      type: String\n    },\n    canvas: {\n      default: () => {},\n      type: Object\n    },\n    originUrl: {\n      default: \"\",\n      type: String\n    },\n    exportImage: {\n      default: null,\n      type: Function\n    }\n  },\n  data() {\n    return {\n      downloadIcon: icons.download,\n      dialogVisible: false\n      // isShow: false\n    };\n  },\n\n  watch: {\n    // mode(newmode) {\n    //   if (newmode === \"eraser\") {\n    //     this.eraserIcon = icons.activeEraser;\n    //   } else {\n    //     this.eraserIcon = icons.eraser;\n    //   }\n    // },\n    // canvas(newCanvas) {\n    //   newCanvas.on(\"mouse:down\", this.dealMousedown);\n    //   newCanvas.on(\"object:over\", this.dealMouseover);\n    // }\n  },\n  methods: {\n    download(type) {\n      if (type === \"origin\") {\n        if (!this.originUrl) return;\n        fetch(this.originUrl)\n          .then((res) => {\n            return res.blob();\n          })\n          .then((data) => {\n            let downloadLink = document.createElement(\"a\");\n            downloadLink.href = window.URL.createObjectURL(data);\n            downloadLink.download = new Date().getTime() + \".jpeg\";\n            document.body.appendChild(downloadLink);\n            downloadLink.click();\n            document.body.removeChild(downloadLink);\n            window.URL.revokeObjectURL(downloadLink.href);\n            this.dialogVisible = false;\n          })\n          .catch((err) => {\n            this.$message.error(err + \"下载失败\");\n            this.dialogVisible = false;\n          });\n      }\n\n      if (type === \"current\") {\n        this.exportImage(\"single\").then((url) => {\n          let img = new Image(); // 获取要下载的图片\n          img.src = url;\n          img.onload = () => {\n            let a = document.createElement(\"a\"); // 创建一个a节点插入的document\n            let event = new MouseEvent(\"click\"); // 模拟鼠标click点击事件\n            a.download = \"downImg\"; // 设置a节点的download属性值\n            a.href = url; // 将图片的src赋值给a节点的href\n            a.dispatchEvent(event); // 触发鼠标点击事件\n            this.dialogVisible = false;\n            a.parentNode.removeChild(a);\n          };\n          img.onerror = (err) => {\n            this.$message.error(err + \"下载失败\");\n            this.dialogVisible = false;\n          };\n        });\n      }\n    },\n    dealClick() {\n      this.dialogVisible = true;\n    }\n  }\n};\n</script>\n"],"sourceRoot":"src/page/menu"}]}