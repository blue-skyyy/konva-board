{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/restore.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/restore.vue","mtime":1599816203773},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1592981491866}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHsgZmFicmljIH0gZnJvbSAiZmFicmljIjsKaW1wb3J0IGljb25zIGZyb20gIi4uL2ljb25zLmpzIjsKZXhwb3J0IGRlZmF1bHQgewogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICByZXN0b3JlSWNvbjogaWNvbnMucmVzdG9yZQogICAgfTsKICB9LAogIHByb3BzOiB7CiAgICBjYW52YXM6IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiBmdW5jdGlvbiBfZGVmYXVsdCgpIHt9CiAgICB9LAogICAgYmc6IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiBmdW5jdGlvbiBfZGVmYXVsdCgpIHt9CiAgICB9LAogICAgY3Vyckl0ZW06IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiBmdW5jdGlvbiBfZGVmYXVsdCgpIHt9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBkZWFsQ2xpY2s6IGZ1bmN0aW9uIGRlYWxDbGljaygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVPYmplY3QoKTsKICAgICAgdGhpcy5jYW52YXMuZ2V0T2JqZWN0cygpLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgaWYgKCFjaGlsZC5pc0JnKSBfdGhpcy5jYW52YXMucmVtb3ZlKGNoaWxkKTsKICAgICAgfSk7CiAgICAgIHZhciBfdGhpcyRjdXJySXRlbSA9IHRoaXMuY3Vyckl0ZW0sCiAgICAgICAgICBpbWFnZUluZm8gPSBfdGhpcyRjdXJySXRlbS5pbWFnZUluZm8sCiAgICAgICAgICByb3RhdGUgPSBfdGhpcyRjdXJySXRlbS5yb3RhdGUsCiAgICAgICAgICBzY2FsZVggPSBfdGhpcyRjdXJySXRlbS5zY2FsZVgsCiAgICAgICAgICBzY2FsZVkgPSBfdGhpcyRjdXJySXRlbS5zY2FsZVk7IC8vIOiDjOaZr+WbvueJh+aBouWkjQoKICAgICAgdGhpcy5iZy5yb3RhdGUoMCk7CiAgICAgIHRoaXMuYmcuY2VudGVyKCk7CiAgICAgIHRoaXMuYmcuc2NhbGVYID0gc2NhbGVYOwogICAgICB0aGlzLmJnLnNjYWxlWSA9IHNjYWxlWTsgLy8gY2FuYXZz5a696auYCgogICAgICB0aGlzLmNhbnZhcy5zZXRXaWR0aChpbWFnZUluZm8uc2NhbGUud2lkdGgpOwogICAgICB0aGlzLmNhbnZhcy5zZXRIZWlnaHQoaW1hZ2VJbmZvLnNjYWxlLmhlaWdodCk7CiAgICAgIHZhciBzZWwgPSBuZXcgZmFicmljLkFjdGl2ZVNlbGVjdGlvbih0aGlzLmNhbnZhcy5nZXRPYmplY3RzKCksIHsKICAgICAgICBjYW52YXM6IHRoaXMuY2FudmFzLAogICAgICAgIGNvcm5lclNpemU6IDAsCiAgICAgICAgaGFzQm9yZGVyczogdHJ1ZSwKICAgICAgICBzZWxlY3RhYmxlOiB0cnVlLAogICAgICAgIGhhc0NvbnRyb2xzOiB0cnVlCiAgICAgIH0pOwogICAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3Qoc2VsKTsgLy8g5L2N572uCgogICAgICBzZWwubGVmdCA9IDA7CiAgICAgIHNlbC50b3AgPSAwOwogICAgICBzZWwucmlnaHQgPSAwOwogICAgICBzZWwuYm90dG9tID0gMDsgLy8g5peL6L2sCgogICAgICBzZWwucm90YXRlKC1yb3RhdGUpOwogICAgICBzZWwuY2VudGVyKCk7CiAgICAgIHRoaXMuY3Vyckl0ZW0uc2V0Um90YXRlKDApOyAvLyDnvKnmlL4KCiAgICAgIHZhciBjZW50ZXIgPSB0aGlzLmNhbnZhcy5nZXRDZW50ZXIoKTsKICAgICAgdmFyIHpvb21Qb2ludCA9IG5ldyBmYWJyaWMuUG9pbnQoY2VudGVyLmxlZnQsIGNlbnRlci50b3ApOwogICAgICB0aGlzLmNhbnZhcy56b29tVG9Qb2ludCh6b29tUG9pbnQsIDEpOwogICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTsKICAgIH0KICB9Cn07"},{"version":3,"sources":["restore.vue"],"names":[],"mappings":";;;;;;;;AAOA,SAAA,MAAA,QAAA,QAAA;AACA,OAAA,KAAA,MAAA,aAAA;AAEA,eAAA;AACA,EAAA,IADA,kBACA;AACA,WAAA;AACA,MAAA,WAAA,EAAA,KAAA,CAAA;AADA,KAAA;AAGA,GALA;AAMA,EAAA,KAAA,EAAA;AACA,IAAA,MAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA,oBAAA,CAAA;AAFA,KADA;AAKA,IAAA,EAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA,oBAAA,CAAA;AAFA,KALA;AASA,IAAA,QAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA,oBAAA,CAAA;AAFA;AATA,GANA;AAoBA,EAAA,OAAA,EAAA;AACA,IAAA,SADA,uBACA;AAAA;;AACA,WAAA,MAAA,CAAA,mBAAA;AAEA,WAAA,MAAA,CAAA,UAAA,GAAA,OAAA,CAAA,UAAA,KAAA,EAAA;AACA,YAAA,CAAA,KAAA,CAAA,IAAA,EAAA,KAAA,CAAA,MAAA,CAAA,MAAA,CAAA,KAAA;AACA,OAFA;AAHA,2BAOA,KAAA,QAPA;AAAA,UAOA,SAPA,kBAOA,SAPA;AAAA,UAOA,MAPA,kBAOA,MAPA;AAAA,UAOA,MAPA,kBAOA,MAPA;AAAA,UAOA,MAPA,kBAOA,MAPA,EASA;;AACA,WAAA,EAAA,CAAA,MAAA,CAAA,CAAA;AACA,WAAA,EAAA,CAAA,MAAA;AACA,WAAA,EAAA,CAAA,MAAA,GAAA,MAAA;AACA,WAAA,EAAA,CAAA,MAAA,GAAA,MAAA,CAbA,CAcA;;AACA,WAAA,MAAA,CAAA,QAAA,CAAA,SAAA,CAAA,KAAA,CAAA,KAAA;AACA,WAAA,MAAA,CAAA,SAAA,CAAA,SAAA,CAAA,KAAA,CAAA,MAAA;AAEA,UAAA,GAAA,GAAA,IAAA,MAAA,CAAA,eAAA,CAAA,KAAA,MAAA,CAAA,UAAA,EAAA,EAAA;AACA,QAAA,MAAA,EAAA,KAAA,MADA;AAEA,QAAA,UAAA,EAAA,CAFA;AAGA,QAAA,UAAA,EAAA,IAHA;AAIA,QAAA,UAAA,EAAA,IAJA;AAKA,QAAA,WAAA,EAAA;AALA,OAAA,CAAA;AAOA,WAAA,MAAA,CAAA,eAAA,CAAA,GAAA,EAzBA,CA2BA;;AACA,MAAA,GAAA,CAAA,IAAA,GAAA,CAAA;AACA,MAAA,GAAA,CAAA,GAAA,GAAA,CAAA;AACA,MAAA,GAAA,CAAA,KAAA,GAAA,CAAA;AACA,MAAA,GAAA,CAAA,MAAA,GAAA,CAAA,CA/BA,CAiCA;;AACA,MAAA,GAAA,CAAA,MAAA,CAAA,CAAA,MAAA;AACA,MAAA,GAAA,CAAA,MAAA;AACA,WAAA,QAAA,CAAA,SAAA,CAAA,CAAA,EApCA,CAsCA;;AACA,UAAA,MAAA,GAAA,KAAA,MAAA,CAAA,SAAA,EAAA;AACA,UAAA,SAAA,GAAA,IAAA,MAAA,CAAA,KAAA,CAAA,MAAA,CAAA,IAAA,EAAA,MAAA,CAAA,GAAA,CAAA;AACA,WAAA,MAAA,CAAA,WAAA,CAAA,SAAA,EAAA,CAAA;AAEA,WAAA,MAAA,CAAA,SAAA;AACA;AA7CA;AApBA,CAAA","sourcesContent":["<template>\n  <div class=\"menu_restore\">\n    <div @click=\"dealClick\" v-html=\"restoreIcon\"></div>\n  </div>\n</template>\n\n<script>\nimport { fabric } from \"fabric\";\nimport icons from \"../icons.js\";\n\nexport default {\n  data() {\n    return {\n      restoreIcon: icons.restore\n    };\n  },\n  props: {\n    canvas: {\n      type: Object,\n      default: () => {}\n    },\n    bg: {\n      type: Object,\n      default: () => {}\n    },\n    currItem: {\n      type: Object,\n      default: () => {}\n    }\n  },\n  methods: {\n    dealClick() {\n      this.canvas.discardActiveObject();\n\n      this.canvas.getObjects().forEach((child) => {\n        if (!child.isBg) this.canvas.remove(child);\n      });\n\n      const { imageInfo, rotate, scaleX, scaleY } = this.currItem;\n\n      // 背景图片恢复\n      this.bg.rotate(0);\n      this.bg.center();\n      this.bg.scaleX = scaleX;\n      this.bg.scaleY = scaleY;\n      // canavs宽高\n      this.canvas.setWidth(imageInfo.scale.width);\n      this.canvas.setHeight(imageInfo.scale.height);\n\n      let sel = new fabric.ActiveSelection(this.canvas.getObjects(), {\n        canvas: this.canvas,\n        cornerSize: 0,\n        hasBorders: true,\n        selectable: true,\n        hasControls: true\n      });\n      this.canvas.setActiveObject(sel);\n\n      // 位置\n      sel.left = 0;\n      sel.top = 0;\n      sel.right = 0;\n      sel.bottom = 0;\n\n      // 旋转\n      sel.rotate(-rotate);\n      sel.center();\n      this.currItem.setRotate(0);\n\n      // 缩放\n      let center = this.canvas.getCenter();\n      let zoomPoint = new fabric.Point(center.left, center.top);\n      this.canvas.zoomToPoint(zoomPoint, 1);\n\n      this.canvas.renderAll();\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped></style>\n"],"sourceRoot":"src/page/menu"}]}