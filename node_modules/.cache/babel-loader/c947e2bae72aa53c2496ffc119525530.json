{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/eslint-loader/index.js??ref--13-0!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/Item.js","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/Item.js","mtime":1612493840712},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1606707433631},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/eslint-loader/index.js","mtime":1591241791494}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMvaGFvcGVpd2VpL0RvY3VtZW50cy9ocHcvd2ViLWJvYXJkL2tvbnZhLWJvYXJkL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL1VzZXJzL2hhb3BlaXdlaS9Eb2N1bWVudHMvaHB3L3dlYi1ib2FyZC9rb252YS1ib2FyZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwoKLyoKICog5Y2V5byg5Zu+54mH5omA5Luj6KGo55qE57G7CiAqLwovLyBpbXBvcnQgaW52YWxpZEltZ1VybCBmcm9tICIuL2ltYWdlLWludmFsaWQiOwppbXBvcnQgeyBzY2FsZVdIIH0gZnJvbSAiLi91dGlsLmpzIjsgLy8gaW1wb3J0IHsgY2JydCB9IGZyb20gImNvcmUtanMvZm4vbnVtYmVyIjsKCnZhciBJdGVtID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBJdGVtKG9wdGlvbnMsIGNiKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJdGVtKTsKCiAgICAvLyDorr7nva7pu5jorqTlsZ7mgKcKICAgIHRoaXMuc2NhbGUgPSAxOwogICAgdGhpcy5zaXplUmF0aW8gPSAxOwogICAgdGhpcy5oaXN0b3J5TGlzdCA9IFtdOwogICAgdGhpcy5oaXN0b3J5SW5kZXggPSAtMTsKICAgIHRoaXMuaW1hZ2VJbmZvID0ge307CiAgICB0aGlzLm9yaWdpblVybCA9IG9wdGlvbnMudXJsOwogICAgdGhpcy51cmwgPSBvcHRpb25zLnVybDsKICAgIHRoaXMuaW52YWxpZCA9IGZhbHNlOwogICAgdGhpcy5yb3RhdGUgPSAwOwogICAgdGhpcy5zY2FsZVdIID0gbnVsbDsKICAgIHRoaXMuY2FudmFzID0gb3B0aW9ucy5jYW52YXM7CiAgICB0aGlzLnpvb20gPSAxOwogICAgdGhpcy5jb25XSCA9IG9wdGlvbnMuY29uV0g7CiAgICB0aGlzLmJnSW1nID0gb3B0aW9ucy5iZ0ltZzsKICAgIHRoaXMuc2NhbGVYID0gMTsKICAgIHRoaXMuc2NhbGVZID0gMTsgLy8g6I635Y+W5Zu+54mHc2l6Ze+8jOWQjOaXtuajgOa1i+WbvueJh+aYr+WQpuWQiOazlQogICAgLy8gVE9ETyDogIPomZHmlLnkuLrlvILmraXmiafooYwKICAgIC8vIHRoaXMuX2dldEltYWdlU2l6ZSgoZXJyKSA9PiB7CiAgICAvLyAgIGlmIChlcnIpIHsKICAgIC8vICAgICB0aGlzLmludmFsaWQgPSB0cnVlOwogICAgLy8gICAgIHRoaXMudXJsID0gImhkYXNkYSI7CiAgICAvLyAgIH0KICAgIC8vICAgY2IoZXJyKTsKICAgIC8vIH0pOwoKICAgIHRoaXMuX2dldEltYWdlSW5mbygpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAvLyBkbyBzb21laHRpbmcKICAgICAgY2IoKTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgY29uc29sZS5sb2coImVyciIsIGVycik7IC8vIOS4i+i9veWksei0pSDnlKjlsZXkvY3lm74KCiAgICAgIF90aGlzLmludmFsaWQgPSB0cnVlOwogICAgfSk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoSXRlbSwgW3sKICAgIGtleTogInNhdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNhdmUoaGlzdG9yeSkgewogICAgICAvLyBjb25zb2xlLmxvZygiaGlzdG9yeSIsIGhpc3RvcnkpCiAgICAgIC8vIGNvbnNvbGUubG9nKCJzYXZlLS0tLS0tLWhpc3RvcnkiLCBoaXN0b3J5KTsKICAgICAgdmFyIGpzb25TdGF0ZSA9IEpTT04uc3RyaW5naWZ5KGhpc3RvcnkpOyAvLyDmsqHmnInov5vooYzku7vkvZXkv67mlLnvvIzliJnkuI3kuqfnlJ/mlrDnmoTljoblj7LorrDlvZUKCiAgICAgIHZhciBsYXN0U3RhdGUgPSB0aGlzLmdldExhc3RTdGF0ZSgpOwoKICAgICAgaWYgKGpzb25TdGF0ZSA9PT0gbGFzdFN0YXRlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJubyBjaGFuZ2UsIHJldHVybiIpOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyDkv53lrZjmnIDmlrDnmoTlm77niYcKICAgICAgLy8gdGhpcy51cmwgPSBuZXdVcmw7CiAgICAgIC8vIOiusOW9leS/ruaUueWOhuWPsgoKCiAgICAgIHZhciBoaXN0b3J5TGlzdCA9IHRoaXMuaGlzdG9yeUxpc3Q7CiAgICAgIHZhciBoaXN0b3J5SW5kZXggPSB0aGlzLmhpc3RvcnlJbmRleDsgLy8g6Iul5LuO5Y6G5Y+y6K6w5b2V5Lit55qE6Z2e57uI54K55byA5aeL6L+b6KGM5LqG5L+u5pS577yMCiAgICAgIC8vIOWImemcgOimgeenu+mZpOS5i+WQjueahOWOhuWPsuiusOW9le+8jOW5tuWwhuW9k+WJjeS9nOS4uuaWsOeahOe7iOeCuQogICAgICAvLyAh5rOo5oSP77yM5Y2z5L2/6ZKI5a+55b2T5YmN5Y6G5Y+y6K6w5b2V5rKh5pyJ5L+u5pS577yM5Lmf5Lya6L+b6KGM5L+d5a2Y77yM5bm25oq55o6J5LmL5ZCO55qE5Y6G5Y+y6K6w5b2VCgogICAgICBpZiAoaGlzdG9yeUluZGV4IDwgaGlzdG9yeUxpc3QubGVuZ3RoIC0gMSkgewogICAgICAgIGhpc3RvcnlMaXN0ID0gaGlzdG9yeUxpc3Quc2xpY2UoMCwgaGlzdG9yeUluZGV4ICsgMSk7CiAgICAgIH0KCiAgICAgIGhpc3RvcnlMaXN0LnB1c2goanNvblN0YXRlKTsKICAgICAgaGlzdG9yeUluZGV4ICs9IDE7CiAgICAgIHRoaXMuaGlzdG9yeUxpc3QgPSBoaXN0b3J5TGlzdDsKICAgICAgdGhpcy5oaXN0b3J5SW5kZXggPSBoaXN0b3J5SW5kZXg7CiAgICB9CiAgfSwgewogICAga2V5OiAiY2xlYXJIaXN0b3J5bGlzdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXJIaXN0b3J5bGlzdCgpIHsKICAgICAgdGhpcy5oaXN0b3J5TGlzdCA9IFtdOwogICAgICB0aGlzLmhpc3RvcnlJbmRleCA9IC0xOwogICAgfQogIH0sIHsKICAgIGtleTogImV4cG9ydEltYWdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBleHBvcnRJbWFnZSgpIHsKICAgICAgLy8g5Zu+54mH5peg5pWI77yM5oiW5Zu+54mH5pyq5L2c5Lu75L2V5L+u5pS555qE5oOF5Ya15LiL77yM6L+U5Zue5Y6f5aeLdXJsCiAgICAgIHJldHVybiB0aGlzLmludmFsaWQgfHwgdGhpcy5oaXN0b3J5TGlzdC5sZW5ndGggPD0gMSA/IHRoaXMub3JpZ1VybCA6IHRoaXMudXJsOwogICAgfQogIH0sIHsKICAgIGtleTogInJlc2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZXNldCgpIHsKICAgICAgdGhpcy51cmwgPSB0aGlzLm9yaWdVcmw7CiAgICAgIHRoaXMuaGlzdG9yeUxpc3QgPSB0aGlzLmhpc3RvcnlMaXN0LnNsaWNlKDAsIDEpOwogICAgICB0aGlzLmhpc3RvcnlJbmRleCA9IDA7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0T3JpZ2luU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE9yaWdpblN0YXRlKCkgewogICAgICB2YXIgc3RhdGUgPSB0aGlzLmhpc3RvcnlMaXN0WzBdOwogICAgICB0aGlzLmhpc3RvcnlJbmRleCA9IDA7CiAgICAgIHJldHVybiBzdGF0ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMYXN0U3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExhc3RTdGF0ZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaGlzdG9yeUxpc3RbdGhpcy5oaXN0b3J5TGlzdC5sZW5ndGggLSAxXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRQcmVIaXN0b3J5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQcmVIaXN0b3J5KCkgewogICAgICB2YXIgaGlzdG9yeUluZGV4ID0gdGhpcy5oaXN0b3J5SW5kZXggLSAxOwoKICAgICAgaWYgKGhpc3RvcnlJbmRleCA8IDApIHsKICAgICAgICBjb25zb2xlLmxvZygiaGlzdG9yeSBpbmRleCBvdXQgb2YgcmFuZ2UiKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIGhpc3RvcnkgPSB0aGlzLmhpc3RvcnlMaXN0W2hpc3RvcnlJbmRleF07CgogICAgICBpZiAoIWhpc3RvcnkpIHsKICAgICAgICBjb25zb2xlLmxvZygibm8gaGlzdG9yeSIpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB0aGlzLmhpc3RvcnlJbmRleCA9IGhpc3RvcnlJbmRleDsKICAgICAgcmV0dXJuIGhpc3Rvcnk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TmV4dEhpc3RvcnkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE5leHRIaXN0b3J5KCkgewogICAgICB2YXIgaGlzdG9yeUluZGV4ID0gdGhpcy5oaXN0b3J5SW5kZXggKyAxOwoKICAgICAgaWYgKGhpc3RvcnlJbmRleCA+PSB0aGlzLmhpc3RvcnlMaXN0Lmxlbmd0aCkgewogICAgICAgIGNvbnNvbGUubG9nKCJoaXN0b3J5IGluZGV4IG91dCBvZiByYW5nZSIpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgaGlzdG9yeSA9IHRoaXMuaGlzdG9yeUxpc3RbaGlzdG9yeUluZGV4XTsKCiAgICAgIGlmICghaGlzdG9yeSkgewogICAgICAgIGNvbnNvbGUubG9nKCJubyBoaXN0b3J5Iik7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHRoaXMuaGlzdG9yeUluZGV4ID0gaGlzdG9yeUluZGV4OwogICAgICByZXR1cm4gaGlzdG9yeTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyb3RhdGVUbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcm90YXRlVG8oZGlyZWN0aW9uKSB7CiAgICAgIHZhciByb3RhdGUgPSB0aGlzLnJvdGF0ZTsKICAgICAgdmFyIGRpZmYgPSBkaXJlY3Rpb24gPT09ICJsZWZ0IiA/IC05MCA6IDkwOwogICAgICByb3RhdGUgKz0gZGlmZjsKICAgICAgaWYgKHJvdGF0ZSA+PSAzNjApIHJvdGF0ZSA9IDA7CiAgICAgIGlmIChyb3RhdGUgPD0gLTM2MCkgcm90YXRlID0gMDsKICAgICAgdGhpcy5yb3RhdGUgPSByb3RhdGU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Wm9vbU1vZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFpvb21Nb2RlKG1vZGUpIHsKICAgICAgdGhpcy56b29tTW9kZSA9IG1vZGU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Um90YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRSb3RhdGUocm90YXRlKSB7CiAgICAgIHRoaXMucm90YXRlID0gcm90YXRlOwogICAgfQogIH0sIHsKICAgIGtleTogIl9nZXRJbWFnZUluZm8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRJbWFnZUluZm8oKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7IC8vIGltZy5jcm9zc09yaWdpbiA9ICJBbm9ueW1vdXMiOwoKICAgICAgICBpbWcuc3JjID0gX3RoaXMyLnVybDsKCiAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBjb25XSCA9IF90aGlzMi5jb25XSDsKCiAgICAgICAgICB2YXIgX3NjYWxlV0ggPSBzY2FsZVdIKGltZy53aWR0aCwgaW1nLmhlaWdodCwgY29uV0gud2lkdGgsIGNvbldILmhlaWdodCksCiAgICAgICAgICAgICAgd2lkdGggPSBfc2NhbGVXSC53aWR0aCwKICAgICAgICAgICAgICBoZWlnaHQgPSBfc2NhbGVXSC5oZWlnaHQ7IC8vIOe8qeaUvueahOWuvemrmAoKCiAgICAgICAgICB2YXIgc2NhbGVYID0gTnVtYmVyKHdpZHRoIC8gaW1nLndpZHRoKTsKICAgICAgICAgIHZhciBzY2FsZVkgPSBOdW1iZXIoaGVpZ2h0IC8gaW1nLmhlaWdodCk7CiAgICAgICAgICBfdGhpczIuc2NhbGVYID0gc2NhbGVYOwogICAgICAgICAgX3RoaXMyLnNjYWxlWSA9IHNjYWxlWTsKICAgICAgICAgIF90aGlzMi5pbWFnZUluZm8gPSB7CiAgICAgICAgICAgIG9yaWdpbjogewogICAgICAgICAgICAgIHdpZHRoOiBpbWcud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0OiBpbWcuaGVpZ2h0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNjYWxlOiB7CiAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoLAogICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0CiAgICAgICAgICAgIH0KICAgICAgICAgIH07IC8vIGNvbnNvbGUubG9nKCJ0aGlzLmltYWdlSW5mIiwgdGhpcy5pbWFnZUluZm8pOwogICAgICAgICAgLy8g6buY6K6k5oOF5Ya15LiLIHNjYWxlLndpZHRo44CBc2NhbGUuaGVpZ2h05b+F54S25LiN5aSn5LqO5aSW5bGC5a655Zmo5a696auYCiAgICAgICAgICAvLyDmraTml7blr7nmjaLlrr3pq5jljbPlj68KICAgICAgICAgIC8vIGlmIChzY2FsZS53aWR0aCA8PSBjb25XSC5oZWlnaHQgfHwgc2NhbGUuaGVpZ2h0IDw9IGNvbldILndpZHRoKSB7CiAgICAgICAgICAvLyAgIC8vIHNjYWxlIOWuvemrmOmDveWwj+S6juWuueWZqOWuvemrmOaDheWGtQogICAgICAgICAgLy8gICB0aGlzLmltYWdlSW5mby5zY3JvbGxXSCA9IHsKICAgICAgICAgIC8vICAgICB3aWR0aDogc2NhbGUuaGVpZ2h0LAogICAgICAgICAgLy8gICAgIGhlaWdodDogc2NhbGUud2lkdGgsCiAgICAgICAgICAvLyAgICAgdG9TbWFsbDogMSwKICAgICAgICAgIC8vICAgICB0b0JpZzogMQogICAgICAgICAgLy8gICB9OwogICAgICAgICAgLy8gfQogICAgICAgICAgLy8g5peL6L2s5LmL5ZCOIOWuvemrmOWvueiwgyDkv53or4HkuI3lh7rnjrDmu5rliqjmnaEKICAgICAgICAgIC8vIGlmICh3aWR0aCA+IGgpIHsKICAgICAgICAgIC8vICAgbGV0IHNjcm9sbFdIID0gc2NhbGVXSChoZWlnaHQsIHdpZHRoLCB3LCBoKTsKICAgICAgICAgIC8vICAgdGhpcy5pbWFnZUluZm8uc2Nyb2xsV0ggPSB7CiAgICAgICAgICAvLyAgICAgd2lkdGg6IHNjcm9sbFdILndpZHRoLAogICAgICAgICAgLy8gICAgIGhlaWdodDogc2Nyb2xsV0guaGVpZ2h0LAogICAgICAgICAgLy8gICAgIHRvU21hbGw6IE51bWJlcihzY3JvbGxXSC5oZWlnaHQgLyB3aWR0aCksCiAgICAgICAgICAvLyAgICAgdG9CaWc6IE51bWJlcih3aWR0aCAvIHNjcm9sbFdILmhlaWdodCkKICAgICAgICAgIC8vICAgfTsKICAgICAgICAgIC8vIH0KICAgICAgICAgIC8vIGlmIChoZWlnaHQgPiB3KSB7CiAgICAgICAgICAvLyAgIGxldCBzY3JvbGxXSCA9IHNjYWxlV0god2lkdGgsIGhlaWdodCwgdywgaCk7CiAgICAgICAgICAvLyAgIHRoaXMuaW1hZ2VJbmZvLnNjcm9sbFdIID0gewogICAgICAgICAgLy8gICAgIHdpZHRoOiBzY3JvbGxXSC53aWR0aCwKICAgICAgICAgIC8vICAgICBoZWlnaHQ6IHNjcm9sbFdILmhlaWdodCwKICAgICAgICAgIC8vICAgICB0b1NtYWxsOiBOdW1iZXIoc2Nyb2xsV0gud2lkdGggLyBoZWlnaHQpLAogICAgICAgICAgLy8gICAgIHRvQmlnOiBOdW1iZXIoaGVpZ2h0IC8gc2Nyb2xsV0gud2lkdGgpCiAgICAgICAgICAvLyAgIH07CiAgICAgICAgICAvLyB9CgogICAgICAgICAgcmVzb2x2ZSgib2siKTsKICAgICAgICB9OwoKICAgICAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJJdGVtIGltYWdlIGxvYWQgZXJyb3I6ICAgIiArIGVycik7CiAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICB9OwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRab29tIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRab29tKHpvb20pIHsKICAgICAgdGhpcy56b29tID0gem9vbTsKICAgIH0KICB9XSk7CgogIHJldHVybiBJdGVtOwp9KCk7CgpleHBvcnQgZGVmYXVsdCBJdGVtOw=="},{"version":3,"sources":["/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/Item.js"],"names":["scaleWH","Item","options","cb","scale","sizeRatio","historyList","historyIndex","imageInfo","originUrl","url","invalid","rotate","canvas","zoom","conWH","bgImg","scaleX","scaleY","_getImageInfo","then","catch","err","console","log","history","jsonState","JSON","stringify","lastState","getLastState","warn","length","slice","push","origUrl","state","direction","diff","mode","zoomMode","Promise","resolve","reject","img","Image","src","onload","width","height","Number","origin","onerror"],"mappings":"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","sourcesContent":["/*\n * 单张图片所代表的类\n */\n// import invalidImgUrl from \"./image-invalid\";\nimport { scaleWH } from \"./util.js\";\n// import { cbrt } from \"core-js/fn/number\";\n\nclass Item {\n  constructor(options, cb) {\n    // 设置默认属性\n    this.scale = 1;\n    this.sizeRatio = 1;\n    this.historyList = [];\n    this.historyIndex = -1;\n    this.imageInfo = {};\n    this.originUrl = options.url;\n    this.url = options.url;\n    this.invalid = false;\n    this.rotate = 0;\n    this.scaleWH = null;\n    this.canvas = options.canvas;\n    this.zoom = 1;\n    this.conWH = options.conWH;\n    this.bgImg = options.bgImg;\n    this.scaleX = 1;\n    this.scaleY = 1;\n\n    // 获取图片size，同时检测图片是否合法\n    // TODO 考虑改为异步执行\n    // this._getImageSize((err) => {\n    //   if (err) {\n    //     this.invalid = true;\n    //     this.url = \"hdasda\";\n    //   }\n\n    //   cb(err);\n    // });\n\n    this._getImageInfo()\n      .then(() => {\n        // do somehting\n        cb();\n      })\n      .catch((err) => {\n        console.log(\"err\", err);\n        // 下载失败 用展位图\n        this.invalid = true;\n      });\n  }\n\n  save(history) {\n    // console.log(\"history\", history)\n    // console.log(\"save-------history\", history);\n    let jsonState = JSON.stringify(history);\n\n    // 没有进行任何修改，则不产生新的历史记录\n    let lastState = this.getLastState();\n    if (jsonState === lastState) {\n      console.warn(\"no change, return\");\n      return;\n    }\n\n    // 保存最新的图片\n    // this.url = newUrl;\n\n    // 记录修改历史\n    let historyList = this.historyList;\n    let historyIndex = this.historyIndex;\n\n    // 若从历史记录中的非终点开始进行了修改，\n    // 则需要移除之后的历史记录，并将当前作为新的终点\n    // !注意，即使针对当前历史记录没有修改，也会进行保存，并抹掉之后的历史记录\n    if (historyIndex < historyList.length - 1) {\n      historyList = historyList.slice(0, historyIndex + 1);\n    }\n\n    historyList.push(jsonState);\n    historyIndex += 1;\n    this.historyList = historyList;\n    this.historyIndex = historyIndex;\n  }\n\n  clearHistorylist() {\n    this.historyList = [];\n    this.historyIndex = -1;\n  }\n\n  exportImage() {\n    // 图片无效，或图片未作任何修改的情况下，返回原始url\n    return this.invalid || this.historyList.length <= 1\n      ? this.origUrl\n      : this.url;\n  }\n\n  reset() {\n    this.url = this.origUrl;\n    this.historyList = this.historyList.slice(0, 1);\n    this.historyIndex = 0;\n  }\n\n  getOriginState() {\n    let state = this.historyList[0];\n    this.historyIndex = 0;\n    return state;\n  }\n\n  getLastState() {\n    return this.historyList[this.historyList.length - 1];\n  }\n\n  getPreHistory() {\n    let historyIndex = this.historyIndex - 1;\n    if (historyIndex < 0) {\n      console.log(\"history index out of range\");\n      return null;\n    }\n\n    let history = this.historyList[historyIndex];\n    if (!history) {\n      console.log(\"no history\");\n      return null;\n    }\n\n    this.historyIndex = historyIndex;\n\n    return history;\n  }\n\n  getNextHistory() {\n    let historyIndex = this.historyIndex + 1;\n    if (historyIndex >= this.historyList.length) {\n      console.log(\"history index out of range\");\n      return null;\n    }\n\n    let history = this.historyList[historyIndex];\n    if (!history) {\n      console.log(\"no history\");\n      return null;\n    }\n\n    this.historyIndex = historyIndex;\n    return history;\n  }\n\n  rotateTo(direction) {\n    let rotate = this.rotate;\n    let diff = direction === \"left\" ? -90 : 90;\n    rotate += diff;\n    if (rotate >= 360) rotate = 0;\n    if (rotate <= -360) rotate = 0;\n    this.rotate = rotate;\n  }\n\n  setZoomMode(mode) {\n    this.zoomMode = mode;\n  }\n\n  setRotate(rotate) {\n    this.rotate = rotate;\n  }\n\n  _getImageInfo() {\n    return new Promise((resolve, reject) => {\n      let img = new Image();\n      // img.crossOrigin = \"Anonymous\";\n      img.src = this.url;\n      img.onload = () => {\n        const { conWH } = this;\n        const { width, height } = scaleWH(\n          img.width,\n          img.height,\n          conWH.width,\n          conWH.height\n        );\n\n        // 缩放的宽高\n        let scaleX = Number(width / img.width);\n        let scaleY = Number(height / img.height);\n        this.scaleX = scaleX;\n        this.scaleY = scaleY;\n\n        this.imageInfo = {\n          origin: {\n            width: img.width,\n            height: img.height\n          },\n          scale: {\n            width,\n            height\n          }\n        };\n\n        // console.log(\"this.imageInf\", this.imageInfo);\n\n        // 默认情况下 scale.width、scale.height必然不大于外层容器宽高\n        // 此时对换宽高即可\n        // if (scale.width <= conWH.height || scale.height <= conWH.width) {\n        //   // scale 宽高都小于容器宽高情况\n        //   this.imageInfo.scrollWH = {\n        //     width: scale.height,\n        //     height: scale.width,\n        //     toSmall: 1,\n        //     toBig: 1\n        //   };\n        // }\n        // 旋转之后 宽高对调 保证不出现滚动条\n        // if (width > h) {\n        //   let scrollWH = scaleWH(height, width, w, h);\n        //   this.imageInfo.scrollWH = {\n        //     width: scrollWH.width,\n        //     height: scrollWH.height,\n        //     toSmall: Number(scrollWH.height / width),\n        //     toBig: Number(width / scrollWH.height)\n        //   };\n        // }\n        // if (height > w) {\n        //   let scrollWH = scaleWH(width, height, w, h);\n        //   this.imageInfo.scrollWH = {\n        //     width: scrollWH.width,\n        //     height: scrollWH.height,\n        //     toSmall: Number(scrollWH.width / height),\n        //     toBig: Number(height / scrollWH.width)\n        //   };\n        // }\n\n        resolve(\"ok\");\n      };\n      img.onerror = (err) => {\n        console.log(\"Item image load error:   \" + err);\n        reject(err);\n      };\n    });\n  }\n\n  setZoom(zoom) {\n    this.zoom = zoom;\n  }\n}\n\nexport default Item;\n"]}]}