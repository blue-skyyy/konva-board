{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/rotate.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/rotate.vue","mtime":1600055587098},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1592981491866}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHsgZmFicmljIH0gZnJvbSAiZmFicmljIjsKaW1wb3J0IGljb25zIGZyb20gIi4uL2ljb25zLmpzIjsKZXhwb3J0IGRlZmF1bHQgewogIHByb3BzOiB7CiAgICBjYW52YXM6IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiBmdW5jdGlvbiBfZGVmYXVsdCgpIHt9CiAgICB9LAogICAgY3Vyckl0ZW06IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiBmdW5jdGlvbiBfZGVmYXVsdCgpIHt9CiAgICB9LAogICAgcm90YXRlUmlnaHQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICByb3RhdGVMZWZ0OiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaWNvbnM6IGljb25zCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHNldFN0eWxlOiBmdW5jdGlvbiBzZXRTdHlsZSgpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChsZWZ0LCByaWdodCkgewogICAgICAgIGlmIChsZWZ0ICYmIHJpZ2h0KSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkaXNwbGF5OiAiZmxleCIsCiAgICAgICAgICAgIGZsZXg6IDIKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBpZiAoIWxlZnQgJiYgIXJpZ2h0KSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkaXNwbGF5OiAibm9uZSIKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgZGlzcGxheTogImZsZXgiLAogICAgICAgICAgZmxleDogMQogICAgICAgIH07CiAgICAgIH07CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICByb3RhdGVUbzogZnVuY3Rpb24gcm90YXRlVG8oZGlyZWN0aW9uKSB7CiAgICAgIHRoaXMuY3Vyckl0ZW0ucm90YXRlVG8oZGlyZWN0aW9uKTsgLy8gIOabtOaWsGNhbnZhc+eahOWuvemrmAoKICAgICAgdmFyIF90aGlzJGN1cnJJdGVtID0gdGhpcy5jdXJySXRlbSwKICAgICAgICAgIGltYWdlSW5mbyA9IF90aGlzJGN1cnJJdGVtLmltYWdlSW5mbywKICAgICAgICAgIHJvdGF0ZSA9IF90aGlzJGN1cnJJdGVtLnJvdGF0ZTsgLy8g5L+d5oyB5rC05bmz5Z6C55u05bGF5LitCgogICAgICB2YXIgd3JhcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNpbWFnZV9jYW52YXNfd3JhcCIpOwoKICAgICAgaWYgKHJvdGF0ZSAlIDE4MCA9PT0gMCkgewogICAgICAgIHRoaXMuY2FudmFzLnNldFdpZHRoKGltYWdlSW5mby5zY2FsZS53aWR0aCk7CiAgICAgICAgdGhpcy5jYW52YXMuc2V0SGVpZ2h0KGltYWdlSW5mby5zY2FsZS5oZWlnaHQpOwogICAgICAgIHdyYXAuc3R5bGVbImFsaWduLWl0ZW1zIl0gPSAiY2VudGVyIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNhbnZhcy5zZXRXaWR0aChpbWFnZUluZm8uc2NhbGUuaGVpZ2h0KTsKICAgICAgICB0aGlzLmNhbnZhcy5zZXRIZWlnaHQoaW1hZ2VJbmZvLnNjYWxlLndpZHRoKTsKICAgICAgICB3cmFwLnN0eWxlWyJhbGlnbi1pdGVtcyJdID0gImZsZXgtc3RhcnQiOwogICAgICB9IC8vIOS9nOS4uue7hOaVtOS9k+aXi+i9rAoKCiAgICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVPYmplY3QoKTsKICAgICAgdmFyIHNlbCA9IG5ldyBmYWJyaWMuQWN0aXZlU2VsZWN0aW9uKHRoaXMuY2FudmFzLmdldE9iamVjdHMoKSwgewogICAgICAgIGNhbnZhczogdGhpcy5jYW52YXMsCiAgICAgICAgY29ybmVyU2l6ZTogMCwKICAgICAgICBoYXNDb250cm9sczogdHJ1ZQogICAgICB9KTsKICAgICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KHNlbCk7CiAgICAgIGRpcmVjdGlvbiA9PT0gImxlZnQiID8gc2VsLnJvdGF0ZSgtOTApIDogc2VsLnJvdGF0ZSg5MCk7IC8vIOaBouWkjee8qeaUvgoKICAgICAgdmFyIGNlbnRlciA9IHRoaXMuY2FudmFzLmdldENlbnRlcigpOwogICAgICB2YXIgem9vbVBvaW50ID0gbmV3IGZhYnJpYy5Qb2ludChjZW50ZXIudG9wLCBjZW50ZXIubGVmdCk7CiAgICAgIHRoaXMuY2FudmFzLnpvb21Ub1BvaW50KHpvb21Qb2ludCwgMSk7IC8vIOe7hOWxheS4rQoKICAgICAgc2VsLmNlbnRlcigpOwogICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTsKICAgIH0KICB9Cn07"},{"version":3,"sources":["rotate.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div :style=\"setStyle(rotateLeft, rotateRight)\" class=\"menu_rotate\">\n    <div :style=\"!rotateLeft && 'display:none'\" @click=\"rotateTo('left')\">\n      <div class=\"icon\" v-html=\"icons.rotateLeft\"></div>\n    </div>\n    <div @click=\"rotateTo('right')\" :style=\"!rotateRight && 'display:none'\">\n      <div class=\"icon\" v-html=\"icons.rotateRight\"></div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { fabric } from \"fabric\";\nimport icons from \"../icons.js\";\nexport default {\n  props: {\n    canvas: {\n      type: Object,\n      default: () => {}\n    },\n    currItem: {\n      type: Object,\n      default: () => {}\n    },\n    rotateRight: {\n      type: Boolean,\n      default: false\n    },\n    rotateLeft: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      icons\n    };\n  },\n  computed: {\n    setStyle() {\n      return function(left, right) {\n        if (left && right) {\n          return {\n            display: \"flex\",\n            flex: 2\n          };\n        }\n        if (!left && !right) {\n          return {\n            display: \"none\"\n          };\n        }\n\n        return {\n          display: \"flex\",\n          flex: 1\n        };\n      };\n    }\n  },\n  methods: {\n    rotateTo(direction) {\n      this.currItem.rotateTo(direction);\n      //  更新canvas的宽高\n      const { imageInfo, rotate } = this.currItem;\n      // 保持水平垂直居中\n      let wrap = document.querySelector(\"#image_canvas_wrap\");\n      if (rotate % 180 === 0) {\n        this.canvas.setWidth(imageInfo.scale.width);\n        this.canvas.setHeight(imageInfo.scale.height);\n        wrap.style[\"align-items\"] = \"center\";\n      } else {\n        this.canvas.setWidth(imageInfo.scale.height);\n        this.canvas.setHeight(imageInfo.scale.width);\n        wrap.style[\"align-items\"] = \"flex-start\";\n      }\n      // 作为组整体旋转\n      this.canvas.discardActiveObject();\n      let sel = new fabric.ActiveSelection(this.canvas.getObjects(), {\n        canvas: this.canvas,\n        cornerSize: 0,\n        hasControls: true\n      });\n      this.canvas.setActiveObject(sel);\n      direction === \"left\" ? sel.rotate(-90) : sel.rotate(90);\n      // 恢复缩放\n      let center = this.canvas.getCenter();\n      let zoomPoint = new fabric.Point(center.top, center.left);\n      this.canvas.zoomToPoint(zoomPoint, 1);\n      // 组居中\n      sel.center();\n      this.canvas.renderAll();\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n.menu_rotate {\n  justify-content: space-around;\n}\n</style>\n"],"sourceRoot":"src/page/menu"}]}