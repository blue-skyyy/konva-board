{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/draw.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/draw.vue","mtime":1612674874644},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1606707433631},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1610942723088}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKLy8KLy8KLy8KLy8KLy8KaW1wb3J0IEtvbnZhIGZyb20gImtvbnZhIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJkcmF3IiwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHt9OwogIH0sCiAgcHJvcHM6IHsKICAgIGZyZWVEcmF3TGF5ZXI6IHsKICAgICAgdHlwZTogT2JqZWN0CiAgICB9LAogICAgc3RhZ2U6IHsKICAgICAgdHlwZTogT2JqZWN0CiAgICB9LAogICAgbW9kZTogewogICAgICB0eXBlOiBTdHJpbmcKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBtb2RlOiBmdW5jdGlvbiBtb2RlKCkgewogICAgICBjb25zb2xlLmxvZygiPT09PT0iLCB0aGlzLnN0YWdlKTsgLy8gaWYgKHZhbCA9PT0gImJydXNoIiB8fCB2YWwgPT09ICJlcmFzZXIiKSB7CiAgICAgIC8vICAgdGhpcy5wYWludEV2ZW50KCk7CiAgICAgIC8vIH0KICAgIH0sCiAgICBzdGFnZTogZnVuY3Rpb24gc3RhZ2UoKSB7CiAgICAgIGlmICh0aGlzLm1vZGUgPT09ICJicnVzaCIgfHwgdGhpcy5tb2RlID09PSAiZXJhc2VyIikgewogICAgICAgIHRoaXMucGFpbnRFdmVudCgpOwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBwYWludEV2ZW50OiBmdW5jdGlvbiBwYWludEV2ZW50KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGlzUGFpbnQgPSBmYWxzZTsKICAgICAgdmFyIGxhc3RMaW5lOwogICAgICBjb25zb2xlLmxvZygidGhpcy5zdGFnZUEiLCB0aGlzLnN0YWdlKTsgLy8gc2V0VGltZW91dCgoKSA9PiB7CgogICAgICB0aGlzLnN0YWdlLm9uKCJtb3VzZWRvd24iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaXNQYWludCA9IHRydWU7CgogICAgICAgIHZhciBwb3MgPSBfdGhpcy5zdGFnZS5nZXRQb2ludGVyUG9zaXRpb24oKTsKCiAgICAgICAgdmFyIG9sZFNjYWxlID0gX3RoaXMuc3RhZ2Uuc2NhbGVYKCk7CgogICAgICAgIGxhc3RMaW5lID0gbmV3IEtvbnZhLkxpbmUoewogICAgICAgICAgc3Ryb2tlOiAiI2RmNGIyNiIsCiAgICAgICAgICBzdHJva2VXaWR0aDogNSwKICAgICAgICAgIGdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbjogX3RoaXMubW9kZSA9PT0gImJydXNoIiA/ICJzb3VyY2Utb3ZlciIgOiAiZGVzdGluYXRpb24tb3V0IiwKICAgICAgICAgIHBvaW50czogW3Bvcy54IC8gb2xkU2NhbGUgLSBfdGhpcy5zdGFnZS54KCkgLyBvbGRTY2FsZSwgcG9zLnkgLyBvbGRTY2FsZSAtIF90aGlzLnN0YWdlLnkoKSAvIG9sZFNjYWxlXQogICAgICAgIH0pOwoKICAgICAgICBfdGhpcy5mcmVlRHJhd0xheWVyLmFkZChsYXN0TGluZSk7CiAgICAgIH0pOwogICAgICB0aGlzLnN0YWdlLm9uKCJtb3VzZXVwIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGlzUGFpbnQgPSBmYWxzZTsKCiAgICAgICAgX3RoaXMuJGVtaXQoInNhdmVDdXJySXRlbVN0YXRlIik7CiAgICAgIH0pOwogICAgICB0aGlzLnN0YWdlLm9uKCJtb3VzZW1vdmUiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIG9sZFNjYWxlID0gX3RoaXMuc3RhZ2Uuc2NhbGVYKCk7CgogICAgICAgIGlmICghaXNQYWludCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8g56Gu5L+d57yp5pS+5Yqf6IO96IO95q2j5bi45L2/55SoCgoKICAgICAgICB2YXIgcG9zID0gX3RoaXMuc3RhZ2UuZ2V0UG9pbnRlclBvc2l0aW9uKCk7CgogICAgICAgIHZhciBuZXdQb2ludHMgPSBsYXN0TGluZS5wb2ludHMoKS5jb25jYXQoW3Bvcy54IC8gb2xkU2NhbGUgLSBfdGhpcy5zdGFnZS54KCkgLyBvbGRTY2FsZSwgcG9zLnkgLyBvbGRTY2FsZSAtIF90aGlzLnN0YWdlLnkoKSAvIG9sZFNjYWxlXSk7CiAgICAgICAgbGFzdExpbmUucG9pbnRzKG5ld1BvaW50cyk7CgogICAgICAgIF90aGlzLmZyZWVEcmF3TGF5ZXIuYmF0Y2hEcmF3KCk7CiAgICAgIH0pOwogICAgICBjb25zb2xlLmxvZygidGhpcy5zdGFnZUIiLCB0aGlzLnN0YWdlKTsgLy8gfSwgMCk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"sources":["draw.vue"],"names":[],"mappings":";;;;;;AAMA,OAAA,KAAA,MAAA,OAAA;AACA,eAAA;AACA,EAAA,IAAA,EAAA,MADA;AAEA,EAAA,IAFA,kBAEA;AACA,WAAA,EAAA;AACA,GAJA;AAKA,EAAA,KAAA,EAAA;AACA,IAAA,aAAA,EAAA;AACA,MAAA,IAAA,EAAA;AADA,KADA;AAIA,IAAA,KAAA,EAAA;AACA,MAAA,IAAA,EAAA;AADA,KAJA;AAOA,IAAA,IAAA,EAAA;AACA,MAAA,IAAA,EAAA;AADA;AAPA,GALA;AAgBA,EAAA,KAAA,EAAA;AACA,IAAA,IADA,kBACA;AACA,MAAA,OAAA,CAAA,GAAA,CAAA,OAAA,EAAA,KAAA,KAAA,EADA,CAEA;AACA;AACA;AACA,KANA;AAOA,IAAA,KAPA,mBAOA;AACA,UAAA,KAAA,IAAA,KAAA,OAAA,IAAA,KAAA,IAAA,KAAA,QAAA,EAAA;AACA,aAAA,UAAA;AACA;AACA;AAXA,GAhBA;AA6BA,EAAA,OAAA,EAAA;AACA,IAAA,UADA,wBACA;AAAA;;AACA,UAAA,OAAA,GAAA,KAAA;AACA,UAAA,QAAA;AACA,MAAA,OAAA,CAAA,GAAA,CAAA,aAAA,EAAA,KAAA,KAAA,EAHA,CAIA;;AACA,WAAA,KAAA,CAAA,EAAA,CAAA,WAAA,EAAA,YAAA;AACA,QAAA,OAAA,GAAA,IAAA;;AACA,YAAA,GAAA,GAAA,KAAA,CAAA,KAAA,CAAA,kBAAA,EAAA;;AACA,YAAA,QAAA,GAAA,KAAA,CAAA,KAAA,CAAA,MAAA,EAAA;;AACA,QAAA,QAAA,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA;AACA,UAAA,MAAA,EAAA,SADA;AAEA,UAAA,WAAA,EAAA,CAFA;AAGA,UAAA,wBAAA,EACA,KAAA,CAAA,IAAA,KAAA,OAAA,GAAA,aAAA,GAAA,iBAJA;AAKA,UAAA,MAAA,EAAA,CACA,GAAA,CAAA,CAAA,GAAA,QAAA,GAAA,KAAA,CAAA,KAAA,CAAA,CAAA,KAAA,QADA,EAEA,GAAA,CAAA,CAAA,GAAA,QAAA,GAAA,KAAA,CAAA,KAAA,CAAA,CAAA,KAAA,QAFA;AALA,SAAA,CAAA;;AAUA,QAAA,KAAA,CAAA,aAAA,CAAA,GAAA,CAAA,QAAA;AACA,OAfA;AAgBA,WAAA,KAAA,CAAA,EAAA,CAAA,SAAA,EAAA,YAAA;AACA,QAAA,OAAA,GAAA,KAAA;;AACA,QAAA,KAAA,CAAA,KAAA,CAAA,mBAAA;AACA,OAHA;AAIA,WAAA,KAAA,CAAA,EAAA,CAAA,WAAA,EAAA,YAAA;AACA,YAAA,QAAA,GAAA,KAAA,CAAA,KAAA,CAAA,MAAA,EAAA;;AACA,YAAA,CAAA,OAAA,EAAA;AACA;AACA,SAJA,CAKA;;;AACA,YAAA,GAAA,GAAA,KAAA,CAAA,KAAA,CAAA,kBAAA,EAAA;;AACA,YAAA,SAAA,GAAA,QAAA,CACA,MADA,GAEA,MAFA,CAEA,CACA,GAAA,CAAA,CAAA,GAAA,QAAA,GAAA,KAAA,CAAA,KAAA,CAAA,CAAA,KAAA,QADA,EAEA,GAAA,CAAA,CAAA,GAAA,QAAA,GAAA,KAAA,CAAA,KAAA,CAAA,CAAA,KAAA,QAFA,CAFA,CAAA;AAMA,QAAA,QAAA,CAAA,MAAA,CAAA,SAAA;;AACA,QAAA,KAAA,CAAA,aAAA,CAAA,SAAA;AACA,OAfA;AAgBA,MAAA,OAAA,CAAA,GAAA,CAAA,aAAA,EAAA,KAAA,KAAA,EAzCA,CA0CA;AACA;AA5CA;AA7BA,CAAA","sourcesContent":["<template>\n  <div class=\"menu-draw\">\n    <el-button>画笔和橡皮擦</el-button>\n  </div>\n</template>\n<script>\nimport Konva from \"konva\";\nexport default {\n  name: \"draw\",\n  data() {\n    return {};\n  },\n  props: {\n    freeDrawLayer: {\n      type: Object\n    },\n    stage: {\n      type: Object\n    },\n    mode: {\n      type: String\n    }\n  },\n  watch: {\n    mode() {\n      console.log(\"=====\", this.stage);\n      // if (val === \"brush\" || val === \"eraser\") {\n      //   this.paintEvent();\n      // }\n    },\n    stage() {\n      if (this.mode === \"brush\" || this.mode === \"eraser\") {\n        this.paintEvent();\n      }\n    }\n  },\n  methods: {\n    paintEvent() {\n      let isPaint = false;\n      let lastLine;\n      console.log(\"this.stageA\", this.stage);\n      // setTimeout(() => {\n      this.stage.on(\"mousedown\", () => {\n        isPaint = true;\n        let pos = this.stage.getPointerPosition();\n        let oldScale = this.stage.scaleX();\n        lastLine = new Konva.Line({\n          stroke: \"#df4b26\",\n          strokeWidth: 5,\n          globalCompositeOperation:\n            this.mode === \"brush\" ? \"source-over\" : \"destination-out\",\n          points: [\n            pos.x / oldScale - this.stage.x() / oldScale,\n            pos.y / oldScale - this.stage.y() / oldScale\n          ]\n        });\n        this.freeDrawLayer.add(lastLine);\n      });\n      this.stage.on(\"mouseup\", () => {\n        isPaint = false;\n        this.$emit(\"saveCurrItemState\");\n      });\n      this.stage.on(\"mousemove\", () => {\n        let oldScale = this.stage.scaleX();\n        if (!isPaint) {\n          return;\n        }\n        // 确保缩放功能能正常使用\n        const pos = this.stage.getPointerPosition();\n        let newPoints = lastLine\n          .points()\n          .concat([\n            pos.x / oldScale - this.stage.x() / oldScale,\n            pos.y / oldScale - this.stage.y() / oldScale\n          ]);\n        lastLine.points(newPoints);\n        this.freeDrawLayer.batchDraw();\n      });\n      console.log(\"this.stageB\", this.stage);\n      // }, 0);\n    }\n  }\n};\n</script>\n"],"sourceRoot":"src/page/menu"}]}