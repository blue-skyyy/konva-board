{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/Konva/ImgDecorator.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/Konva/ImgDecorator.vue","mtime":1612505420630},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1606707433631},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1610942723088}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBLb252YSBmcm9tICJrb252YSI7CmltcG9ydCB7CiAgaW1hZ2VMaXN0LAogIGdldEJnSW1nWFlPZmZzZXQsCiAgQ19XSURUSCwKICBDX0hFSUdIVCwKICByb3RhdGVBcm91bmRDZW50ZXIKfSBmcm9tICIuLi91dGlsLmpzIjsKaW1wb3J0IEl0ZW0gZnJvbSAiLi4vSXRlbS5qcyI7Cgpjb25zdCBtZXRob2RzID0gewogIHByZXZpZXcoKSB7CiAgICB0aGlzLiRlbWl0KCJwcmV2aWV3Iik7CiAgfSwKICAvLyDliIfmjaLlm77niYflpI3ljp/mk43kvZwKICAvLyDliIfmjaLlt6XlhbfmoI/mqKHlvI8KICBzd2l0Y2hNb2RlKG1vZGUpIHsKICAgIHRoaXMubW9kZSA9IG1vZGU7CiAgICBpZiAobW9kZSA9PT0gImJydXNoIiB8fCBtb2RlID09PSAiZXJhc2VyIikgewogICAgICB0aGlzLmFkZEV2ZW50KCk7CiAgICAgIHRoaXMuY3Vyckl0ZW0uYmdJbWcgJiYgdGhpcy5jdXJySXRlbS5iZ0ltZy5kcmFnZ2FibGUoZmFsc2UpOwogICAgfQogICAgaWYgKG1vZGUgPT09ICJtb3Zlb2JqZWN0IikgewogICAgICB0aGlzLnJlbW92ZVN0YWdlRXZlbnRzKCk7CiAgICAgIHRoaXMuc2V0Q3Vyc29yU3R5bGUoInBvaW50ZXIiKTsKICAgICAgdGhpcy5jdXJySXRlbS5iZ0ltZy5kcmFnZ2FibGUodHJ1ZSk7CiAgICB9CgogICAgaWYgKG1vZGUgPT09ICJyZXNldCIpIHsKICAgICAgdGhpcy5jdXJySXRlbS5zZXRSb3RhdGUoMCk7CiAgICAgIHJvdGF0ZUFyb3VuZENlbnRlcih0aGlzLmN1cnJJdGVtLmJnSW1nLCAwKTsKICAgICAgbGV0IHN0YXRlID0gdGhpcy5jdXJySXRlbS5nZXRPcmlnaW5TdGF0ZSgpOwogICAgICB0aGlzLmxvYWRDYW52YXNGcm9tSlNPTihKU09OLnBhcnNlKHN0YXRlKSk7CiAgICAgIHRoaXMuY3Vyckl0ZW0uY2xlYXJIaXN0b3J5bGlzdCgpOwogICAgICB0aGlzLmN1cnJJdGVtLnNhdmUoSlNPTi5wYXJzZShzdGF0ZSkpOwogICAgICB0aGlzLnN3aXRjaE1vZGUoImJydXNoIik7CiAgICB9CiAgfSwKICAvLyDorr7nva7pvKDmoIfmoLflvI8KICBzZXRDdXJzb3JTdHlsZSh0eXBlKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAicG9pbnRlciI6CiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAicG9pbnRlciI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImRlZmF1bHQiOgogICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gInBvaW50ZXIiOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gInBvaW50ZXIiOwogICAgICAgIGJyZWFrOwogICAgfQogIH0sCiAgLy8g6K6+572u6IOM5pmv5Zu+54mH56e75YqoCiAgbW92ZUJnSW1nKCkgewogICAgLy8gY29uc29sZS5sb2coInRoaXMuc3RhZ2UiLCB0aGlzLnN0YWdlLCB0aGlzLnN0YWdlLmxpc3RlbmluZyk7CiAgICAvLyB0aGlzLnN0YWdlLmxpc3RlbmluZyhmYWxzZSk7CiAgICAvLyB0aGlzLmlzTW92aW5nQmdJbWcgPSB0cnVlOwogICAgdGhpcy5yZW1vdmVTdGFnZUV2ZW50cygpOwogICAgdGhpcy5jdXJySXRlbS5iZ0ltZy5kcmFnZ2FibGUodHJ1ZSk7CiAgICB0aGlzLnNldEN1cnNvclN0eWxlKCJwb2ludGVyIik7CiAgfSwKICAvLyDml4vovawKICByb3RhdGVUbyh0eXBlKSB7CiAgICAvLyDml4vovazml7Yg57yp5pS+5bGe5oCn5Li6MQogICAgdGhpcy5zZXRab29tKCJub29wIik7CiAgICB0aGlzLmN1cnJJdGVtLnJvdGF0ZVRvKHR5cGUpOwogICAgY29uc3QgeyByb3RhdGUgfSA9IHRoaXMuY3Vyckl0ZW07CiAgICByb3RhdGVBcm91bmRDZW50ZXIodGhpcy5mcmVlRHJhd0xheWVyLCByb3RhdGUpOwogICAgdGhpcy5zdGFnZS5iYXRjaERyYXcoKTsKICB9LAogIC8vIOaUvuWkp+e8qeWwjwogIHNldFpvb20odHlwZSkgewogICAgbGV0IHpvb207CiAgICBpZiAodHlwZSA9PT0gIm5vb3AiKSB7CiAgICAgIHpvb20gPSAxOwogICAgfSBlbHNlIHsKICAgICAgem9vbSA9IHRoaXMuc3RhZ2UuZ2V0QXR0cigic2NhbGVYIikgfHwgMTsKICAgICAgaWYgKHR5cGUgPT0gIm91dCIpIHsKICAgICAgICAvLyDmlL7lpKcKICAgICAgICB6b29tID0gem9vbSArIHRoaXMuem9vbVN0ZXA7CiAgICAgICAgem9vbSA9IE1hdGgubWluKDMsIHpvb20pOyAvL+acgOWkp+aYr+WOn+adpeeahDPlgI0KICAgICAgfQogICAgICBpZiAodHlwZSA9PT0gImluIikgewogICAgICAgIHpvb20gPSB6b29tIC0gdGhpcy56b29tU3RlcDsKICAgICAgICB6b29tID0gTWF0aC5tYXgoMC4xLCB6b29tKTsgLy/mnIDlsI/kuLrljp/mnaXnmoQxLzEwCiAgICAgIH0KICAgIH0KICAgIHRoaXMuc3RhZ2Uuc2NhbGUoewogICAgICB4OiB6b29tLAogICAgICB5OiB6b29tCiAgICB9KTsKICAgIHRoaXMuc3RhZ2UuYmF0Y2hEcmF3KCk7CiAgfSwKICAvLyDnp7vpmaRzdGFnZeS6i+S7tuebkeWQrAogIHJlbW92ZVN0YWdlRXZlbnRzKCkgewogICAgdGhpcy5zdGFnZS5vZmYoIm1vdXNlZG93biIpOwogICAgdGhpcy5zdGFnZS5vZmYoIm1vdXNlbW92ZSIpOwogICAgdGhpcy5zdGFnZS5vZmYoIm1vdXNldXAiKTsKICB9LAogIC8vIOS6i+S7tuebkeWQrAogIGFkZEV2ZW50KCkgewogICAgbGV0IGlzUGFpbnQgPSBmYWxzZTsKICAgIGxldCBsYXN0TGluZTsKICAgIHRoaXMuc3RhZ2Uub24oIm1vdXNlZG93biIsICgpID0+IHsKICAgICAgaXNQYWludCA9IHRydWU7CiAgICAgIGxldCBwb3MgPSB0aGlzLnN0YWdlLmdldFBvaW50ZXJQb3NpdGlvbigpOwogICAgICBsZXQgb2xkU2NhbGUgPSB0aGlzLnN0YWdlLnNjYWxlWCgpOwogICAgICBsYXN0TGluZSA9IG5ldyBLb252YS5MaW5lKHsKICAgICAgICBzdHJva2U6ICIjZGY0YjI2IiwKICAgICAgICBzdHJva2VXaWR0aDogNSwKICAgICAgICBnbG9iYWxDb21wb3NpdGVPcGVyYXRpb246CiAgICAgICAgICB0aGlzLm1vZGUgPT09ICJicnVzaCIgPyAic291cmNlLW92ZXIiIDogImRlc3RpbmF0aW9uLW91dCIsCiAgICAgICAgcG9pbnRzOiBbCiAgICAgICAgICBwb3MueCAvIG9sZFNjYWxlIC0gdGhpcy5zdGFnZS54KCkgLyBvbGRTY2FsZSwKICAgICAgICAgIHBvcy55IC8gb2xkU2NhbGUgLSB0aGlzLnN0YWdlLnkoKSAvIG9sZFNjYWxlCiAgICAgICAgXQogICAgICB9KTsKICAgICAgdGhpcy5mcmVlRHJhd0xheWVyLmFkZChsYXN0TGluZSk7CiAgICB9KTsKICAgIHRoaXMuc3RhZ2Uub24oIm1vdXNldXAiLCAoKSA9PiB7CiAgICAgIGlzUGFpbnQgPSBmYWxzZTsKICAgICAgdGhpcy5zYXZlQ3Vyckl0ZW1TdGF0ZSgpOwogICAgfSk7CiAgICB0aGlzLnN0YWdlLm9uKCJtb3VzZW1vdmUiLCAoKSA9PiB7CiAgICAgIGxldCBvbGRTY2FsZSA9IHRoaXMuc3RhZ2Uuc2NhbGVYKCk7CiAgICAgIGlmICghaXNQYWludCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICAvLyDnoa7kv53nvKnmlL7lip/og73og73mraPluLjkvb/nlKgKICAgICAgY29uc3QgcG9zID0gdGhpcy5zdGFnZS5nZXRQb2ludGVyUG9zaXRpb24oKTsKICAgICAgbGV0IG5ld1BvaW50cyA9IGxhc3RMaW5lCiAgICAgICAgLnBvaW50cygpCiAgICAgICAgLmNvbmNhdChbCiAgICAgICAgICBwb3MueCAvIG9sZFNjYWxlIC0gdGhpcy5zdGFnZS54KCkgLyBvbGRTY2FsZSwKICAgICAgICAgIHBvcy55IC8gb2xkU2NhbGUgLSB0aGlzLnN0YWdlLnkoKSAvIG9sZFNjYWxlCiAgICAgICAgXSk7CiAgICAgIGxhc3RMaW5lLnBvaW50cyhuZXdQb2ludHMpOwogICAgICB0aGlzLmZyZWVEcmF3TGF5ZXIuYmF0Y2hEcmF3KCk7CiAgICB9KTsKICB9LAogIC8vIOWPjeW6j+WIl+WMlgogIGxvYWRDYW52YXNGcm9tSlNPTihzdGF0ZSkgewogICAgaWYgKCFzdGF0ZSkgcmV0dXJuOwogICAgdGhpcy5zdGFnZSA9IEtvbnZhLk5vZGUuY3JlYXRlKHN0YXRlLCAiaW1hZ2UtY2FudmFzIik7CiAgICAvLyDmt7vliqDog4zmma/lm74KICAgIC8vIOiDjOaZr+WbvueJh+S4jeS8muS/neWtmOWcqEpTT07lr7nosaHph4wKICAgIHRoaXMuYmdJbWdMYXllciA9IHRoaXMuc3RhZ2UuZ2V0TGF5ZXJzKClbMF07CiAgICB0aGlzLmJnSW1nTGF5ZXIuYWRkKHRoaXMuY3Vyckl0ZW0uYmdJbWcpOwogICAgdGhpcy5iZ0ltZ0xheWVyLmJhdGNoRHJhdygpOwogICAgLy8gdGhpcy5iZ0ltZ0xheWVyLmJhdGNoRHJhdygpOwogICAgdGhpcy5mcmVlRHJhd0xheWVyID0gdGhpcy5zdGFnZS5nZXRMYXllcnMoKVsxXTsKICAgIHRoaXMuZnJlZURyYXdMYXllci5iYXRjaERyYXcoKTsKICAgIHRoaXMuaXNTd2l0Y2hpbmcgPSBmYWxzZTsKICB9LAogIHNhdmVDdXJySXRlbVN0YXRlKCkgewogICAgaWYgKCF0aGlzLmN1cnJJdGVtKSByZXR1cm47CiAgICBsZXQgc3RhdGUgPSB0aGlzLnN0YWdlLnRvSlNPTigpOwogICAgdGhpcy5jdXJySXRlbS5zYXZlKHN0YXRlKTsKICB9LAogIHRvTmV4dCgpIHsKICAgIC8vIHRoaXMuc2F2ZUN1cnJJdGVtU3RhdGUoKTsKICAgIHRoaXMuc3dpdGNoSW1hZ2UodGhpcy5jdXJySW5kZXggKyAxKTsKICB9LAogIHRvUHJldigpIHsKICAgIC8vIHRoaXMuc2F2ZUN1cnJJdGVtU3RhdGUoKTsKICAgIHRoaXMuc3dpdGNoSW1hZ2UodGhpcy5jdXJySW5kZXggLSAxKTsKICB9LAogIHRvRGF0YVVybCgpIHsKICAgIGNvbnN0IGltZ1VybCA9IHRoaXMuc3RhZ2UudG9EYXRhVVJMKHsKICAgICAgeDogMCwKICAgICAgeTogMCwKICAgICAgd2lkdGg6IENfV0lEVEgsCiAgICAgIGhlaWdodDogQ19IRUlHSFQsCiAgICAgIHBpeGVsUmF0aW86IDEgLy8g5Zu+54mH6LSo6YePCiAgICB9KTsKCiAgICB0aGlzLiRlbWl0KCJlbWl0TG9hZEltZyIsIGltZ1VybCk7CiAgfSwKICAvLyDliqDovb3og4zmma/lm77niYcKICBsb2FkQmFja0ltYWdlKGl0ZW1PYmopIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzbG92ZSkgPT4gewogICAgICBjb25zdCB7IGltYWdlSW5mbyB9ID0gaXRlbU9iajsKICAgICAgY29uc3QgeyBzY2FsZSB9ID0gaW1hZ2VJbmZvOwogICAgICBLb252YS5JbWFnZS5mcm9tVVJMKGl0ZW1PYmoub3JpZ2luVXJsLCAoa0ltZykgPT4gewogICAgICAgIGtJbWcuc2V0QXR0cnMoewogICAgICAgICAgLy8g6K6+572u5bGF5LitCiAgICAgICAgICB4OiBnZXRCZ0ltZ1hZT2Zmc2V0KHNjYWxlLndpZHRoLCBudWxsLCB0aGlzLkNfV0lEVEgsIDcwMCksCiAgICAgICAgICB5OiBnZXRCZ0ltZ1hZT2Zmc2V0KG51bGwsIHNjYWxlLmhlaWdodCwgdGhpcy5DX1dJRFRILCA3MDApLAogICAgICAgICAgaWQ6ICJiZ0ltZyIsCiAgICAgICAgICBkcmFnZ2FibGU6IGZhbHNlLAogICAgICAgICAgc291cmNlOiBpdGVtT2JqLm9yaWdpblVybCwKICAgICAgICAgIHdpZHRoOiBzY2FsZS53aWR0aCwKICAgICAgICAgIGhlaWdodDogc2NhbGUuaGVpZ2h0CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5iZ0ltZ0xheWVyLmFkZChrSW1nKTsKICAgICAgICB0aGlzLmJnSW1nTGF5ZXIuYmF0Y2hEcmF3KCk7CiAgICAgICAgdGhpcy5jdXJySXRlbS5iZ0ltZyA9IGtJbWc7CiAgICAgICAgcmVzbG92ZSgpOwogICAgICB9KTsKICAgIH0pOwogIH0sCgogIGFmdGVyU3dpdGNoKGluZGV4LCBpdGVtT2JqLCBpc0ZpcnN0UmVuZGVyID0gZmFsc2UpIHsKICAgIGlmIChpc0ZpcnN0UmVuZGVyKSB7CiAgICAgIC8vIOmmluasoea4suafkzsKICAgICAgaWYgKCF0aGlzLmJnSW1nTGF5ZXIpIHsKICAgICAgICBsZXQgYmdJbWdMYXllciA9IG5ldyBLb252YS5MYXllcigpOwogICAgICAgIHRoaXMuYmdJbWdMYXllciA9IGJnSW1nTGF5ZXI7CiAgICAgICAgdGhpcy5sb2FkQmFja0ltYWdlKGl0ZW1PYmosIHRoaXMuaW5pdEZyZWVEcmF3Q2FudmFzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmJnSW1nTGF5ZXIgJiYgdGhpcy5iZ0ltZ0xheWVyLnJlbW92ZUNoaWxkcmVuKCk7CiAgICAgICAgdGhpcy5sb2FkQmFja0ltYWdlKGl0ZW1PYmopLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy5zYXZlQ3Vyckl0ZW1TdGF0ZSgpOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMuY2xlYXJGcmVlRHJhd0xheWVyKCk7CiAgICAgIHRoaXMuaXNTd2l0Y2hpbmcgPSBmYWxzZTsKICAgIH0KICB9LAogIC8vIOiuvue9rnN0YWdl5a696auYCiAgc2V0U3RhZ2VXSCh3LCBoKSB7CiAgICB0aGlzLnN0YWdlLndpZHRoKHcpOwogICAgdGhpcy5zdGFnZS5oZWlnaHQoaCk7CiAgfSwKICAvLyDmuIXpmaTnlLvnrJTlsYIKICBjbGVhckZyZWVEcmF3TGF5ZXIoKSB7CiAgICBpZiAodGhpcy5mcmVlRHJhd0xheWVyKSB7CiAgICAgIHRoaXMuZnJlZURyYXdMYXllci5yZW1vdmVDaGlsZHJlbigpOwogICAgICB0aGlzLmZyZWVEcmF3TGF5ZXIuZHJhdygpOwogICAgfQogIH0sCiAgLy8g5YiH5o2i5Zu+5bGCCiAgc3dpdGNoSW1hZ2UoaW5kZXgpIHsKICAgIGNvbnNvbGUubG9nKCI9PT09PXN3aXRjaEltYWdlPT09PT0iLCBpbmRleCk7CiAgICBpZiAoaW5kZXggPCAtMSkgcmV0dXJuOwogICAgaWYgKHRoaXMuaXNTd2l0Y2hpbmcpIHJldHVybjsKICAgIGxldCBpbWcgPSB0aGlzLmltYWdlTGlzdFtpbmRleF07CiAgICBpZiAoIWltZykgewogICAgICBjb25zb2xlLndhcm4oIuWbvueJh+S4jeWtmOWcqCIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgaXRlbU9iajsKICAgIGlmIChpbWcgJiYgIWltZy5pc1JlbmRlcikgewogICAgICB0aGlzLmlzU3dpdGNoaW5nID0gdHJ1ZTsKICAgICAgLy8g6aaW5qyh5riy5p+TCiAgICAgIGl0ZW1PYmogPSBuZXcgSXRlbSgKICAgICAgICB7CiAgICAgICAgICB1cmw6IHRoaXMuaW1hZ2VMaXN0W2luZGV4XS51cmwsCiAgICAgICAgICBjb25XSDogeyB3aWR0aDogdGhpcy5DX1dJRFRILCBoZWlnaHQ6IDcwMCB9CiAgICAgICAgfSwKICAgICAgICAoKSA9PiB0aGlzLmFmdGVyU3dpdGNoKGluZGV4LCBpdGVtT2JqLCB0cnVlKQogICAgICApOwogICAgICBjb25zb2xlLmxvZygiPT09Pemmluasoea4suafkz09PT09Iik7CiAgICAgIHRoaXMuY3VyckluZGV4ID0gaW5kZXg7CiAgICAgIHRoaXMuY3Vyckl0ZW0gPSBpdGVtT2JqOwogICAgICB0aGlzLml0ZW1MaXN0W3RoaXMuY3VyckluZGV4XSA9IGl0ZW1PYmo7CiAgICAgIHRoaXMuJHNldCgKICAgICAgICB0aGlzLmltYWdlTGlzdCwKICAgICAgICBpbmRleCwKICAgICAgICBPYmplY3QuYXNzaWduKHt9LCB7IC4uLnRoaXMuaW1hZ2VMaXN0W2luZGV4XSB9LCB7IGlzUmVuZGVyOiB0cnVlIH0pCiAgICAgICk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmlzU3dpdGNoaW5nID0gdHJ1ZTsKICAgICAgdGhpcy5jdXJySW5kZXggPSBpbmRleDsKICAgICAgLy8g6Z2e6aaW5qyh5riy5p+TCiAgICAgIGNvbnNvbGUubG9nKCI9PT09PT3pnZ7pppbmrKHmuLLmn5M9PT09PSIpOwogICAgICB0aGlzLmN1cnJJdGVtID0gdGhpcy5pdGVtTGlzdFt0aGlzLmN1cnJJbmRleF07CiAgICAgIGxldCBsYXN0U3RhdGUgPSB0aGlzLmN1cnJJdGVtLmdldExhc3RTdGF0ZSgpOwogICAgICBjb25zb2xlLmxvZygibGFzdFN0YXRlIiwgbGFzdFN0YXRlKTsKICAgICAgdGhpcy5sb2FkQ2FudmFzRnJvbUpTT04oSlNPTi5wYXJzZShsYXN0U3RhdGUpKTsKICAgIH0KICAgIHRoaXMuc2V0Wm9vbSgibm9vcCIpOwogICAgdGhpcy5zd2l0Y2hNb2RlKCJicnVzaCIpOwogIH0KfTsKZXhwb3J0IGRlZmF1bHQgewogIG1ldGhvZHMsCiAgbW91bnRlZCgpIHsKICAgIGNvbnN0IHsgd2lkdGggfSA9IHRoaXMuJHJlZnMuaW1hZ2VfZGVjb3JhdG9yX3dyYXAuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAvLyBmaXJzdCB3ZSBuZWVkIEtvbnZhIGNvcmUgdGhpbmdzOiBzdGFnZSBhbmQgbGF5ZXIKICAgIGxldCBzdGFnZSA9IG5ldyBLb252YS5TdGFnZSh7CiAgICAgIGNvbnRhaW5lcjogImltYWdlLWNhbnZhcyIsCiAgICAgIHNjYWxlWTogMSwKICAgICAgc2NhbGVYOiAxLAogICAgICBjZW50ZXJlZFNjYWxpbmc6IHRydWUsCiAgICAgIC8vIOehruWumuS6hmNhbnZhc+eahOWuvemrmAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0OiA3MDAKICAgICAgLy8gZHJhZ2dhYmxlOiB0cnVlCiAgICB9KTsKCiAgICB0aGlzLkNfV0lEVEggPSB3aWR0aDsKICAgIHRoaXMuc3RhZ2UgPSBzdGFnZTsKCiAgICAvLyDog4zmma/lsYIKICAgIHRoaXMuYmdJbWdMYXllciA9IG5ldyBLb252YS5MYXllcih7CiAgICAgIGlkOiAiYmdfaW1hZ2VfbGF5ZXIiCiAgICB9KTsKCiAgICAvLyDnu5jnlLvlsYIKICAgIHRoaXMuZnJlZURyYXdMYXllciA9IG5ldyBLb252YS5MYXllcih7CiAgICAgIGlkOiAiZnJlZV9kcmF3X2xheWVyIiwKICAgICAgYmFja2dyb3VuZENvbG9yOiAicmVkIgogICAgfSk7CgogICAgdGhpcy5zdGFnZS5hZGQodGhpcy5iZ0ltZ0xheWVyKTsKICAgIHRoaXMuc3RhZ2UuYWRkKHRoaXMuZnJlZURyYXdMYXllcik7CgogICAgdGhpcy5hZGRFdmVudCgpOwoKICAgIC8vIOe7hOijheaVsOaNruagvOW8jwogICAgdGhpcy5pbWFnZUxpc3QgPSB0aGlzLmltYWdlTGlzdC5tYXAoKGQpID0+IHsKICAgICAgcmV0dXJuIHsKICAgICAgICBpc1JlbmRlcjogZmFsc2UsCiAgICAgICAgdXJsOiBkCiAgICAgIH07CiAgICB9KTsKICAgIHRoaXMudG9OZXh0KCk7CiAgICAvLyB0aGlzLmluaXRGcmVlRHJhd0NhbnZhcygpOwogICAgLy8gdGhpcy4oKTsKCiAgICAvLyDliJ3lp4vljJbml7blgJnpnIDopoHlvILmraUKICAgIC8vIHNldFRpbWVvdXQoKCkgPT4ge30sIDEwMCk7CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbW9kZTogImJydXNoIiwKICAgICAgaXNNb3ZpbmdCZ0ltZzogZmFsc2UsCiAgICAgIHpvb21TdGVwOiAwLjEsCiAgICAgIHN0YWdlOiBudWxsLAogICAgICBpbWdVcmw6IG51bGwsCiAgICAgIGltYWdlTGlzdDogaW1hZ2VMaXN0LAogICAgICBjdXJySW5kZXg6IC0xLAogICAgICBjdXJySXRlbTogbnVsbCwKICAgICAgaXRlbUxpc3Q6IFtdLAogICAgICBjb25XSDogeyB3aWR0aDogODAwLCBoZWlnaHQ6IDYwMCB9LAogICAgICBmcmVlRHJhd0xheWVyOiBudWxsLAogICAgICBiZ0ltZ0xheWVyOiBudWxsLAogICAgICBpc1N3aXRjaGluZzogZmFsc2UKICAgIH07CiAgfSwKICBjb21wb25lbnRzOiB7fQp9Owo="},{"version":3,"sources":["ImgDecorator.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ImgDecorator.vue","sourceRoot":"src/page/Konva","sourcesContent":["<template>\n  <div>\n    <div id=\"image-decorator-wrap\" ref=\"image_decorator_wrap\">\n      <div id=\"image-canvas\"></div>\n    </div>\n\n    <div id=\"menu\">\n      <!-- <menu-color\n        @click=\"switchMode\"\n        class=\"menu_item\"\n        :colorList=\"myConfig && myConfig.colorList\"\n        :mode=\"mode\"\n        @changeConfig=\"changeConfig\"\n      >\n      </menu-color> -->\n    </div>\n    <button @click=\"switchMode('brush')\">画笔模式</button>\n    <button @click=\"switchMode('eraser')\">橡皮擦模式</button>\n    <button @click=\"switchMode('moveobject')\">移动背景图片</button>\n    <button @click=\"switchMode('reset')\">重置</button>\n    <img :src=\"imgUrl\" class=\"img\" />\n    <button @click=\"toDataUrl\">点我下载</button>\n    <button @click=\"toNext\">下一张</button>\n    <button @click=\"toPrev\">上一张</button>\n    <button>{{ currIndex }}</button>\n    <button @click=\"setZoom('out')\">放大</button>\n    <button @click=\"setZoom('in')\">缩小</button>\n    <button @click=\"rotateTo('left')\">向左</button>\n    <button @click=\"rotateTo('right')\">向右</button>\n    <el-button size=\"mini\" @click=\"preview\">预览</el-button>\n  </div>\n</template>\n\n<script>\nimport Konva from \"konva\";\nimport {\n  imageList,\n  getBgImgXYOffset,\n  C_WIDTH,\n  C_HEIGHT,\n  rotateAroundCenter\n} from \"../util.js\";\nimport Item from \"../Item.js\";\n\nconst methods = {\n  preview() {\n    this.$emit(\"preview\");\n  },\n  // 切换图片复原操作\n  // 切换工具栏模式\n  switchMode(mode) {\n    this.mode = mode;\n    if (mode === \"brush\" || mode === \"eraser\") {\n      this.addEvent();\n      this.currItem.bgImg && this.currItem.bgImg.draggable(false);\n    }\n    if (mode === \"moveobject\") {\n      this.removeStageEvents();\n      this.setCursorStyle(\"pointer\");\n      this.currItem.bgImg.draggable(true);\n    }\n\n    if (mode === \"reset\") {\n      this.currItem.setRotate(0);\n      rotateAroundCenter(this.currItem.bgImg, 0);\n      let state = this.currItem.getOriginState();\n      this.loadCanvasFromJSON(JSON.parse(state));\n      this.currItem.clearHistorylist();\n      this.currItem.save(JSON.parse(state));\n      this.switchMode(\"brush\");\n    }\n  },\n  // 设置鼠标样式\n  setCursorStyle(type) {\n    switch (type) {\n      case \"pointer\":\n        document.body.style.cursor = \"pointer\";\n        break;\n      case \"default\":\n        document.body.style.cursor = \"pointer\";\n        break;\n      default:\n        document.body.style.cursor = \"pointer\";\n        break;\n    }\n  },\n  // 设置背景图片移动\n  moveBgImg() {\n    // console.log(\"this.stage\", this.stage, this.stage.listening);\n    // this.stage.listening(false);\n    // this.isMovingBgImg = true;\n    this.removeStageEvents();\n    this.currItem.bgImg.draggable(true);\n    this.setCursorStyle(\"pointer\");\n  },\n  // 旋转\n  rotateTo(type) {\n    // 旋转时 缩放属性为1\n    this.setZoom(\"noop\");\n    this.currItem.rotateTo(type);\n    const { rotate } = this.currItem;\n    rotateAroundCenter(this.freeDrawLayer, rotate);\n    this.stage.batchDraw();\n  },\n  // 放大缩小\n  setZoom(type) {\n    let zoom;\n    if (type === \"noop\") {\n      zoom = 1;\n    } else {\n      zoom = this.stage.getAttr(\"scaleX\") || 1;\n      if (type == \"out\") {\n        // 放大\n        zoom = zoom + this.zoomStep;\n        zoom = Math.min(3, zoom); //最大是原来的3倍\n      }\n      if (type === \"in\") {\n        zoom = zoom - this.zoomStep;\n        zoom = Math.max(0.1, zoom); //最小为原来的1/10\n      }\n    }\n    this.stage.scale({\n      x: zoom,\n      y: zoom\n    });\n    this.stage.batchDraw();\n  },\n  // 移除stage事件监听\n  removeStageEvents() {\n    this.stage.off(\"mousedown\");\n    this.stage.off(\"mousemove\");\n    this.stage.off(\"mouseup\");\n  },\n  // 事件监听\n  addEvent() {\n    let isPaint = false;\n    let lastLine;\n    this.stage.on(\"mousedown\", () => {\n      isPaint = true;\n      let pos = this.stage.getPointerPosition();\n      let oldScale = this.stage.scaleX();\n      lastLine = new Konva.Line({\n        stroke: \"#df4b26\",\n        strokeWidth: 5,\n        globalCompositeOperation:\n          this.mode === \"brush\" ? \"source-over\" : \"destination-out\",\n        points: [\n          pos.x / oldScale - this.stage.x() / oldScale,\n          pos.y / oldScale - this.stage.y() / oldScale\n        ]\n      });\n      this.freeDrawLayer.add(lastLine);\n    });\n    this.stage.on(\"mouseup\", () => {\n      isPaint = false;\n      this.saveCurrItemState();\n    });\n    this.stage.on(\"mousemove\", () => {\n      let oldScale = this.stage.scaleX();\n      if (!isPaint) {\n        return;\n      }\n      // 确保缩放功能能正常使用\n      const pos = this.stage.getPointerPosition();\n      let newPoints = lastLine\n        .points()\n        .concat([\n          pos.x / oldScale - this.stage.x() / oldScale,\n          pos.y / oldScale - this.stage.y() / oldScale\n        ]);\n      lastLine.points(newPoints);\n      this.freeDrawLayer.batchDraw();\n    });\n  },\n  // 反序列化\n  loadCanvasFromJSON(state) {\n    if (!state) return;\n    this.stage = Konva.Node.create(state, \"image-canvas\");\n    // 添加背景图\n    // 背景图片不会保存在JSON对象里\n    this.bgImgLayer = this.stage.getLayers()[0];\n    this.bgImgLayer.add(this.currItem.bgImg);\n    this.bgImgLayer.batchDraw();\n    // this.bgImgLayer.batchDraw();\n    this.freeDrawLayer = this.stage.getLayers()[1];\n    this.freeDrawLayer.batchDraw();\n    this.isSwitching = false;\n  },\n  saveCurrItemState() {\n    if (!this.currItem) return;\n    let state = this.stage.toJSON();\n    this.currItem.save(state);\n  },\n  toNext() {\n    // this.saveCurrItemState();\n    this.switchImage(this.currIndex + 1);\n  },\n  toPrev() {\n    // this.saveCurrItemState();\n    this.switchImage(this.currIndex - 1);\n  },\n  toDataUrl() {\n    const imgUrl = this.stage.toDataURL({\n      x: 0,\n      y: 0,\n      width: C_WIDTH,\n      height: C_HEIGHT,\n      pixelRatio: 1 // 图片质量\n    });\n\n    this.$emit(\"emitLoadImg\", imgUrl);\n  },\n  // 加载背景图片\n  loadBackImage(itemObj) {\n    return new Promise((reslove) => {\n      const { imageInfo } = itemObj;\n      const { scale } = imageInfo;\n      Konva.Image.fromURL(itemObj.originUrl, (kImg) => {\n        kImg.setAttrs({\n          // 设置居中\n          x: getBgImgXYOffset(scale.width, null, this.C_WIDTH, 700),\n          y: getBgImgXYOffset(null, scale.height, this.C_WIDTH, 700),\n          id: \"bgImg\",\n          draggable: false,\n          source: itemObj.originUrl,\n          width: scale.width,\n          height: scale.height\n        });\n        this.bgImgLayer.add(kImg);\n        this.bgImgLayer.batchDraw();\n        this.currItem.bgImg = kImg;\n        reslove();\n      });\n    });\n  },\n\n  afterSwitch(index, itemObj, isFirstRender = false) {\n    if (isFirstRender) {\n      // 首次渲染;\n      if (!this.bgImgLayer) {\n        let bgImgLayer = new Konva.Layer();\n        this.bgImgLayer = bgImgLayer;\n        this.loadBackImage(itemObj, this.initFreeDrawCanvas);\n      } else {\n        this.bgImgLayer && this.bgImgLayer.removeChildren();\n        this.loadBackImage(itemObj).then(() => {\n          this.saveCurrItemState();\n        });\n      }\n      this.clearFreeDrawLayer();\n      this.isSwitching = false;\n    }\n  },\n  // 设置stage宽高\n  setStageWH(w, h) {\n    this.stage.width(w);\n    this.stage.height(h);\n  },\n  // 清除画笔层\n  clearFreeDrawLayer() {\n    if (this.freeDrawLayer) {\n      this.freeDrawLayer.removeChildren();\n      this.freeDrawLayer.draw();\n    }\n  },\n  // 切换图层\n  switchImage(index) {\n    console.log(\"=====switchImage=====\", index);\n    if (index < -1) return;\n    if (this.isSwitching) return;\n    let img = this.imageList[index];\n    if (!img) {\n      console.warn(\"图片不存在\");\n      return;\n    }\n    let itemObj;\n    if (img && !img.isRender) {\n      this.isSwitching = true;\n      // 首次渲染\n      itemObj = new Item(\n        {\n          url: this.imageList[index].url,\n          conWH: { width: this.C_WIDTH, height: 700 }\n        },\n        () => this.afterSwitch(index, itemObj, true)\n      );\n      console.log(\"====首次渲染=====\");\n      this.currIndex = index;\n      this.currItem = itemObj;\n      this.itemList[this.currIndex] = itemObj;\n      this.$set(\n        this.imageList,\n        index,\n        Object.assign({}, { ...this.imageList[index] }, { isRender: true })\n      );\n    } else {\n      this.isSwitching = true;\n      this.currIndex = index;\n      // 非首次渲染\n      console.log(\"======非首次渲染=====\");\n      this.currItem = this.itemList[this.currIndex];\n      let lastState = this.currItem.getLastState();\n      console.log(\"lastState\", lastState);\n      this.loadCanvasFromJSON(JSON.parse(lastState));\n    }\n    this.setZoom(\"noop\");\n    this.switchMode(\"brush\");\n  }\n};\nexport default {\n  methods,\n  mounted() {\n    const { width } = this.$refs.image_decorator_wrap.getBoundingClientRect();\n    // first we need Konva core things: stage and layer\n    let stage = new Konva.Stage({\n      container: \"image-canvas\",\n      scaleY: 1,\n      scaleX: 1,\n      centeredScaling: true,\n      // 确定了canvas的宽高\n      width,\n      height: 700\n      // draggable: true\n    });\n\n    this.C_WIDTH = width;\n    this.stage = stage;\n\n    // 背景层\n    this.bgImgLayer = new Konva.Layer({\n      id: \"bg_image_layer\"\n    });\n\n    // 绘画层\n    this.freeDrawLayer = new Konva.Layer({\n      id: \"free_draw_layer\",\n      backgroundColor: \"red\"\n    });\n\n    this.stage.add(this.bgImgLayer);\n    this.stage.add(this.freeDrawLayer);\n\n    this.addEvent();\n\n    // 组装数据格式\n    this.imageList = this.imageList.map((d) => {\n      return {\n        isRender: false,\n        url: d\n      };\n    });\n    this.toNext();\n    // this.initFreeDrawCanvas();\n    // this.();\n\n    // 初始化时候需要异步\n    // setTimeout(() => {}, 100);\n  },\n  data() {\n    return {\n      mode: \"brush\",\n      isMovingBgImg: false,\n      zoomStep: 0.1,\n      stage: null,\n      imgUrl: null,\n      imageList: imageList,\n      currIndex: -1,\n      currItem: null,\n      itemList: [],\n      conWH: { width: 800, height: 600 },\n      freeDrawLayer: null,\n      bgImgLayer: null,\n      isSwitching: false\n    };\n  },\n  components: {}\n};\n</script>\n\n<style lang=\"less\" scoped>\n#image-decorator-wrap {\n  // border: 1px solid red;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 0 auto;\n  overflow: hidden;\n  background: #fff;\n  // background-image: linear-gradient(\n  //     45deg,\n  //     #ccc 25%,\n  //     transparent 25%,\n  //     transparent 75%,\n  //     #ccc 75%,\n  //     #ccc\n  //   ),\n  //   linear-gradient(\n  //     45deg,\n  //     #ccc 25%,\n  //     transparent 25%,\n  //     transparent 75%,\n  //     #ccc 75%,\n  //     #ccc\n  //   );\n  // background-size: 24px 24px;\n  // background-position: 0 0, 12px 12px;\n  // #image-canvas {\n  //   border: 1px solid yellow;\n  // }\n  // .img {\n  //   margin-top: 20px;\n  //   border: 1px solid blue;\n  // }\n}\n</style>\n"]}]}