{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/eraser.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/eraser.vue","mtime":1600076897247},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1592981491866}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBpY29ucyBmcm9tICIuLi9pY29ucy5qcyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogImVyYXNlciIsCiAgcHJvcHM6IHsKICAgIG1vZGU6IHsKICAgICAgZGVmYXVsdDogIiIsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKICAgIGNhbnZhczogewogICAgICBkZWZhdWx0OiAoKSA9PiB7fSwKICAgICAgdHlwZTogT2JqZWN0CiAgICB9CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZXJhc2VySWNvbjogaWNvbnMuZXJhc2VyLAogICAgICBpc1Nob3c6IGZhbHNlLAogICAgICBob3Zlck9iajogbnVsbAogICAgfTsKICB9LAoKICB3YXRjaDogewogICAgbW9kZShuZXdtb2RlKSB7CiAgICAgIGlmIChuZXdtb2RlID09PSAiZXJhc2VyIikgewogICAgICAgIHRoaXMuZXJhc2VySWNvbiA9IGljb25zLmFjdGl2ZUVyYXNlcjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVyYXNlckljb24gPSBpY29ucy5lcmFzZXI7CiAgICAgIH0KICAgIH0sCiAgICBjYW52YXMobmV3Q2FudmFzKSB7CiAgICAgIG5ld0NhbnZhcy5vbigibW91c2U6ZG93biIsIHRoaXMuZGVhbE1vdXNlZG93bik7CiAgICAgIG5ld0NhbnZhcy5vbigib2JqZWN0Om92ZXIiLCB0aGlzLmRlYWxNb3VzZW92ZXIpOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgZGVhbE1vdXNlZG93bihlKSB7CiAgICAgIC8vIOapoeearuaooeW8j++8jOenu+mZpOmAieS4reeahOWFg+e0oAogICAgICBpZiAodGhpcy5tb2RlID09PSAiZXJhc2VyIiAmJiBlLnRhcmdldCA9PT0gdGhpcy5ob3Zlck9iaikgewogICAgICAgIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzLmhvdmVyT2JqKTsKICAgICAgICB0aGlzLmhvdmVyT2JqID0gbnVsbDsKICAgICAgfQogICAgfSwKICAgIGRlYWxNb3VzZW92ZXIoZSkgewogICAgICAvLyDliKTmlq3mmK/lkKbmmK/mqaHnmq7mqKHlvI8KICAgICAgaWYgKHRoaXMubW9kZSAhPT0gImVyYXNlciIpIHJldHVybjsKCiAgICAgIGxldCB0YXJnZXQgPSBlLnRhcmdldDsKICAgICAgLy8g5Y+W5raI5LmL5YmNaG92ZXJPYmrnmoRob3ZlcuaViOaenAogICAgICBpZiAodGhpcy5ob3Zlck9iaikgewogICAgICAgIHRoaXMuaG92ZXJPYmouc3Ryb2tlID0gdGhpcy5ob3Zlck9iai5vcmlnU3Ryb2tlOwogICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpOwogICAgICB9CgogICAgICAvLyBob3ZlcuWvueixoeS4uueslOWIkgogICAgICBpZiAodGFyZ2V0LmdldCgidHlwZSIpID09PSAicGF0aCIpIHsKICAgICAgICB0YXJnZXQub3JpZ1N0cm9rZSA9IHRhcmdldC5zdHJva2U7CiAgICAgICAgLy8g6auY5Lqu5b6F5Yig6Zmk55qE56yU5YiSCiAgICAgICAgdGFyZ2V0LnN0cm9rZSA9ICIjOTk5IjsKICAgICAgICB0aGlzLmhvdmVyT2JqID0gdGFyZ2V0OwogICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpOwogICAgICB9CiAgICB9LAogICAgZGVhbENsaWNrKCkgewogICAgICB0aGlzLiRlbWl0KCJjbGljayIpOwogICAgfQogICAgLy8gdGhpcy5jYW52YXMuaXNEcmF3aW5nTW9kZSA9IHRydWU7CiAgICAvLyBjb25zdCBFcmFzZXJCcnVzaCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5QZW5jaWxCcnVzaCwgewogICAgLy8gICBfZmluYWxpemVBbmRBZGRQYXRoKCkgewogICAgLy8gICAgIGNvbnNvbGUubG9nKCJFcmFzZXJCcnVzaCIpOwogICAgLy8gICAgIGxldCBjdHggPSB0aGlzLmNhbnZhcy5jb250ZXh0VG9wOwogICAgLy8gICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgIC8vICAgICBpZiAodGhpcy5kZWNpbWF0ZSkgewogICAgLy8gICAgICAgdGhpcy5fcG9pbnRzID0gdGhpcy5kZWNpbWF0ZVBvaW50cyh0aGlzLl9wb2ludHMsIHRoaXMuZGVjaW1hdGUpOwogICAgLy8gICAgIH0KICAgIC8vICAgICBsZXQgcGF0aERhdGEgPSB0aGlzLmNvbnZlcnRQb2ludHNUb1NWR1BhdGgodGhpcy5fcG9pbnRzKS5qb2luKCIiKTsKICAgIC8vICAgICAvLyBjb25zb2xlLmxvZygicGF0aERhdGEiLCBwYXRoRGF0YSk7CiAgICAvLyAgICAgaWYgKHBhdGhEYXRhID09PSAiTSAwIDAgUSAwIDAgMCAwIEwgMCAwIikgewogICAgLy8gICAgICAgLy8gZG8gbm90IGNyZWF0ZSAwIHdpZHRoL2hlaWdodCBwYXRocywgYXMgdGhleSBhcmUKICAgIC8vICAgICAgIC8vIHJlbmRlcmVkIGluY29uc2lzdGVudGx5IGFjcm9zcyBicm93c2VycwogICAgLy8gICAgICAgLy8gRmlyZWZveCA0LCBmb3IgZXhhbXBsZSwgcmVuZGVycyBhIGRvdCwKICAgIC8vICAgICAgIC8vIHdoZXJlYXMgQ2hyb21lIDEwIHJlbmRlcnMgbm90aGluZwogICAgLy8gICAgICAgdGhpcy5jYW52YXMucmVxdWVzdFJlbmRlckFsbCgpOwogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICAgIH0KCiAgICAvLyAgICAgLy8gdXNlIGdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiB0byAnZmFrZScgZXJhc2VyCiAgICAvLyAgICAgbGV0IHBhdGggPSB0aGlzLmNyZWF0ZVBhdGgocGF0aERhdGEpOwogICAgLy8gICAgIC8vIGNvbnNvbGUubG9nKCJwYXRoIiwgcGF0aCk7CiAgICAvLyAgICAgcGF0aC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAiZGVzdGluYXRpb24tb3V0IjsKICAgIC8vICAgICBwYXRoLnNlbGVjdGFibGUgPSBmYWxzZTsKICAgIC8vICAgICBwYXRoLmV2ZW50ZWQgPSBmYWxzZTsKICAgIC8vICAgICBwYXRoLmFic29sdXRlUG9zaXRpb25lZCA9IHRydWU7CiAgICAvLyAgICAgcGF0aC5zZXQoewogICAgLy8gICAgICAgbmFtZVR5cGU6ICJlcmFzZXIiLAogICAgLy8gICAgICAgZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uOiAiZGVzdGluYXRpb24tb3V0IiwKICAgIC8vICAgICAgIG9wYWNpdHk6IDAKICAgIC8vICAgICAgIC8vIHN0cm9rZTogImdyZWVuIiwKICAgIC8vICAgICAgIC8vIHN0cm9rZVdpZHRoOiAyMAogICAgLy8gICAgIH0pOwogIH0KfTsK"},{"version":3,"sources":["eraser.vue"],"names":[],"mappings":";;;;;;;;;;AAUA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"eraser.vue","sourceRoot":"src/page/menu","sourcesContent":["<template>\n  <div>\n    <div class=\"menu_eraser\">\n      <div @click=\"dealClick\" v-html=\"eraserIcon\" class=\"eraser_icon\"></div>\n      <div class=\"color_box\" v-show=\"isShow\"></div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport icons from \"../icons.js\";\n\nexport default {\n  name: \"eraser\",\n  props: {\n    mode: {\n      default: \"\",\n      type: String\n    },\n    canvas: {\n      default: () => {},\n      type: Object\n    }\n  },\n  data() {\n    return {\n      eraserIcon: icons.eraser,\n      isShow: false,\n      hoverObj: null\n    };\n  },\n\n  watch: {\n    mode(newmode) {\n      if (newmode === \"eraser\") {\n        this.eraserIcon = icons.activeEraser;\n      } else {\n        this.eraserIcon = icons.eraser;\n      }\n    },\n    canvas(newCanvas) {\n      newCanvas.on(\"mouse:down\", this.dealMousedown);\n      newCanvas.on(\"object:over\", this.dealMouseover);\n    }\n  },\n  methods: {\n    dealMousedown(e) {\n      // 橡皮模式，移除选中的元素\n      if (this.mode === \"eraser\" && e.target === this.hoverObj) {\n        this.canvas.remove(this.hoverObj);\n        this.hoverObj = null;\n      }\n    },\n    dealMouseover(e) {\n      // 判断是否是橡皮模式\n      if (this.mode !== \"eraser\") return;\n\n      let target = e.target;\n      // 取消之前hoverObj的hover效果\n      if (this.hoverObj) {\n        this.hoverObj.stroke = this.hoverObj.origStroke;\n        this.canvas.renderAll();\n      }\n\n      // hover对象为笔划\n      if (target.get(\"type\") === \"path\") {\n        target.origStroke = target.stroke;\n        // 高亮待删除的笔划\n        target.stroke = \"#999\";\n        this.hoverObj = target;\n        this.canvas.renderAll();\n      }\n    },\n    dealClick() {\n      this.$emit(\"click\");\n    }\n    // this.canvas.isDrawingMode = true;\n    // const EraserBrush = fabric.util.createClass(fabric.PencilBrush, {\n    //   _finalizeAndAddPath() {\n    //     console.log(\"EraserBrush\");\n    //     let ctx = this.canvas.contextTop;\n    //     ctx.closePath();\n    //     if (this.decimate) {\n    //       this._points = this.decimatePoints(this._points, this.decimate);\n    //     }\n    //     let pathData = this.convertPointsToSVGPath(this._points).join(\"\");\n    //     // console.log(\"pathData\", pathData);\n    //     if (pathData === \"M 0 0 Q 0 0 0 0 L 0 0\") {\n    //       // do not create 0 width/height paths, as they are\n    //       // rendered inconsistently across browsers\n    //       // Firefox 4, for example, renders a dot,\n    //       // whereas Chrome 10 renders nothing\n    //       this.canvas.requestRenderAll();\n    //       return;\n    //     }\n\n    //     // use globalCompositeOperation to 'fake' eraser\n    //     let path = this.createPath(pathData);\n    //     // console.log(\"path\", path);\n    //     path.globalCompositeOperation = \"destination-out\";\n    //     path.selectable = false;\n    //     path.evented = false;\n    //     path.absolutePositioned = true;\n    //     path.set({\n    //       nameType: \"eraser\",\n    //       globalCompositeOperation: \"destination-out\",\n    //       opacity: 0\n    //       // stroke: \"green\",\n    //       // strokeWidth: 20\n    //     });\n  }\n};\n</script>\n"]}]}