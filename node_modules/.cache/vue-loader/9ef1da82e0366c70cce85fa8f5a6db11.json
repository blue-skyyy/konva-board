{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/rotate.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/rotate.vue","mtime":1600055587098},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1592981491866}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGZhYnJpYyB9IGZyb20gImZhYnJpYyI7CmltcG9ydCBpY29ucyBmcm9tICIuLi9pY29ucy5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBwcm9wczogewogICAgY2FudmFzOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgZGVmYXVsdDogKCkgPT4ge30KICAgIH0sCiAgICBjdXJySXRlbTogewogICAgICB0eXBlOiBPYmplY3QsCiAgICAgIGRlZmF1bHQ6ICgpID0+IHt9CiAgICB9LAogICAgcm90YXRlUmlnaHQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICByb3RhdGVMZWZ0OiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaWNvbnMKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgc2V0U3R5bGUoKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihsZWZ0LCByaWdodCkgewogICAgICAgIGlmIChsZWZ0ICYmIHJpZ2h0KSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkaXNwbGF5OiAiZmxleCIsCiAgICAgICAgICAgIGZsZXg6IDIKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmICghbGVmdCAmJiAhcmlnaHQpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRpc3BsYXk6ICJub25lIgogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBkaXNwbGF5OiAiZmxleCIsCiAgICAgICAgICBmbGV4OiAxCiAgICAgICAgfTsKICAgICAgfTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIHJvdGF0ZVRvKGRpcmVjdGlvbikgewogICAgICB0aGlzLmN1cnJJdGVtLnJvdGF0ZVRvKGRpcmVjdGlvbik7CiAgICAgIC8vICDmm7TmlrBjYW52YXPnmoTlrr3pq5gKICAgICAgY29uc3QgeyBpbWFnZUluZm8sIHJvdGF0ZSB9ID0gdGhpcy5jdXJySXRlbTsKICAgICAgLy8g5L+d5oyB5rC05bmz5Z6C55u05bGF5LitCiAgICAgIGxldCB3cmFwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2ltYWdlX2NhbnZhc193cmFwIik7CiAgICAgIGlmIChyb3RhdGUgJSAxODAgPT09IDApIHsKICAgICAgICB0aGlzLmNhbnZhcy5zZXRXaWR0aChpbWFnZUluZm8uc2NhbGUud2lkdGgpOwogICAgICAgIHRoaXMuY2FudmFzLnNldEhlaWdodChpbWFnZUluZm8uc2NhbGUuaGVpZ2h0KTsKICAgICAgICB3cmFwLnN0eWxlWyJhbGlnbi1pdGVtcyJdID0gImNlbnRlciI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jYW52YXMuc2V0V2lkdGgoaW1hZ2VJbmZvLnNjYWxlLmhlaWdodCk7CiAgICAgICAgdGhpcy5jYW52YXMuc2V0SGVpZ2h0KGltYWdlSW5mby5zY2FsZS53aWR0aCk7CiAgICAgICAgd3JhcC5zdHlsZVsiYWxpZ24taXRlbXMiXSA9ICJmbGV4LXN0YXJ0IjsKICAgICAgfQogICAgICAvLyDkvZzkuLrnu4TmlbTkvZPml4vovawKICAgICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpOwogICAgICBsZXQgc2VsID0gbmV3IGZhYnJpYy5BY3RpdmVTZWxlY3Rpb24odGhpcy5jYW52YXMuZ2V0T2JqZWN0cygpLCB7CiAgICAgICAgY2FudmFzOiB0aGlzLmNhbnZhcywKICAgICAgICBjb3JuZXJTaXplOiAwLAogICAgICAgIGhhc0NvbnRyb2xzOiB0cnVlCiAgICAgIH0pOwogICAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3Qoc2VsKTsKICAgICAgZGlyZWN0aW9uID09PSAibGVmdCIgPyBzZWwucm90YXRlKC05MCkgOiBzZWwucm90YXRlKDkwKTsKICAgICAgLy8g5oGi5aSN57yp5pS+CiAgICAgIGxldCBjZW50ZXIgPSB0aGlzLmNhbnZhcy5nZXRDZW50ZXIoKTsKICAgICAgbGV0IHpvb21Qb2ludCA9IG5ldyBmYWJyaWMuUG9pbnQoY2VudGVyLnRvcCwgY2VudGVyLmxlZnQpOwogICAgICB0aGlzLmNhbnZhcy56b29tVG9Qb2ludCh6b29tUG9pbnQsIDEpOwogICAgICAvLyDnu4TlsYXkuK0KICAgICAgc2VsLmNlbnRlcigpOwogICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["rotate.vue"],"names":[],"mappings":";;;;;;;;;;;;AAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"rotate.vue","sourceRoot":"src/page/menu","sourcesContent":["<template>\n  <div :style=\"setStyle(rotateLeft, rotateRight)\" class=\"menu_rotate\">\n    <div :style=\"!rotateLeft && 'display:none'\" @click=\"rotateTo('left')\">\n      <div class=\"icon\" v-html=\"icons.rotateLeft\"></div>\n    </div>\n    <div @click=\"rotateTo('right')\" :style=\"!rotateRight && 'display:none'\">\n      <div class=\"icon\" v-html=\"icons.rotateRight\"></div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { fabric } from \"fabric\";\nimport icons from \"../icons.js\";\nexport default {\n  props: {\n    canvas: {\n      type: Object,\n      default: () => {}\n    },\n    currItem: {\n      type: Object,\n      default: () => {}\n    },\n    rotateRight: {\n      type: Boolean,\n      default: false\n    },\n    rotateLeft: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      icons\n    };\n  },\n  computed: {\n    setStyle() {\n      return function(left, right) {\n        if (left && right) {\n          return {\n            display: \"flex\",\n            flex: 2\n          };\n        }\n        if (!left && !right) {\n          return {\n            display: \"none\"\n          };\n        }\n\n        return {\n          display: \"flex\",\n          flex: 1\n        };\n      };\n    }\n  },\n  methods: {\n    rotateTo(direction) {\n      this.currItem.rotateTo(direction);\n      //  更新canvas的宽高\n      const { imageInfo, rotate } = this.currItem;\n      // 保持水平垂直居中\n      let wrap = document.querySelector(\"#image_canvas_wrap\");\n      if (rotate % 180 === 0) {\n        this.canvas.setWidth(imageInfo.scale.width);\n        this.canvas.setHeight(imageInfo.scale.height);\n        wrap.style[\"align-items\"] = \"center\";\n      } else {\n        this.canvas.setWidth(imageInfo.scale.height);\n        this.canvas.setHeight(imageInfo.scale.width);\n        wrap.style[\"align-items\"] = \"flex-start\";\n      }\n      // 作为组整体旋转\n      this.canvas.discardActiveObject();\n      let sel = new fabric.ActiveSelection(this.canvas.getObjects(), {\n        canvas: this.canvas,\n        cornerSize: 0,\n        hasControls: true\n      });\n      this.canvas.setActiveObject(sel);\n      direction === \"left\" ? sel.rotate(-90) : sel.rotate(90);\n      // 恢复缩放\n      let center = this.canvas.getCenter();\n      let zoomPoint = new fabric.Point(center.top, center.left);\n      this.canvas.zoomToPoint(zoomPoint, 1);\n      // 组居中\n      sel.center();\n      this.canvas.renderAll();\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n.menu_rotate {\n  justify-content: space-around;\n}\n</style>\n"]}]}