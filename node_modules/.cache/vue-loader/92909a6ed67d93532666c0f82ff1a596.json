{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/components/module/h5canvas.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/components/module/h5canvas.vue","mtime":1599816203769},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1592981491866}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KCmltcG9ydCB7IGRlYm91bmNlIH0gZnJvbSAiLi4vLi4vdXRpbHMuanMiOwppbXBvcnQgeyBmYWJyaWMgfSBmcm9tICJmYWJyaWMiOwpjb25zdCBQRU5fVVJMID0KICAiaHR0cHM6Ly9pbWcudmlwa2lkc3RhdGljLmNvbS9iZWVzY2hvb2wvc2VydmVyLzE1OTQwOTA0MDAwMzkvJUU3JUFDJTk0LnBuZyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgcHJvcHM6IHsKICAgIHdpZHRoOiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogMAogICAgfSwKICAgIGhlaWdodDogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDAKICAgIH0sCiAgICBtb2RlOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogIiIKICAgIH0sCiAgICB6SW5kZXg6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiAwCiAgICB9LAogICAgY29sb3I6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAicmVkIgogICAgfSwKICAgIGl0ZW06IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiAoKSA9PiB7fQogICAgfSwKICAgIGZjOiB7CiAgICAgIHR5cGU6IE9iamVjdAogICAgfQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNhbnZhczogbnVsbCwKICAgICAgY3R4OiBudWxsLAogICAgICBwb2ludHM6IFtdLAogICAgICBjYW5EcmF3OiBmYWxzZSwKICAgICAgcHJpdmlvdXNQcmVzc3VyZTogMCwKICAgICAgYmVnaW5Qb2ludDogbnVsbCwKICAgICAgZW5kUG9pbnQ6IG51bGwsCiAgICAgIGJhc2VMaW5lTGlzdDogWzYsIDEwLCAxNSwgMjVdLAogICAgICBoaXN0b3J5TGlzdDogW10KICAgIH07CiAgfSwKICB3YXRjaDogewogICAgbW9kZShuZXdWYWwpIHsKICAgICAgaWYgKCF0aGlzLmN0eCkgcmV0dXJuOwogICAgICBpZiAobmV3VmFsID09PSAicGVuY2lsIikgewogICAgICAgIHRoaXMuY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICJzb3VyY2Utb3ZlciI7CiAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUuY3Vyc29yID0gYHVybCgiJHtQRU5fVVJMfSIpIDIgMTYsIGF1dG9gOwogICAgICAgIC8vIHRoaXMuY2FudmFzLnNldEN1cnNvcihgdXJsKCIke1BFTkNJTF9VUkx9IikgMiAxNiwgYXV0b2ApOwogICAgICB9CiAgICAgIGlmIChuZXdWYWwgPT09ICJlcmFzZXIiKSB7CiAgICAgICAgdGhpcy5jdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gImRlc3RpbmF0aW9uLW91dCI7CiAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUuY3Vyc29yID0gIndhaXQiOwogICAgICB9CiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgaWYgKCF0aGlzLndpZHRoIHx8ICF0aGlzLmhlaWdodCkgcmV0dXJuOwogICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuaDVfY2FudmFzIik7CiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmNhbnZhcywgdGhpcy53aWR0aCk7CiAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7CiAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgIHRoaXMuY2FudmFzLnN0eWxlLmN1cnNvciA9IGB1cmwoIiR7UEVOX1VSTH0iKSAyIDE2LCBhdXRvYDsKICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgIC8vIGNvbnNvbGUubG9nKCIuLi4iLCB0aGlzLmNhbnZhcywgdGhpcy5jdHgpOwogICAgdGhpcy5jdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gInNvdXJjZS1vdmVyIjsKICAgIHRoaXMuY3R4LmxpbmVDYXAgPSAicm91bmQiOyAvL+iuvue9rue6v+adoeeahOe7k+adn+err+eCueagt+W8jwogICAgdGhpcy5jdHgubGluZUppb24gPSAicm91bmQiOyAvL+iuvue9ruS4pOadoee6v+ebuOS6pOaXtu+8jOaJgOWIm+W7uueahOaLkOinkuexu+WeiwogICAgdGhpcy5jdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yOyAvLyDnur/mnaHpopzoibIKCiAgICAvLyDms6jlhozkuovku7YKICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICJwb2ludGVyZG93biIsCiAgICAgIChlKSA9PiB7CiAgICAgICAgLy8gaWYgKHRoaXMubW9kZSA9PT0gImVyYXNlciIpIHsKICAgICAgICAvLyAgIHRoaXMuZXJhc2VyKGUpOwogICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgdGhpcy5oYW5kbGVkb3duKGUpOwogICAgICAgIC8vIH0KICAgICAgfSwKICAgICAgZmFsc2UKICAgICk7CiAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKAogICAgICAicG9pbnRlcnVwIiwKICAgICAgKGUpID0+IHsKICAgICAgICB0aGlzLmhhbmRsZVVwKGUpOwogICAgICAgIC8vIHRoaXMuZGVib3VuY2VNZXRob2QodGhpcyk7CiAgICAgICAgLy8gdGhpcy5pdGVtLnNhdmUoImg1IiwgdGhpcy5zYXZlSW1hZ2VEYXRhKCkpOwogICAgICB9LAogICAgICBmYWxzZQogICAgKTsKICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICJwb2ludGVybW92ZSIsCiAgICAgIChlKSA9PiB7CiAgICAgICAgdGhpcy5oYW5kbGVNb3ZlKGUpOwogICAgICB9LAogICAgICBmYWxzZQogICAgKTsKICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICJwb2ludGVybGVhdmUiLAogICAgICAoZSkgPT4gewogICAgICAgIC8vIGlmICh0aGlzLm1vZGUgPT09ICJlcmFzZXIiKSB7CiAgICAgICAgLy8gdGhpcy5lcmFzZXIoZSk7CiAgICAgICAgLy8gfSBlbHNlIHsKICAgICAgICB0aGlzLmhhbmRsZVVwKGUpOwogICAgICAgIC8vIHRoaXMuc2F2ZUltYWdlRGF0YSgibGxsbCIpOwogICAgICAgIC8vIH0KICAgICAgfSwKICAgICAgZmFsc2UKICAgICk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBkZWJvdW5jZU1ldGhvZDogZGVib3VuY2UoKHRoYXQpID0+IHsKICAgICAgLy8g6Ziy5oqWCiAgICAgIHRoYXQuaXRlbS5zYXZlKCJoNSIsIHRoYXQuc2F2ZUltYWdlRGF0YSgpKTsKICAgIH0sIDIwMDApLAogICAgaGFuZGxlVXAoZSkgewogICAgICBpZiAoIXRoaXMuY2FuRHJhdykgcmV0dXJuOwogICAgICBjb25zdCB7IHgsIHksIHByZXNzdXJlIH0gPSB0aGlzLmdldFBvcyhlKTsKICAgICAgdGhpcy5wcml2aW91c1ByZXNzdXJlID0gcHJlc3N1cmU7CiAgICAgIC8vIHRoaXMucG9pbnRzLnB1c2goeyB4LCB5IH0pOwogICAgICB0aGlzLnBvaW50cy5wdXNoKHsgeCwgeSwgY29tbWFuZDogIkwiIH0pOwogICAgICBpZiAodGhpcy5wb2ludHMubGVuZ3RoID4gMykgewogICAgICAgIGNvbnN0IGxhc3RUd29Qb2ludHMgPSB0aGlzLnBvaW50cy5zbGljZSgtMik7CiAgICAgICAgY29uc3QgY29udHJvbFBvaW50ID0gbGFzdFR3b1BvaW50c1swXTsKICAgICAgICBjb25zdCBlbmRQb2ludCA9IHsKICAgICAgICAgIHg6IChsYXN0VHdvUG9pbnRzWzBdLnggKyBsYXN0VHdvUG9pbnRzWzFdLngpIC8gMiwKICAgICAgICAgIHk6IChsYXN0VHdvUG9pbnRzWzBdLnkgKyBsYXN0VHdvUG9pbnRzWzFdLnkpIC8gMgogICAgICAgIH07CiAgICAgICAgdGhpcy5kcmF3UGF0aCgKICAgICAgICAgIHRoaXMuYmVnaW5Qb2ludCwKICAgICAgICAgIGNvbnRyb2xQb2ludCwKICAgICAgICAgIGVuZFBvaW50LAogICAgICAgICAgKCh0aGlzLnByaXZpb3VzUHJlc3N1cmUgKyBwcmVzc3VyZSkgLyAyKSAqIHRoaXMuYmFzZUxpbmVMaXN0WzBdCiAgICAgICAgKTsKICAgICAgICB0aGlzLmJlZ2luUG9pbnQgPSBlbmRQb2ludDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnByaXZpb3VzUHJlc3N1cmUgPSBwcmVzc3VyZTsKICAgICAgfQogICAgICB0aGlzLmJlZ2luUG9pbnQgPSBudWxsOwogICAgICB0aGlzLmNhbkRyYXcgPSBmYWxzZTsKICAgICAgdGhpcy5wb2ludHMgPSBbXTsKICAgIH0sCiAgICBoYW5kbGVkb3duKGUpIHsKICAgICAgdGhpcy5jYW5EcmF3ID0gdHJ1ZTsKICAgICAgY29uc3QgeyB4LCB5LCBwcmVzc3VyZSB9ID0gdGhpcy5nZXRQb3MoZSk7CiAgICAgIHRoaXMucHJpdmlvdXNQcmVzc3VyZSA9IHByZXNzdXJlOwogICAgICAvLyB0aGlzLnBvaW50cy5wdXNoKHsgeCwgeSB9KTsKICAgICAgdGhpcy5wb2ludHMucHVzaCh7IHgsIHksIGNvbW1hbmQ6ICJNIiB9KTsKICAgICAgdGhpcy5iZWdpblBvaW50ID0geyB4LCB5IH07CiAgICB9LAogICAgaGFuZGxlTW92ZShlKSB7CiAgICAgIGlmICghdGhpcy5jYW5EcmF3KSByZXR1cm47CiAgICAgIGNvbnN0IHsgeCwgeSwgcHJlc3N1cmUgfSA9IHRoaXMuZ2V0UG9zKGUpOwogICAgICB0aGlzLnByaXZpb3VzUHJlc3N1cmUgPSBwcmVzc3VyZTsKICAgICAgLy8gdGhpcy5wb2ludHMucHVzaCh7IHgsIHkgfSk7CiAgICAgIHRoaXMucG9pbnRzLnB1c2goeyB4LCB5LCBjb21tYW5kOiAiTCIgfSk7CiAgICAgIGlmICh0aGlzLnBvaW50cy5sZW5ndGggPiAzKSB7CiAgICAgICAgY29uc3QgbGFzdFR3b1BvaW50cyA9IHRoaXMucG9pbnRzLnNsaWNlKC0yKTsKICAgICAgICBjb25zdCBjb250cm9sUG9pbnQgPSBsYXN0VHdvUG9pbnRzWzBdOwogICAgICAgIGNvbnN0IGVuZFBvaW50ID0gewogICAgICAgICAgeDogKGxhc3RUd29Qb2ludHNbMF0ueCArIGxhc3RUd29Qb2ludHNbMV0ueCkgLyAyLAogICAgICAgICAgeTogKGxhc3RUd29Qb2ludHNbMF0ueSArIGxhc3RUd29Qb2ludHNbMV0ueSkgLyAyCiAgICAgICAgfTsKICAgICAgICB0aGlzLmRyYXdQYXRoKAogICAgICAgICAgdGhpcy5iZWdpblBvaW50LAogICAgICAgICAgY29udHJvbFBvaW50LAogICAgICAgICAgZW5kUG9pbnQsCiAgICAgICAgICBwcmVzc3VyZSAqIHRoaXMuYmFzZUxpbmVMaXN0WzBdCiAgICAgICAgKTsKICAgICAgICB0aGlzLmJlZ2luUG9pbnQgPSBlbmRQb2ludDsKICAgICAgfQogICAgfSwKICAgIGdldFBvcyhlKSB7CiAgICAgIGNvbnN0IHsgcHJlc3N1cmUgfSA9IGU7CiAgICAgIHJldHVybiB7CiAgICAgICAgeDogZS5sYXllclgsCiAgICAgICAgeTogZS5sYXllclksCiAgICAgICAgcHJlc3N1cmUKICAgICAgfTsKICAgIH0sCiAgICBkcmF3UGF0aChiZWdpblBvaW50LCBjb250cm9sUG9pbnQsIGVuZFBvaW50LCB3aWR0aCkgewogICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTsKICAgICAgdGhpcy5jdHgubW92ZVRvKGJlZ2luUG9pbnQueCwgYmVnaW5Qb2ludC55KTsKICAgICAgdGhpcy5jdHgucXVhZHJhdGljQ3VydmVUbygKICAgICAgICBjb250cm9sUG9pbnQueCwKICAgICAgICBjb250cm9sUG9pbnQueSwKICAgICAgICBlbmRQb2ludC54LAogICAgICAgIGVuZFBvaW50LnkKICAgICAgKTsKICAgICAgaWYgKHRoaXMubW9kZSA9PT0gImVyYXNlciIpIHsKICAgICAgICB3aWR0aCA9IDE1OwogICAgICAgIHRoaXMuY3R4LnN0cm9rZVN0eWxlID0gIiNGRkYiOwogICAgICB9CiAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IHdpZHRoOwogICAgICB0aGlzLmN0eC5zdHJva2UoKTsKICAgICAgdGhpcy5jdHguY2xvc2VQYXRoKCk7CiAgICAgIGxldCBwID0gdGhpcy5wYXRoVG9DdXJ2ZSh0aGlzLnBvaW50cyk7CiAgICAgIHZhciBwYXRoID0gbmV3IGZhYnJpYy5QYXRoKHAsIHsKICAgICAgICBmaWxsOiBudWxsLAogICAgICAgIHN0cm9rZTogdGhpcy5jb2xvciwKICAgICAgICBzdHJva2VXaWR0aDogd2lkdGgsCiAgICAgICAgc3Ryb2tlTGluZUNhcDogInJvdW5kIiwKICAgICAgICBzdHJva2VMaW5lSm9pbjogInJvdW5kIiwKICAgICAgICBldmVudGVkOiBmYWxzZSwKICAgICAgICBoYXNDb250cm9sczogZmFsc2UsCiAgICAgICAgaGFzQm9yZGVyczogZmFsc2UsCiAgICAgICAgc2VsZWN0YWJsZTogdHJ1ZSwKICAgICAgICBpc0RyYXdpbmdNb2RlOiBmYWxzZQogICAgICAgIC8vIHN0cm9rZVN0eWxlCiAgICAgIH0pOwogICAgICB0aGlzLmZjLmFkZChwYXRoKTsKICAgIH0sCiAgICBzYXZlSW1hZ2VEYXRhKCkgewogICAgICBsZXQgaW1nRGF0YSA9IHRoaXMuY3R4LmdldEltYWdlRGF0YSgKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgdGhpcy5jYW52YXMud2lkdGgsCiAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0CiAgICAgICk7CiAgICAgIHJldHVybiBpbWdEYXRhOwogICAgfSwKICAgIHB1dEltYWdlRGF0YShkYXRhKSB7CiAgICAgIHRoaXMuY3R4LnB1dEltYWdlRGF0YShkYXRhLCAwLCAwKTsKICAgIH0sCiAgICBleHBvcnQoKSB7CiAgICAgIHJldHVybiB0aGlzLmNhbnZhcy50b0RhdGFVUkwoImltYWdlL2pwZWciLCAxLjApOwogICAgICAvLyBjb25zb2xlLmxvZygicCIsIHApOwogICAgfSwKICAgIHBhdGhUb0N1cnZlKHBhdGgsIGNvbnRyb2xQb2ludHNOdW0gPSAyKSB7CiAgICAgIC8vIE0g5byA5aeLIEwg57uT5p2fCiAgICAgIGxldCBzdXBwb3J0ID0gWyJNIiwgIkwiXTsKICAgICAgbGV0IGN1cnZlID0geyAyOiAiUSIsIDM6ICJDIiB9OwogICAgICBsZXQgc3RyID0gIiI7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCB7IGNvbW1hbmQsIHgsIHkgfSA9IHBhdGhbaV07CiAgICAgICAgaWYgKCFzdXBwb3J0LmluY2x1ZGVzKGNvbW1hbmQpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7Y29tbWFuZH0gaXMgbm90IHN1cHBvcnQgd2lkdGggc3RhcnRgKTsKICAgICAgICB9CiAgICAgICAgaWYgKGkgJSBjb250cm9sUG9pbnRzTnVtID09PSAwKSB7CiAgICAgICAgICAvLyDliankvZnngrnmlbDkuI3lpJ/nu4TmiJDmm7Lnur/ml7bkvb/nlKhMCiAgICAgICAgICBsZXQgY21kID0KICAgICAgICAgICAgaSArIGNvbnRyb2xQb2ludHNOdW0gPD0gcGF0aC5sZW5ndGggPyBjdXJ2ZVtjb250cm9sUG9pbnRzTnVtXSA6ICJMIjsKICAgICAgICAgIHN0ciArPSBgICR7Y21kfSAke3h9ICR7eX1gOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHIgKz0gYCAke3h9ICR7eX1gOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gc3RyOwogICAgfQogIH0KfTsK"},{"version":3,"sources":["h5canvas.vue"],"names":[],"mappings":";;;;AAIA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"h5canvas.vue","sourceRoot":"src/components/module","sourcesContent":["<template>\n  <canvas class=\"h5_canvas\"></canvas>\n</template>\n<script>\nimport { debounce } from \"../../utils.js\";\nimport { fabric } from \"fabric\";\nconst PEN_URL =\n  \"https://img.vipkidstatic.com/beeschool/server/1594090400039/%E7%AC%94.png\";\n\nexport default {\n  props: {\n    width: {\n      type: Number,\n      default: 0\n    },\n    height: {\n      type: Number,\n      default: 0\n    },\n    mode: {\n      type: String,\n      default: \"\"\n    },\n    zIndex: {\n      type: Number,\n      default: 0\n    },\n    color: {\n      type: String,\n      default: \"red\"\n    },\n    item: {\n      type: Object,\n      default: () => {}\n    },\n    fc: {\n      type: Object\n    }\n  },\n  data() {\n    return {\n      canvas: null,\n      ctx: null,\n      points: [],\n      canDraw: false,\n      priviousPressure: 0,\n      beginPoint: null,\n      endPoint: null,\n      baseLineList: [6, 10, 15, 25],\n      historyList: []\n    };\n  },\n  watch: {\n    mode(newVal) {\n      if (!this.ctx) return;\n      if (newVal === \"pencil\") {\n        this.ctx.globalCompositeOperation = \"source-over\";\n        this.canvas.style.cursor = `url(\"${PEN_URL}\") 2 16, auto`;\n        // this.canvas.setCursor(`url(\"${PENCIL_URL}\") 2 16, auto`);\n      }\n      if (newVal === \"eraser\") {\n        this.ctx.globalCompositeOperation = \"destination-out\";\n        this.canvas.style.cursor = \"wait\";\n      }\n    }\n  },\n  mounted() {\n    if (!this.width || !this.height) return;\n    this.canvas = document.querySelector(\".h5_canvas\");\n    // console.log(this.canvas, this.width);\n    this.canvas.width = this.width;\n    this.canvas.height = this.height;\n    this.canvas.style.cursor = `url(\"${PEN_URL}\") 2 16, auto`;\n    this.ctx = this.canvas.getContext(\"2d\");\n    // console.log(\"...\", this.canvas, this.ctx);\n    this.ctx.globalCompositeOperation = \"source-over\";\n    this.ctx.lineCap = \"round\"; //设置线条的结束端点样式\n    this.ctx.lineJion = \"round\"; //设置两条线相交时，所创建的拐角类型\n    this.ctx.strokeStyle = this.color; // 线条颜色\n\n    // 注册事件\n    this.canvas.addEventListener(\n      \"pointerdown\",\n      (e) => {\n        // if (this.mode === \"eraser\") {\n        //   this.eraser(e);\n        // } else {\n        this.handledown(e);\n        // }\n      },\n      false\n    );\n    this.canvas.addEventListener(\n      \"pointerup\",\n      (e) => {\n        this.handleUp(e);\n        // this.debounceMethod(this);\n        // this.item.save(\"h5\", this.saveImageData());\n      },\n      false\n    );\n    this.canvas.addEventListener(\n      \"pointermove\",\n      (e) => {\n        this.handleMove(e);\n      },\n      false\n    );\n    this.canvas.addEventListener(\n      \"pointerleave\",\n      (e) => {\n        // if (this.mode === \"eraser\") {\n        // this.eraser(e);\n        // } else {\n        this.handleUp(e);\n        // this.saveImageData(\"llll\");\n        // }\n      },\n      false\n    );\n  },\n  methods: {\n    debounceMethod: debounce((that) => {\n      // 防抖\n      that.item.save(\"h5\", that.saveImageData());\n    }, 2000),\n    handleUp(e) {\n      if (!this.canDraw) return;\n      const { x, y, pressure } = this.getPos(e);\n      this.priviousPressure = pressure;\n      // this.points.push({ x, y });\n      this.points.push({ x, y, command: \"L\" });\n      if (this.points.length > 3) {\n        const lastTwoPoints = this.points.slice(-2);\n        const controlPoint = lastTwoPoints[0];\n        const endPoint = {\n          x: (lastTwoPoints[0].x + lastTwoPoints[1].x) / 2,\n          y: (lastTwoPoints[0].y + lastTwoPoints[1].y) / 2\n        };\n        this.drawPath(\n          this.beginPoint,\n          controlPoint,\n          endPoint,\n          ((this.priviousPressure + pressure) / 2) * this.baseLineList[0]\n        );\n        this.beginPoint = endPoint;\n      } else {\n        this.priviousPressure = pressure;\n      }\n      this.beginPoint = null;\n      this.canDraw = false;\n      this.points = [];\n    },\n    handledown(e) {\n      this.canDraw = true;\n      const { x, y, pressure } = this.getPos(e);\n      this.priviousPressure = pressure;\n      // this.points.push({ x, y });\n      this.points.push({ x, y, command: \"M\" });\n      this.beginPoint = { x, y };\n    },\n    handleMove(e) {\n      if (!this.canDraw) return;\n      const { x, y, pressure } = this.getPos(e);\n      this.priviousPressure = pressure;\n      // this.points.push({ x, y });\n      this.points.push({ x, y, command: \"L\" });\n      if (this.points.length > 3) {\n        const lastTwoPoints = this.points.slice(-2);\n        const controlPoint = lastTwoPoints[0];\n        const endPoint = {\n          x: (lastTwoPoints[0].x + lastTwoPoints[1].x) / 2,\n          y: (lastTwoPoints[0].y + lastTwoPoints[1].y) / 2\n        };\n        this.drawPath(\n          this.beginPoint,\n          controlPoint,\n          endPoint,\n          pressure * this.baseLineList[0]\n        );\n        this.beginPoint = endPoint;\n      }\n    },\n    getPos(e) {\n      const { pressure } = e;\n      return {\n        x: e.layerX,\n        y: e.layerY,\n        pressure\n      };\n    },\n    drawPath(beginPoint, controlPoint, endPoint, width) {\n      this.ctx.beginPath();\n      this.ctx.moveTo(beginPoint.x, beginPoint.y);\n      this.ctx.quadraticCurveTo(\n        controlPoint.x,\n        controlPoint.y,\n        endPoint.x,\n        endPoint.y\n      );\n      if (this.mode === \"eraser\") {\n        width = 15;\n        this.ctx.strokeStyle = \"#FFF\";\n      }\n      this.ctx.lineWidth = width;\n      this.ctx.stroke();\n      this.ctx.closePath();\n      let p = this.pathToCurve(this.points);\n      var path = new fabric.Path(p, {\n        fill: null,\n        stroke: this.color,\n        strokeWidth: width,\n        strokeLineCap: \"round\",\n        strokeLineJoin: \"round\",\n        evented: false,\n        hasControls: false,\n        hasBorders: false,\n        selectable: true,\n        isDrawingMode: false\n        // strokeStyle\n      });\n      this.fc.add(path);\n    },\n    saveImageData() {\n      let imgData = this.ctx.getImageData(\n        0,\n        0,\n        this.canvas.width,\n        this.canvas.height\n      );\n      return imgData;\n    },\n    putImageData(data) {\n      this.ctx.putImageData(data, 0, 0);\n    },\n    export() {\n      return this.canvas.toDataURL(\"image/jpeg\", 1.0);\n      // console.log(\"p\", p);\n    },\n    pathToCurve(path, controlPointsNum = 2) {\n      // M 开始 L 结束\n      let support = [\"M\", \"L\"];\n      let curve = { 2: \"Q\", 3: \"C\" };\n      let str = \"\";\n      for (let i = 0; i < path.length; i++) {\n        let { command, x, y } = path[i];\n        if (!support.includes(command)) {\n          throw new Error(`${command} is not support width start`);\n        }\n        if (i % controlPointsNum === 0) {\n          // 剩余点数不够组成曲线时使用L\n          let cmd =\n            i + controlPointsNum <= path.length ? curve[controlPointsNum] : \"L\";\n          str += ` ${cmd} ${x} ${y}`;\n        } else {\n          str += ` ${x} ${y}`;\n        }\n      }\n      return str;\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n.h5_canvas {\n  // position: absolute;\n  border: 1px solid green;\n  top: 0;\n}\n</style>\n"]}]}