{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/restore.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/restore.vue","mtime":1599816203773},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1592981491866}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGZhYnJpYyB9IGZyb20gImZhYnJpYyI7CmltcG9ydCBpY29ucyBmcm9tICIuLi9pY29ucy5qcyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJlc3RvcmVJY29uOiBpY29ucy5yZXN0b3JlCiAgICB9OwogIH0sCiAgcHJvcHM6IHsKICAgIGNhbnZhczogewogICAgICB0eXBlOiBPYmplY3QsCiAgICAgIGRlZmF1bHQ6ICgpID0+IHt9CiAgICB9LAogICAgYmc6IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiAoKSA9PiB7fQogICAgfSwKICAgIGN1cnJJdGVtOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgZGVmYXVsdDogKCkgPT4ge30KICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGRlYWxDbGljaygpIHsKICAgICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpOwoKICAgICAgdGhpcy5jYW52YXMuZ2V0T2JqZWN0cygpLmZvckVhY2goKGNoaWxkKSA9PiB7CiAgICAgICAgaWYgKCFjaGlsZC5pc0JnKSB0aGlzLmNhbnZhcy5yZW1vdmUoY2hpbGQpOwogICAgICB9KTsKCiAgICAgIGNvbnN0IHsgaW1hZ2VJbmZvLCByb3RhdGUsIHNjYWxlWCwgc2NhbGVZIH0gPSB0aGlzLmN1cnJJdGVtOwoKICAgICAgLy8g6IOM5pmv5Zu+54mH5oGi5aSNCiAgICAgIHRoaXMuYmcucm90YXRlKDApOwogICAgICB0aGlzLmJnLmNlbnRlcigpOwogICAgICB0aGlzLmJnLnNjYWxlWCA9IHNjYWxlWDsKICAgICAgdGhpcy5iZy5zY2FsZVkgPSBzY2FsZVk7CiAgICAgIC8vIGNhbmF2c+WuvemrmAogICAgICB0aGlzLmNhbnZhcy5zZXRXaWR0aChpbWFnZUluZm8uc2NhbGUud2lkdGgpOwogICAgICB0aGlzLmNhbnZhcy5zZXRIZWlnaHQoaW1hZ2VJbmZvLnNjYWxlLmhlaWdodCk7CgogICAgICBsZXQgc2VsID0gbmV3IGZhYnJpYy5BY3RpdmVTZWxlY3Rpb24odGhpcy5jYW52YXMuZ2V0T2JqZWN0cygpLCB7CiAgICAgICAgY2FudmFzOiB0aGlzLmNhbnZhcywKICAgICAgICBjb3JuZXJTaXplOiAwLAogICAgICAgIGhhc0JvcmRlcnM6IHRydWUsCiAgICAgICAgc2VsZWN0YWJsZTogdHJ1ZSwKICAgICAgICBoYXNDb250cm9sczogdHJ1ZQogICAgICB9KTsKICAgICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KHNlbCk7CgogICAgICAvLyDkvY3nva4KICAgICAgc2VsLmxlZnQgPSAwOwogICAgICBzZWwudG9wID0gMDsKICAgICAgc2VsLnJpZ2h0ID0gMDsKICAgICAgc2VsLmJvdHRvbSA9IDA7CgogICAgICAvLyDml4vovawKICAgICAgc2VsLnJvdGF0ZSgtcm90YXRlKTsKICAgICAgc2VsLmNlbnRlcigpOwogICAgICB0aGlzLmN1cnJJdGVtLnNldFJvdGF0ZSgwKTsKCiAgICAgIC8vIOe8qeaUvgogICAgICBsZXQgY2VudGVyID0gdGhpcy5jYW52YXMuZ2V0Q2VudGVyKCk7CiAgICAgIGxldCB6b29tUG9pbnQgPSBuZXcgZmFicmljLlBvaW50KGNlbnRlci5sZWZ0LCBjZW50ZXIudG9wKTsKICAgICAgdGhpcy5jYW52YXMuem9vbVRvUG9pbnQoem9vbVBvaW50LCAxKTsKCiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpOwogICAgfQogIH0KfTsK"},{"version":3,"sources":["restore.vue"],"names":[],"mappings":";;;;;;;AAOA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"restore.vue","sourceRoot":"src/page/menu","sourcesContent":["<template>\n  <div class=\"menu_restore\">\n    <div @click=\"dealClick\" v-html=\"restoreIcon\"></div>\n  </div>\n</template>\n\n<script>\nimport { fabric } from \"fabric\";\nimport icons from \"../icons.js\";\n\nexport default {\n  data() {\n    return {\n      restoreIcon: icons.restore\n    };\n  },\n  props: {\n    canvas: {\n      type: Object,\n      default: () => {}\n    },\n    bg: {\n      type: Object,\n      default: () => {}\n    },\n    currItem: {\n      type: Object,\n      default: () => {}\n    }\n  },\n  methods: {\n    dealClick() {\n      this.canvas.discardActiveObject();\n\n      this.canvas.getObjects().forEach((child) => {\n        if (!child.isBg) this.canvas.remove(child);\n      });\n\n      const { imageInfo, rotate, scaleX, scaleY } = this.currItem;\n\n      // 背景图片恢复\n      this.bg.rotate(0);\n      this.bg.center();\n      this.bg.scaleX = scaleX;\n      this.bg.scaleY = scaleY;\n      // canavs宽高\n      this.canvas.setWidth(imageInfo.scale.width);\n      this.canvas.setHeight(imageInfo.scale.height);\n\n      let sel = new fabric.ActiveSelection(this.canvas.getObjects(), {\n        canvas: this.canvas,\n        cornerSize: 0,\n        hasBorders: true,\n        selectable: true,\n        hasControls: true\n      });\n      this.canvas.setActiveObject(sel);\n\n      // 位置\n      sel.left = 0;\n      sel.top = 0;\n      sel.right = 0;\n      sel.bottom = 0;\n\n      // 旋转\n      sel.rotate(-rotate);\n      sel.center();\n      this.currItem.setRotate(0);\n\n      // 缩放\n      let center = this.canvas.getCenter();\n      let zoomPoint = new fabric.Point(center.left, center.top);\n      this.canvas.zoomToPoint(zoomPoint, 1);\n\n      this.canvas.renderAll();\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped></style>\n"]}]}