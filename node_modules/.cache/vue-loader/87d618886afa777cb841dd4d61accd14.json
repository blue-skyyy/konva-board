{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/konva.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/konva.vue","mtime":1612177642865},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1592981491866}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBLb252YSBmcm9tICJrb252YSI7CmltcG9ydCB7IGltYWdlTGlzdCB9IGZyb20gIi4vdXRpbC5qcyI7CmltcG9ydCBJdGVtIGZyb20gIi4vSXRlbS5qcyI7Cgpjb25zdCBDX1dJRFRIID0gODAwOwpjb25zdCBDX0hFSUdIVCA9IDYwMDsKY29uc3QgbWV0aG9kcyA9IHsKICAvLyDliIfmjaLlt6XlhbfmoI/mqKHlvI8KICBzd2l0Y2hNb2RlKG1vZGUpIHsKICAgIHRoaXMubW9kZSA9IG1vZGU7CiAgICBpZiAobW9kZSA9PT0gImJydXNoIiB8fCBtb2RlID09PSAiZXJhc2VyIikgewogICAgICB0aGlzLmFkZEV2ZW50KCk7CiAgICAgIHRoaXMuY3Vyckl0ZW0uYmdJbWcuZHJhZ2dhYmxlKGZhbHNlKTsKICAgIH0KICAgIGlmIChtb2RlID09PSAibW92ZW9iamVjdCIpIHsKICAgICAgdGhpcy5yZW1vdmVTdGFnZUV2ZW50cygpOwogICAgICB0aGlzLnNldEN1cnNvclN0eWxlKCJwb2ludGVyIik7CiAgICAgIHRoaXMuY3Vyckl0ZW0uYmdJbWcuZHJhZ2dhYmxlKHRydWUpOwogICAgfQoKICAgIGlmIChtb2RlID09PSAicmVzZXQiKSB7CiAgICAgIHRoaXMuc3RhZ2UuY2xlYXIoKTsKICAgICAgY29uc29sZS5sb2codGhpcy5jdXJySW5kZXgpOwogICAgICB0aGlzLnN3aXRjaEltYWdlKDApOwogICAgfQogIH0sCiAgLy8g6K6+572u6byg5qCH5qC35byPCiAgc2V0Q3Vyc29yU3R5bGUodHlwZSkgewogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgIGNhc2UgInBvaW50ZXIiOgogICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gInBvaW50ZXIiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJkZWZhdWx0IjoKICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICJwb2ludGVyIjsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICJwb2ludGVyIjsKICAgICAgICBicmVhazsKICAgIH0KICB9LAogIC8vIOiuvue9ruiDjOaZr+WbvueJh+enu+WKqAogIG1vdmVCZ0ltZygpIHsKICAgIC8vIGNvbnNvbGUubG9nKCJ0aGlzLnN0YWdlIiwgdGhpcy5zdGFnZSwgdGhpcy5zdGFnZS5saXN0ZW5pbmcpOwogICAgLy8gdGhpcy5zdGFnZS5saXN0ZW5pbmcoZmFsc2UpOwogICAgLy8gdGhpcy5pc01vdmluZ0JnSW1nID0gdHJ1ZTsKICAgIHRoaXMucmVtb3ZlU3RhZ2VFdmVudHMoKTsKICAgIHRoaXMuY3Vyckl0ZW0uYmdJbWcuZHJhZ2dhYmxlKHRydWUpOwogICAgdGhpcy5zZXRDdXJzb3JTdHlsZSgicG9pbnRlciIpOwogIH0sCiAgLy8g5peL6L2sCiAgcm90YXRlVG8odHlwZSkgewogICAgaWYgKHR5cGUgPT09ICJsZWZ0IikgewogICAgICB0aGlzLnN0YWdlLnJvdGF0aW9uKC05MCk7CiAgICB9CiAgICBpZiAodHlwZSA9PT0gInJpZ2h0IikgewogICAgICB0aGlzLnN0YWdlLnJvdGF0aW9uKDkwKTsKICAgIH0KICAgIHRoaXMuc3RhZ2UuYmF0Y2hEcmF3KCk7CiAgfSwKICAvLyDmlL7lpKcKICBzZXRab29tKHR5cGUpIHsKICAgIGNvbnNvbGUubG9nKCJkYXNkYWRhIiwgdGhpcy5iZ0ltZ0xheWVyLCB0aGlzLnN0YWdlLmdldEF0dHIoInNjYWxlWCIpKTsKICAgIGxldCB6b29tID0gdGhpcy5zdGFnZS5nZXRBdHRyKCJzY2FsZVgiKSB8fCAxOwogICAgaWYgKHR5cGUgPT0gIm91dCIpIHsKICAgICAgLy8g5pS+5aSnCiAgICAgIHpvb20gPSB6b29tICsgdGhpcy56b29tU3RlcDsKICAgICAgem9vbSA9IE1hdGgubWluKDMsIHpvb20pOyAvL+acgOWkp+aYr+WOn+adpeeahDPlgI0KICAgIH0KICAgIGlmICh0eXBlID09PSAiaW4iKSB7CiAgICAgIHpvb20gPSB6b29tIC0gdGhpcy56b29tU3RlcDsKICAgICAgem9vbSA9IE1hdGgubWF4KDAuMSwgem9vbSk7IC8v5pyA5bCP5Li65Y6f5p2l55qEMS8xMAogICAgfQogICAgdGhpcy5zdGFnZS5zY2FsZSh7CiAgICAgIHg6IHpvb20sCiAgICAgIHk6IHpvb20KICAgIH0pOwogICAgdGhpcy5zdGFnZS5iYXRjaERyYXcoKTsKICB9LAogIC8vIOenu+mZpHN0YWdl5LqL5Lu255uR5ZCsCiAgcmVtb3ZlU3RhZ2VFdmVudHMoKSB7CiAgICB0aGlzLnN0YWdlLm9mZigibW91c2Vkb3duIik7CiAgICB0aGlzLnN0YWdlLm9mZigibW91c2Vtb3ZlIik7CiAgICB0aGlzLnN0YWdlLm9mZigibW91c2V1cCIpOwogIH0sCiAgLy8g5LqL5Lu255uR5ZCsCiAgYWRkRXZlbnQoKSB7CiAgICAvLyBpZiAodGhpcy5pc01vdmluZ0JnSW1nKSByZXR1cm47CiAgICAvLyBjb25zb2xlLmxvZygiYWRkRXZlbnQiKTsKICAgIGxldCBpc1BhaW50ID0gZmFsc2U7CiAgICBsZXQgbGFzdExpbmU7CiAgICB0aGlzLnN0YWdlLm9uKCJtb3VzZWRvd24iLCAoKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCJhIik7CiAgICAgIGlzUGFpbnQgPSB0cnVlOwogICAgICBsZXQgcG9zID0gdGhpcy5zdGFnZS5nZXRQb2ludGVyUG9zaXRpb24oKTsKICAgICAgbGV0IG9sZFNjYWxlID0gdGhpcy5zdGFnZS5zY2FsZVgoKTsKICAgICAgbGFzdExpbmUgPSBuZXcgS29udmEuTGluZSh7CiAgICAgICAgc3Ryb2tlOiAiI2RmNGIyNiIsCiAgICAgICAgc3Ryb2tlV2lkdGg6IDUsCiAgICAgICAgZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uOgogICAgICAgICAgdGhpcy5tb2RlID09PSAiYnJ1c2giID8gInNvdXJjZS1vdmVyIiA6ICJkZXN0aW5hdGlvbi1vdXQiLAogICAgICAgIHBvaW50czogWwogICAgICAgICAgcG9zLnggLyBvbGRTY2FsZSAtIHRoaXMuc3RhZ2UueCgpIC8gb2xkU2NhbGUsCiAgICAgICAgICBwb3MueSAvIG9sZFNjYWxlIC0gdGhpcy5zdGFnZS55KCkgLyBvbGRTY2FsZQogICAgICAgIF0KICAgICAgfSk7CiAgICAgIHRoaXMuZnJlZURyYXdMYXllci5hZGQobGFzdExpbmUpOwogICAgfSk7CiAgICB0aGlzLnN0YWdlLm9uKCJtb3VzZXVwIiwgKCkgPT4gewogICAgICBpc1BhaW50ID0gZmFsc2U7CiAgICB9KTsKICAgIHRoaXMuc3RhZ2Uub24oIm1vdXNlbW92ZSIsICgpID0+IHsKICAgICAgbGV0IG9sZFNjYWxlID0gdGhpcy5zdGFnZS5zY2FsZVgoKTsKICAgICAgaWYgKCFpc1BhaW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IHBvcyA9IHRoaXMuc3RhZ2UuZ2V0UG9pbnRlclBvc2l0aW9uKCk7CiAgICAgIGxldCBuZXdQb2ludHMgPSBsYXN0TGluZQogICAgICAgIC5wb2ludHMoKQogICAgICAgIC5jb25jYXQoWwogICAgICAgICAgcG9zLnggLyBvbGRTY2FsZSAtIHRoaXMuc3RhZ2UueCgpIC8gb2xkU2NhbGUsCiAgICAgICAgICBwb3MueSAvIG9sZFNjYWxlIC0gdGhpcy5zdGFnZS55KCkgLyBvbGRTY2FsZQogICAgICAgIF0pOwogICAgICBsYXN0TGluZS5wb2ludHMobmV3UG9pbnRzKTsKICAgICAgdGhpcy5mcmVlRHJhd0xheWVyLmJhdGNoRHJhdygpOwogICAgfSk7CiAgICAvLyBsZXQgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRvb2wiKTsKICAgIC8vIHNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCBmdW5jdGlvbigpIHsKICAgIC8vICAgbW9kZSA9IHNlbGVjdC52YWx1ZTsKICAgIC8vIH0pOwogIH0sCiAgLy8g5Y+N5bqP5YiX5YyWCiAgbG9hZENhbnZhc0Zyb21KU09OKHN0YXRlKSB7CiAgICBpZiAoIXN0YXRlKSByZXR1cm47CiAgICB0aGlzLnN0YWdlID0gS29udmEuTm9kZS5jcmVhdGUoSlNPTi5wYXJzZShzdGF0ZSksICJpbWFnZS1jYW52YXMiKTsKICAgIC8vIOa3u+WKoOiDjOaZr+WbvgogICAgdGhpcy5zdGFnZS5maW5kKCIjYmdJbWciKS5mb3JFYWNoKChub2RlKSA9PiB7CiAgICAgIGxldCBpbWcgPSBuZXcgSW1hZ2UoKTsKICAgICAgaW1nLnNyYyA9IG5vZGUuZ2V0QXR0cigic291cmNlIik7CiAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgbm9kZS5pbWFnZShpbWcpOwogICAgICAgIHRoaXMuc3RhZ2UuYmF0Y2hEcmF3KCk7CiAgICAgIH07CiAgICB9KTsKICAgIC8vIHRoaXMuc3RhZ2UuZmluZE9uZSgiI2JnSW1nIikKICAgIHRoaXMuZnJlZURyYXdMYXllciA9IHRoaXMuc3RhZ2UuZ2V0TGF5ZXJzKClbMV07CiAgICB0aGlzLmFkZEV2ZW50KCk7CiAgICB0aGlzLmZyZWVEcmF3TGF5ZXIuYmF0Y2hEcmF3KCk7CiAgICB0aGlzLmlzU3dpdGNoaW5nID0gZmFsc2U7CiAgICAvLyDnlLvnrJTlsYIKICAgIC8vIGxldCBjb25zdDEgPSB0aGlzLnN0YWdlLmZpbmQoIiNmcmVlX2RyYXdfY2FudmFzIik7CiAgICAvLyB0aGlzLmFkZEV2ZW50KCk7CiAgfSwKICBzYXZlQ3Vyckl0ZW1TdGF0ZSgpIHsKICAgIGlmICghdGhpcy5jdXJySXRlbSkgcmV0dXJuOwogICAgbGV0IHN0YXRlID0gdGhpcy5zdGFnZS50b0pTT04oKTsKICAgIHRoaXMuY3Vyckl0ZW0uc2F2ZShzdGF0ZSk7CiAgfSwKICB0b05leHQoKSB7CiAgICB0aGlzLnNhdmVDdXJySXRlbVN0YXRlKCk7CiAgICB0aGlzLnN3aXRjaEltYWdlKHRoaXMuY3VyckluZGV4ICsgMSk7CiAgfSwKICB0b1ByZXYoKSB7CiAgICB0aGlzLnNhdmVDdXJySXRlbVN0YXRlKCk7CiAgICB0aGlzLnN3aXRjaEltYWdlKHRoaXMuY3VyckluZGV4IC0gMSk7CiAgfSwKICB0b0RhdGFVcmwoKSB7CiAgICB0aGlzLmltZ1VybCA9IHRoaXMuc3RhZ2UudG9EYXRhVVJMKHsKICAgICAgeDogMCwKICAgICAgeTogMCwKICAgICAgd2lkdGg6IDYwMCwKICAgICAgaGVpZ2h0OiA0MDAsCiAgICAgIHBpeGVsUmF0aW86IDMKICAgIH0pOwogIH0sCiAgLy8g5Yqg6L296IOM5pmv5Zu+54mHCiAgbG9hZEJhY2tJbWFnZShpdGVtT2JqLCBjYikgewogICAgY29uc3QgeyBpbWFnZUluZm8gfSA9IGl0ZW1PYmo7CiAgICBjb25zdCB7IHNjYWxlIH0gPSBpbWFnZUluZm87CiAgICBLb252YS5JbWFnZS5mcm9tVVJMKGl0ZW1PYmoub3JpZ2luVXJsLCAoa0ltZykgPT4gewogICAgICBrSW1nLnNldEF0dHJzKHsKICAgICAgICAvLyDorr7nva7lsYXkuK0KICAgICAgICB4OiB0aGlzLmdldEJnSW1nWFlPZmZzZXQoc2NhbGUud2lkdGgsIG51bGwpLAogICAgICAgIHk6IHRoaXMuZ2V0QmdJbWdYWU9mZnNldChudWxsLCBzY2FsZS5oZWlnaHQpLAogICAgICAgIGlkOiAiYmdJbWciLAogICAgICAgIHNvdXJjZTogaXRlbU9iai5vcmlnaW5VcmwsCiAgICAgICAgZHJhZ2dhYmxlOiBmYWxzZSwKICAgICAgICB3aWR0aDogc2NhbGUud2lkdGgsCiAgICAgICAgaGVpZ2h0OiBzY2FsZS5oZWlnaHQKICAgICAgfSk7CiAgICAgIHRoaXMuYmdJbWdMYXllci5hZGQoa0ltZyk7CiAgICAgIHRoaXMuYmdJbWdMYXllci5iYXRjaERyYXcoKTsKICAgICAgLy8g5L+d5a2Y5b2T5YmN6IOM5pmv5a+56LGhCiAgICAgIHRoaXMuY3Vyckl0ZW0uYmdJbWcgPSBrSW1nOwogICAgICBjYiAmJiBjYigpOwogICAgfSk7CiAgfSwKICAvLyDojrflj5bog4zmma/lm77niYd4eeWBj+enu+mHjwogIGdldEJnSW1nWFlPZmZzZXQod2lkdGgsIGhlaWdodCkgewogICAgaWYgKHdpZHRoKSB7CiAgICAgIHJldHVybiBDX1dJRFRIID4gd2lkdGggPyAoQ19XSURUSCAtIHdpZHRoKSAvIDIgOiAwOwogICAgfQogICAgaWYgKGhlaWdodCkgewogICAgICByZXR1cm4gQ19IRUlHSFQgPiBoZWlnaHQgPyAoQ19IRUlHSFQgLSBoZWlnaHQpIC8gMiA6IDA7CiAgICB9CiAgfSwKCiAgYWZ0ZXJTd2l0Y2goaW5kZXgsIGl0ZW1PYmosIGlzRmlyc3RSZW5kZXIgPSBmYWxzZSkgewogICAgaWYgKGlzRmlyc3RSZW5kZXIpIHsKICAgICAgLy8g6aaW5qyh5riy5p+TOwogICAgICBpZiAoIXRoaXMuYmdJbWdMYXllcikgewogICAgICAgIGxldCBiZ0ltZ0xheWVyID0gbmV3IEtvbnZhLkxheWVyKCk7CiAgICAgICAgdGhpcy5iZ0ltZ0xheWVyID0gYmdJbWdMYXllcjsKICAgICAgICB0aGlzLmxvYWRCYWNrSW1hZ2UoaXRlbU9iaiwgdGhpcy5pbml0RnJlZURyYXdDYW52YXMpOwogICAgICAgIHRoaXMuc3RhZ2UuYWRkKGJnSW1nTGF5ZXIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYmdJbWdMYXllciAmJiB0aGlzLmJnSW1nTGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTsKICAgICAgICB0aGlzLmxvYWRCYWNrSW1hZ2UoaXRlbU9iaik7CiAgICAgIH0KICAgICAgdGhpcy5jbGVhckZyZWVEcmF3TGF5ZXIoKTsKICAgICAgdGhpcy5pc1N3aXRjaGluZyA9IGZhbHNlOwogICAgfQogIH0sCiAgLy8g6K6+572uc3RhZ2Xlrr3pq5gKICBzZXRTdGFnZVdIKHcsIGgpIHsKICAgIHRoaXMuc3RhZ2Uud2lkdGgodyk7CiAgICB0aGlzLnN0YWdlLmhlaWdodChoKTsKICB9LAogIC8vIOa4hemZpOeUu+eslOWxggogIGNsZWFyRnJlZURyYXdMYXllcigpIHsKICAgIGlmICh0aGlzLmZyZWVEcmF3TGF5ZXIpIHsKICAgICAgdGhpcy5mcmVlRHJhd0xheWVyLnJlbW92ZUNoaWxkcmVuKCk7CiAgICAgIHRoaXMuZnJlZURyYXdMYXllci5kcmF3KCk7CiAgICB9CiAgfSwKICAvLyDliIfmjaLlm77lsYIKICBzd2l0Y2hJbWFnZShpbmRleCkgewogICAgY29uc29sZS5sb2coIj09PT09c3dpdGNoSW1hZ2U9PT09PSIsIGluZGV4KTsKICAgIGlmIChpbmRleCA8IC0xKSByZXR1cm47CiAgICBpZiAodGhpcy5pc1N3aXRjaGluZykgcmV0dXJuOwogICAgbGV0IGltZyA9IHRoaXMuaW1hZ2VMaXN0W2luZGV4XTsKICAgIGlmICghaW1nKSByZXR1cm47CiAgICBsZXQgaXRlbU9iajsKICAgIGlmIChpbWcgJiYgIWltZy5pc1JlbmRlcikgewogICAgICB0aGlzLmlzU3dpdGNoaW5nID0gdHJ1ZTsKICAgICAgY29uc29sZS5sb2coIummluasoea4suafkyIpOwogICAgICAvLyDpppbmrKHmuLLmn5MKICAgICAgaXRlbU9iaiA9IG5ldyBJdGVtKAogICAgICAgIHsKICAgICAgICAgIHVybDogdGhpcy5pbWFnZUxpc3RbaW5kZXhdLnVybCwKICAgICAgICAgIGNvbldIOiB7IHdpZHRoOiA4MDAsIGhlaWdodDogNjAwIH0KICAgICAgICB9LAogICAgICAgICgpID0+IHRoaXMuYWZ0ZXJTd2l0Y2goaW5kZXgsIGl0ZW1PYmosIHRydWUpCiAgICAgICk7CiAgICAgIHRoaXMuY3VyckluZGV4ID0gaW5kZXg7CiAgICAgIHRoaXMuY3Vyckl0ZW0gPSBpdGVtT2JqOwogICAgICB0aGlzLml0ZW1MaXN0W3RoaXMuY3VyckluZGV4XSA9IGl0ZW1PYmo7CiAgICAgIHRoaXMuaW1hZ2VMaXN0W3RoaXMuY3VyckluZGV4XS5pc1JlbmRlciA9IHRydWU7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmlzU3dpdGNoaW5nID0gdHJ1ZTsKICAgICAgdGhpcy5jdXJySW5kZXggPSBpbmRleDsKICAgICAgLy8g6Z2e6aaW5qyh5riy5p+TCiAgICAgIGNvbnNvbGUubG9nKCI9PT09PT3pnZ7pppbmrKHmuLLmn5M9PT09PSIsIHRoaXMuY3VyckluZGV4KTsKICAgICAgY29uc29sZS5sb2coCiAgICAgICAgInRoaXMuaXRlbUxpc3RbdGhpcy5jdXJySW5kZXhdIiwKICAgICAgICB0aGlzLml0ZW1MaXN0W3RoaXMuY3VyckluZGV4XQogICAgICApOwogICAgICB0aGlzLmN1cnJJdGVtID0gdGhpcy5pdGVtTGlzdFt0aGlzLmN1cnJJbmRleF07CiAgICAgIGNvbnNvbGUubG9nKCIgdGhpcy5jdXJySXRlbSIsIHRoaXMuY3Vyckl0ZW0pOwogICAgICBsZXQgY3VyclN0YXRlID0gdGhpcy5jdXJySXRlbS5nZXRDdXJyU3RhdGUoKTsKICAgICAgY29uc29sZS5sb2coImN1cnJTdGF0ZSIsIGN1cnJTdGF0ZSk7CiAgICAgIHRoaXMubG9hZENhbnZhc0Zyb21KU09OKEpTT04ucGFyc2UoY3VyclN0YXRlKSk7CiAgICAgIC8vIHRoaXMubG9hZEJhY2tJbWFnZSh0aGlzLmN1cnJJdGVtKTsKICAgICAgLy8gdGhpcy5zdGFnZSA9IEtvbnZhLk5vZGUuY3JlYXRlKEpTT04ucGFyc2UoY3VyclN0YXRlKSwgImltYWdlLWNhbnZhcyIpOwogICAgICAvLyAvLyB0aGlzLnN0YWdlLmZpbmQoIiNiZ0ltZyIpLgogICAgICAvLyBsZXQgaW1hZ2UgPSBuZXcgSW1hZ2UoKTsKICAgICAgLy8gaW1hZ2Uub25sb2FkID0gKCkgPT4gewogICAgICAvLyAgIHRoaXMuc3RhZ2UuZmluZCgiI2JnSW1nIilbMF0uaW1hZ2UoaW1hZ2UpOwogICAgICAvLyAgIHRoaXMuc3RhZ2UuZHJhdygpOwogICAgICAvLyB9OwogICAgICAvLyBpbWFnZS5zcmMgPSB0aGlzLmN1cnJJdGVtLm9yaWdpblVybDsKICAgICAgLy8gdGhpcy5zdGFnZS5maW5kKCIjZnJlZV9kcmF3X2NhbnZhcyIpCiAgICAgIC8vIHRoaXMuZnJlZURyYXdMYXllci5iYXRjaERyYXcoKTsKICAgICAgLy8gdGhpcy5zdGFnZS5iYXRjaERyYXcoKTsKCiAgICAgIC8vIHRoaXMuc3RhZ2UuZm9yRWFjaCgoZCkgPT4gewogICAgICAvLyAgIGNvbnNvbGUubG9nKCJkIiwgZCk7CiAgICAgIC8vIH0pOwogICAgICAvLyB0aGlzLmJnSW1nTGF5ZXIuYmF0Y2hEcmF3KCk7CiAgICAgIC8vIHRoaXMuaW5pdEZyZWVEcmF3Q2FudmFzKCk7CgogICAgICAvLyB0aGlzLmZyZWVEcmF3TGF5ZXIuYmF0Y2hEcmF3KCk7CiAgICAgIC8vIHRoaXMuZnJlZURyYXdMYXllci56SW5kZXgoOTkpOwogICAgfQogIH0KfTsKZXhwb3J0IGRlZmF1bHQgewogIG1ldGhvZHMsCiAgbW91bnRlZCgpIHsKICAgIC8vIGZpcnN0IHdlIG5lZWQgS29udmEgY29yZSB0aGluZ3M6IHN0YWdlIGFuZCBsYXllcgogICAgbGV0IHN0YWdlID0gbmV3IEtvbnZhLlN0YWdlKHsKICAgICAgY29udGFpbmVyOiAiaW1hZ2UtY2FudmFzIiwKICAgICAgc2NhbGVZOiAxLAogICAgICBzY2FsZVg6IDEsCiAgICAgIGNlbnRlcmVkU2NhbGluZzogdHJ1ZSwKICAgICAgLy8g56Gu5a6a5LqGY2FudmFz55qE5a696auYCiAgICAgIHdpZHRoOiA4MDAsCiAgICAgIGhlaWdodDogNjAwCiAgICB9KTsKCiAgICB0aGlzLnN0YWdlID0gc3RhZ2U7CgogICAgLy8g6IOM5pmv5bGCCiAgICB0aGlzLmJnSW1nTGF5ZXIgPSBuZXcgS29udmEuTGF5ZXIoewogICAgICBpZDogImJnX2ltYWdlX2xheWVyIgogICAgfSk7CgogICAgLy8g57uY55S75bGCCiAgICB0aGlzLmZyZWVEcmF3TGF5ZXIgPSBuZXcgS29udmEuTGF5ZXIoewogICAgICBpZDogImZyZWVfZHJhd19sYXllciIsCiAgICAgIGJhY2tncm91bmRDb2xvcjogInJlZCIKICAgIH0pOwoKICAgIHRoaXMuc3RhZ2UuYWRkKHRoaXMuYmdJbWdMYXllcik7CiAgICB0aGlzLnN0YWdlLmFkZCh0aGlzLmZyZWVEcmF3TGF5ZXIpOwoKICAgIHRoaXMuYWRkRXZlbnQoKTsKCiAgICAvLyDnu4Too4XmlbDmja7moLzlvI8KICAgIHRoaXMuaW1hZ2VMaXN0ID0gdGhpcy5pbWFnZUxpc3QubWFwKChkKSA9PiB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaXNSZW5kZXI6IGZhbHNlLAogICAgICAgIHVybDogZAogICAgICB9OwogICAgfSk7CiAgICB0aGlzLnRvTmV4dCgpOwogICAgLy8gdGhpcy5pbml0RnJlZURyYXdDYW52YXMoKTsKICAgIC8vIHRoaXMuKCk7CgogICAgLy8g5Yid5aeL5YyW5pe25YCZ6ZyA6KaB5byC5q2lCiAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHt9LCAxMDApOwogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG1vZGU6ICJicnVzaCIsCiAgICAgIGlzTW92aW5nQmdJbWc6IGZhbHNlLAogICAgICB6b29tU3RlcDogMC4xLAogICAgICBzdGFnZTogbnVsbCwKICAgICAgaW1nVXJsOiBudWxsLAogICAgICBpbWFnZUxpc3Q6IGltYWdlTGlzdCwKICAgICAgY3VyckluZGV4OiAtMSwKICAgICAgY3Vyckl0ZW06IG51bGwsCiAgICAgIGl0ZW1MaXN0OiBbXSwKICAgICAgY29uV0g6IHsgd2lkdGg6IDgwMCwgaGVpZ2h0OiA2MDAgfSwKICAgICAgZnJlZURyYXdMYXllcjogbnVsbCwKICAgICAgYmdJbWdMYXllcjogbnVsbCwKICAgICAgaXNTd2l0Y2hpbmc6IGZhbHNlCiAgICB9OwogIH0sCiAgY29tcG9uZW50czoge30KfTsK"},{"version":3,"sources":["konva.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"konva.vue","sourceRoot":"src/page","sourcesContent":["<template>\n  <div>\n    <div id=\"image-decorator-wrap\">\n      <div id=\"image-canvas\"></div>\n    </div>\n\n    <select id=\"tool\">\n      <option value=\"brush\">Brush</option>\n      <option value=\"eraser\">Eraser</option>\n    </select>\n    <button @click=\"switchMode('brush')\">画笔模式</button>\n    <button @click=\"switchMode('eraser')\">橡皮擦模式</button>\n    <button @click=\"switchMode('moveobject')\">移动背景图片</button>\n    <button @click=\"switchMode('reset')\">重置</button>\n    <img :src=\"imgUrl\" class=\"img\" />\n    <button @click=\"toDataUrl\">点我下载</button>\n    <button @click=\"toNext\">下一张</button>\n    <button @click=\"toPrev\">上一张</button>\n    <button>{{ currIndex }}</button>\n    <button @click=\"setZoom('out')\">放大</button>\n    <button @click=\"setZoom('in')\">缩小</button>\n    <button @click=\"rotateTo('left')\">向左</button>\n    <button @click=\"rotateTo('right')\">向右</button>\n  </div>\n</template>\n\n<script>\nimport Konva from \"konva\";\nimport { imageList } from \"./util.js\";\nimport Item from \"./Item.js\";\n\nconst C_WIDTH = 800;\nconst C_HEIGHT = 600;\nconst methods = {\n  // 切换工具栏模式\n  switchMode(mode) {\n    this.mode = mode;\n    if (mode === \"brush\" || mode === \"eraser\") {\n      this.addEvent();\n      this.currItem.bgImg.draggable(false);\n    }\n    if (mode === \"moveobject\") {\n      this.removeStageEvents();\n      this.setCursorStyle(\"pointer\");\n      this.currItem.bgImg.draggable(true);\n    }\n\n    if (mode === \"reset\") {\n      this.stage.clear();\n      console.log(this.currIndex);\n      this.switchImage(0);\n    }\n  },\n  // 设置鼠标样式\n  setCursorStyle(type) {\n    switch (type) {\n      case \"pointer\":\n        document.body.style.cursor = \"pointer\";\n        break;\n      case \"default\":\n        document.body.style.cursor = \"pointer\";\n        break;\n      default:\n        document.body.style.cursor = \"pointer\";\n        break;\n    }\n  },\n  // 设置背景图片移动\n  moveBgImg() {\n    // console.log(\"this.stage\", this.stage, this.stage.listening);\n    // this.stage.listening(false);\n    // this.isMovingBgImg = true;\n    this.removeStageEvents();\n    this.currItem.bgImg.draggable(true);\n    this.setCursorStyle(\"pointer\");\n  },\n  // 旋转\n  rotateTo(type) {\n    if (type === \"left\") {\n      this.stage.rotation(-90);\n    }\n    if (type === \"right\") {\n      this.stage.rotation(90);\n    }\n    this.stage.batchDraw();\n  },\n  // 放大\n  setZoom(type) {\n    console.log(\"dasdada\", this.bgImgLayer, this.stage.getAttr(\"scaleX\"));\n    let zoom = this.stage.getAttr(\"scaleX\") || 1;\n    if (type == \"out\") {\n      // 放大\n      zoom = zoom + this.zoomStep;\n      zoom = Math.min(3, zoom); //最大是原来的3倍\n    }\n    if (type === \"in\") {\n      zoom = zoom - this.zoomStep;\n      zoom = Math.max(0.1, zoom); //最小为原来的1/10\n    }\n    this.stage.scale({\n      x: zoom,\n      y: zoom\n    });\n    this.stage.batchDraw();\n  },\n  // 移除stage事件监听\n  removeStageEvents() {\n    this.stage.off(\"mousedown\");\n    this.stage.off(\"mousemove\");\n    this.stage.off(\"mouseup\");\n  },\n  // 事件监听\n  addEvent() {\n    // if (this.isMovingBgImg) return;\n    // console.log(\"addEvent\");\n    let isPaint = false;\n    let lastLine;\n    this.stage.on(\"mousedown\", () => {\n      console.log(\"a\");\n      isPaint = true;\n      let pos = this.stage.getPointerPosition();\n      let oldScale = this.stage.scaleX();\n      lastLine = new Konva.Line({\n        stroke: \"#df4b26\",\n        strokeWidth: 5,\n        globalCompositeOperation:\n          this.mode === \"brush\" ? \"source-over\" : \"destination-out\",\n        points: [\n          pos.x / oldScale - this.stage.x() / oldScale,\n          pos.y / oldScale - this.stage.y() / oldScale\n        ]\n      });\n      this.freeDrawLayer.add(lastLine);\n    });\n    this.stage.on(\"mouseup\", () => {\n      isPaint = false;\n    });\n    this.stage.on(\"mousemove\", () => {\n      let oldScale = this.stage.scaleX();\n      if (!isPaint) {\n        return;\n      }\n      const pos = this.stage.getPointerPosition();\n      let newPoints = lastLine\n        .points()\n        .concat([\n          pos.x / oldScale - this.stage.x() / oldScale,\n          pos.y / oldScale - this.stage.y() / oldScale\n        ]);\n      lastLine.points(newPoints);\n      this.freeDrawLayer.batchDraw();\n    });\n    // let select = document.getElementById(\"tool\");\n    // select.addEventListener(\"change\", function() {\n    //   mode = select.value;\n    // });\n  },\n  // 反序列化\n  loadCanvasFromJSON(state) {\n    if (!state) return;\n    this.stage = Konva.Node.create(JSON.parse(state), \"image-canvas\");\n    // 添加背景图\n    this.stage.find(\"#bgImg\").forEach((node) => {\n      let img = new Image();\n      img.src = node.getAttr(\"source\");\n      img.onload = () => {\n        node.image(img);\n        this.stage.batchDraw();\n      };\n    });\n    // this.stage.findOne(\"#bgImg\")\n    this.freeDrawLayer = this.stage.getLayers()[1];\n    this.addEvent();\n    this.freeDrawLayer.batchDraw();\n    this.isSwitching = false;\n    // 画笔层\n    // let const1 = this.stage.find(\"#free_draw_canvas\");\n    // this.addEvent();\n  },\n  saveCurrItemState() {\n    if (!this.currItem) return;\n    let state = this.stage.toJSON();\n    this.currItem.save(state);\n  },\n  toNext() {\n    this.saveCurrItemState();\n    this.switchImage(this.currIndex + 1);\n  },\n  toPrev() {\n    this.saveCurrItemState();\n    this.switchImage(this.currIndex - 1);\n  },\n  toDataUrl() {\n    this.imgUrl = this.stage.toDataURL({\n      x: 0,\n      y: 0,\n      width: 600,\n      height: 400,\n      pixelRatio: 3\n    });\n  },\n  // 加载背景图片\n  loadBackImage(itemObj, cb) {\n    const { imageInfo } = itemObj;\n    const { scale } = imageInfo;\n    Konva.Image.fromURL(itemObj.originUrl, (kImg) => {\n      kImg.setAttrs({\n        // 设置居中\n        x: this.getBgImgXYOffset(scale.width, null),\n        y: this.getBgImgXYOffset(null, scale.height),\n        id: \"bgImg\",\n        source: itemObj.originUrl,\n        draggable: false,\n        width: scale.width,\n        height: scale.height\n      });\n      this.bgImgLayer.add(kImg);\n      this.bgImgLayer.batchDraw();\n      // 保存当前背景对象\n      this.currItem.bgImg = kImg;\n      cb && cb();\n    });\n  },\n  // 获取背景图片xy偏移量\n  getBgImgXYOffset(width, height) {\n    if (width) {\n      return C_WIDTH > width ? (C_WIDTH - width) / 2 : 0;\n    }\n    if (height) {\n      return C_HEIGHT > height ? (C_HEIGHT - height) / 2 : 0;\n    }\n  },\n\n  afterSwitch(index, itemObj, isFirstRender = false) {\n    if (isFirstRender) {\n      // 首次渲染;\n      if (!this.bgImgLayer) {\n        let bgImgLayer = new Konva.Layer();\n        this.bgImgLayer = bgImgLayer;\n        this.loadBackImage(itemObj, this.initFreeDrawCanvas);\n        this.stage.add(bgImgLayer);\n      } else {\n        this.bgImgLayer && this.bgImgLayer.removeChildren();\n        this.loadBackImage(itemObj);\n      }\n      this.clearFreeDrawLayer();\n      this.isSwitching = false;\n    }\n  },\n  // 设置stage宽高\n  setStageWH(w, h) {\n    this.stage.width(w);\n    this.stage.height(h);\n  },\n  // 清除画笔层\n  clearFreeDrawLayer() {\n    if (this.freeDrawLayer) {\n      this.freeDrawLayer.removeChildren();\n      this.freeDrawLayer.draw();\n    }\n  },\n  // 切换图层\n  switchImage(index) {\n    console.log(\"=====switchImage=====\", index);\n    if (index < -1) return;\n    if (this.isSwitching) return;\n    let img = this.imageList[index];\n    if (!img) return;\n    let itemObj;\n    if (img && !img.isRender) {\n      this.isSwitching = true;\n      console.log(\"首次渲染\");\n      // 首次渲染\n      itemObj = new Item(\n        {\n          url: this.imageList[index].url,\n          conWH: { width: 800, height: 600 }\n        },\n        () => this.afterSwitch(index, itemObj, true)\n      );\n      this.currIndex = index;\n      this.currItem = itemObj;\n      this.itemList[this.currIndex] = itemObj;\n      this.imageList[this.currIndex].isRender = true;\n    } else {\n      this.isSwitching = true;\n      this.currIndex = index;\n      // 非首次渲染\n      console.log(\"======非首次渲染=====\", this.currIndex);\n      console.log(\n        \"this.itemList[this.currIndex]\",\n        this.itemList[this.currIndex]\n      );\n      this.currItem = this.itemList[this.currIndex];\n      console.log(\" this.currItem\", this.currItem);\n      let currState = this.currItem.getCurrState();\n      console.log(\"currState\", currState);\n      this.loadCanvasFromJSON(JSON.parse(currState));\n      // this.loadBackImage(this.currItem);\n      // this.stage = Konva.Node.create(JSON.parse(currState), \"image-canvas\");\n      // // this.stage.find(\"#bgImg\").\n      // let image = new Image();\n      // image.onload = () => {\n      //   this.stage.find(\"#bgImg\")[0].image(image);\n      //   this.stage.draw();\n      // };\n      // image.src = this.currItem.originUrl;\n      // this.stage.find(\"#free_draw_canvas\")\n      // this.freeDrawLayer.batchDraw();\n      // this.stage.batchDraw();\n\n      // this.stage.forEach((d) => {\n      //   console.log(\"d\", d);\n      // });\n      // this.bgImgLayer.batchDraw();\n      // this.initFreeDrawCanvas();\n\n      // this.freeDrawLayer.batchDraw();\n      // this.freeDrawLayer.zIndex(99);\n    }\n  }\n};\nexport default {\n  methods,\n  mounted() {\n    // first we need Konva core things: stage and layer\n    let stage = new Konva.Stage({\n      container: \"image-canvas\",\n      scaleY: 1,\n      scaleX: 1,\n      centeredScaling: true,\n      // 确定了canvas的宽高\n      width: 800,\n      height: 600\n    });\n\n    this.stage = stage;\n\n    // 背景层\n    this.bgImgLayer = new Konva.Layer({\n      id: \"bg_image_layer\"\n    });\n\n    // 绘画层\n    this.freeDrawLayer = new Konva.Layer({\n      id: \"free_draw_layer\",\n      backgroundColor: \"red\"\n    });\n\n    this.stage.add(this.bgImgLayer);\n    this.stage.add(this.freeDrawLayer);\n\n    this.addEvent();\n\n    // 组装数据格式\n    this.imageList = this.imageList.map((d) => {\n      return {\n        isRender: false,\n        url: d\n      };\n    });\n    this.toNext();\n    // this.initFreeDrawCanvas();\n    // this.();\n\n    // 初始化时候需要异步\n    // setTimeout(() => {}, 100);\n  },\n  data() {\n    return {\n      mode: \"brush\",\n      isMovingBgImg: false,\n      zoomStep: 0.1,\n      stage: null,\n      imgUrl: null,\n      imageList: imageList,\n      currIndex: -1,\n      currItem: null,\n      itemList: [],\n      conWH: { width: 800, height: 600 },\n      freeDrawLayer: null,\n      bgImgLayer: null,\n      isSwitching: false\n    };\n  },\n  components: {}\n};\n</script>\n\n<style lang=\"less\" scoped>\n#image-decorator-wrap {\n  border: 1px solid red;\n  width: 800px;\n  height: 600px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 0 auto;\n  overflow: hidden;\n\n  #image-canvas {\n    border: 1px solid yellow;\n  }\n  .img {\n    margin-top: 20px;\n    border: 1px solid blue;\n  }\n}\n</style>\n"]}]}