{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/download.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/download.vue","mtime":1600055487525},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1591149279866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1592981491866}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBpY29ucyBmcm9tICIuLi9pY29ucy5qcyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogImRvd25sb2FkIiwKICBwcm9wczogewogICAgbW9kZTogewogICAgICBkZWZhdWx0OiAiIiwKICAgICAgdHlwZTogU3RyaW5nCiAgICB9LAogICAgY2FudmFzOiB7CiAgICAgIGRlZmF1bHQ6ICgpID0+IHt9LAogICAgICB0eXBlOiBPYmplY3QKICAgIH0sCiAgICBvcmlnaW5Vcmw6IHsKICAgICAgZGVmYXVsdDogIiIsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKICAgIGV4cG9ydEltYWdlOiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IEZ1bmN0aW9uCiAgICB9CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZG93bmxvYWRJY29uOiBpY29ucy5kb3dubG9hZCwKICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UKICAgICAgLy8gaXNTaG93OiBmYWxzZQogICAgfTsKICB9LAoKICB3YXRjaDogewogICAgLy8gbW9kZShuZXdtb2RlKSB7CiAgICAvLyAgIGlmIChuZXdtb2RlID09PSAiZXJhc2VyIikgewogICAgLy8gICAgIHRoaXMuZXJhc2VySWNvbiA9IGljb25zLmFjdGl2ZUVyYXNlcjsKICAgIC8vICAgfSBlbHNlIHsKICAgIC8vICAgICB0aGlzLmVyYXNlckljb24gPSBpY29ucy5lcmFzZXI7CiAgICAvLyAgIH0KICAgIC8vIH0sCiAgICAvLyBjYW52YXMobmV3Q2FudmFzKSB7CiAgICAvLyAgIG5ld0NhbnZhcy5vbigibW91c2U6ZG93biIsIHRoaXMuZGVhbE1vdXNlZG93bik7CiAgICAvLyAgIG5ld0NhbnZhcy5vbigib2JqZWN0Om92ZXIiLCB0aGlzLmRlYWxNb3VzZW92ZXIpOwogICAgLy8gfQogIH0sCiAgbWV0aG9kczogewogICAgZG93bmxvYWQodHlwZSkgewogICAgICBpZiAodHlwZSA9PT0gIm9yaWdpbiIpIHsKICAgICAgICBpZiAoIXRoaXMub3JpZ2luVXJsKSByZXR1cm47CiAgICAgICAgZmV0Y2godGhpcy5vcmlnaW5VcmwpCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIHJldHVybiByZXMuYmxvYigpOwogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7CiAgICAgICAgICAgIGxldCBkb3dubG9hZExpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAgIGRvd25sb2FkTGluay5ocmVmID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoZGF0YSk7CiAgICAgICAgICAgIGRvd25sb2FkTGluay5kb3dubG9hZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgIi5qcGVnIjsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkb3dubG9hZExpbmspOwogICAgICAgICAgICBkb3dubG9hZExpbmsuY2xpY2soKTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChkb3dubG9hZExpbmspOwogICAgICAgICAgICB3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTChkb3dubG9hZExpbmsuaHJlZik7CiAgICAgICAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoZXJyICsgIuS4i+i9veWksei0pSIpOwogICAgICAgICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAodHlwZSA9PT0gImN1cnJlbnQiKSB7CiAgICAgICAgdGhpcy5leHBvcnRJbWFnZSgic2luZ2xlIikudGhlbigodXJsKSA9PiB7CiAgICAgICAgICBsZXQgaW1nID0gbmV3IEltYWdlKCk7IC8vIOiOt+WPluimgeS4i+i9veeahOWbvueJhwogICAgICAgICAgaW1nLnNyYyA9IHVybDsKICAgICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgIGxldCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOyAvLyDliJvlu7rkuIDkuKph6IqC54K55o+S5YWl55qEZG9jdW1lbnQKICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IE1vdXNlRXZlbnQoImNsaWNrIik7IC8vIOaooeaLn+m8oOagh2NsaWNr54K55Ye75LqL5Lu2CiAgICAgICAgICAgIGEuZG93bmxvYWQgPSAiZG93bkltZyI7IC8vIOiuvue9rmHoioLngrnnmoRkb3dubG9hZOWxnuaAp+WAvAogICAgICAgICAgICBhLmhyZWYgPSB1cmw7IC8vIOWwhuWbvueJh+eahHNyY+i1i+WAvOe7mWHoioLngrnnmoRocmVmCiAgICAgICAgICAgIGEuZGlzcGF0Y2hFdmVudChldmVudCk7IC8vIOinpuWPkem8oOagh+eCueWHu+S6i+S7tgogICAgICAgICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGEpOwogICAgICAgICAgfTsKICAgICAgICAgIGltZy5vbmVycm9yID0gKGVycikgPT4gewogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGVyciArICLkuIvovb3lpLHotKUiKTsKICAgICAgICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZGVhbENsaWNrKCkgewogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSB0cnVlOwogICAgfQogIH0KfTsK"},{"version":3,"sources":["download.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAsBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"download.vue","sourceRoot":"src/page/menu","sourcesContent":["<template>\n  <div>\n    <div class=\"menu_download\">\n      <div @click=\"dealClick\" v-html=\"downloadIcon\" class=\"eraser_icon\"></div>\n    </div>\n\n    <el-dialog\n      title=\"请选择下载图片类型\"\n      :visible.sync=\"dialogVisible\"\n      :modal-append-to-body=\"false\"\n    >\n      <el-button type=\"warning\" @click.stop=\"download('origin')\"\n        >下载原始图片</el-button\n      >\n      <el-button type=\"danger\" @click.stop=\"download('current')\"\n        >下载当前图片</el-button\n      >\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport icons from \"../icons.js\";\n\nexport default {\n  name: \"download\",\n  props: {\n    mode: {\n      default: \"\",\n      type: String\n    },\n    canvas: {\n      default: () => {},\n      type: Object\n    },\n    originUrl: {\n      default: \"\",\n      type: String\n    },\n    exportImage: {\n      default: null,\n      type: Function\n    }\n  },\n  data() {\n    return {\n      downloadIcon: icons.download,\n      dialogVisible: false\n      // isShow: false\n    };\n  },\n\n  watch: {\n    // mode(newmode) {\n    //   if (newmode === \"eraser\") {\n    //     this.eraserIcon = icons.activeEraser;\n    //   } else {\n    //     this.eraserIcon = icons.eraser;\n    //   }\n    // },\n    // canvas(newCanvas) {\n    //   newCanvas.on(\"mouse:down\", this.dealMousedown);\n    //   newCanvas.on(\"object:over\", this.dealMouseover);\n    // }\n  },\n  methods: {\n    download(type) {\n      if (type === \"origin\") {\n        if (!this.originUrl) return;\n        fetch(this.originUrl)\n          .then((res) => {\n            return res.blob();\n          })\n          .then((data) => {\n            let downloadLink = document.createElement(\"a\");\n            downloadLink.href = window.URL.createObjectURL(data);\n            downloadLink.download = new Date().getTime() + \".jpeg\";\n            document.body.appendChild(downloadLink);\n            downloadLink.click();\n            document.body.removeChild(downloadLink);\n            window.URL.revokeObjectURL(downloadLink.href);\n            this.dialogVisible = false;\n          })\n          .catch((err) => {\n            this.$message.error(err + \"下载失败\");\n            this.dialogVisible = false;\n          });\n      }\n\n      if (type === \"current\") {\n        this.exportImage(\"single\").then((url) => {\n          let img = new Image(); // 获取要下载的图片\n          img.src = url;\n          img.onload = () => {\n            let a = document.createElement(\"a\"); // 创建一个a节点插入的document\n            let event = new MouseEvent(\"click\"); // 模拟鼠标click点击事件\n            a.download = \"downImg\"; // 设置a节点的download属性值\n            a.href = url; // 将图片的src赋值给a节点的href\n            a.dispatchEvent(event); // 触发鼠标点击事件\n            this.dialogVisible = false;\n            a.parentNode.removeChild(a);\n          };\n          img.onerror = (err) => {\n            this.$message.error(err + \"下载失败\");\n            this.dialogVisible = false;\n          };\n        });\n      }\n    },\n    dealClick() {\n      this.dialogVisible = true;\n    }\n  }\n};\n</script>\n"]}]}