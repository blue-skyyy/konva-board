{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/draw.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/draw.vue","mtime":1612674874644},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1606707433631},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1610942723088}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KCmltcG9ydCBLb252YSBmcm9tICJrb252YSI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiZHJhdyIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7fTsKICB9LAogIHByb3BzOiB7CiAgICBmcmVlRHJhd0xheWVyOiB7CiAgICAgIHR5cGU6IE9iamVjdAogICAgfSwKICAgIHN0YWdlOiB7CiAgICAgIHR5cGU6IE9iamVjdAogICAgfSwKICAgIG1vZGU6IHsKICAgICAgdHlwZTogU3RyaW5nCiAgICB9CiAgfSwKICB3YXRjaDogewogICAgbW9kZSgpIHsKICAgICAgY29uc29sZS5sb2coIj09PT09IiwgdGhpcy5zdGFnZSk7CiAgICAgIC8vIGlmICh2YWwgPT09ICJicnVzaCIgfHwgdmFsID09PSAiZXJhc2VyIikgewogICAgICAvLyAgIHRoaXMucGFpbnRFdmVudCgpOwogICAgICAvLyB9CiAgICB9LAogICAgc3RhZ2UoKSB7CiAgICAgIGlmICh0aGlzLm1vZGUgPT09ICJicnVzaCIgfHwgdGhpcy5tb2RlID09PSAiZXJhc2VyIikgewogICAgICAgIHRoaXMucGFpbnRFdmVudCgpOwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBwYWludEV2ZW50KCkgewogICAgICBsZXQgaXNQYWludCA9IGZhbHNlOwogICAgICBsZXQgbGFzdExpbmU7CiAgICAgIGNvbnNvbGUubG9nKCJ0aGlzLnN0YWdlQSIsIHRoaXMuc3RhZ2UpOwogICAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgdGhpcy5zdGFnZS5vbigibW91c2Vkb3duIiwgKCkgPT4gewogICAgICAgIGlzUGFpbnQgPSB0cnVlOwogICAgICAgIGxldCBwb3MgPSB0aGlzLnN0YWdlLmdldFBvaW50ZXJQb3NpdGlvbigpOwogICAgICAgIGxldCBvbGRTY2FsZSA9IHRoaXMuc3RhZ2Uuc2NhbGVYKCk7CiAgICAgICAgbGFzdExpbmUgPSBuZXcgS29udmEuTGluZSh7CiAgICAgICAgICBzdHJva2U6ICIjZGY0YjI2IiwKICAgICAgICAgIHN0cm9rZVdpZHRoOiA1LAogICAgICAgICAgZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uOgogICAgICAgICAgICB0aGlzLm1vZGUgPT09ICJicnVzaCIgPyAic291cmNlLW92ZXIiIDogImRlc3RpbmF0aW9uLW91dCIsCiAgICAgICAgICBwb2ludHM6IFsKICAgICAgICAgICAgcG9zLnggLyBvbGRTY2FsZSAtIHRoaXMuc3RhZ2UueCgpIC8gb2xkU2NhbGUsCiAgICAgICAgICAgIHBvcy55IC8gb2xkU2NhbGUgLSB0aGlzLnN0YWdlLnkoKSAvIG9sZFNjYWxlCiAgICAgICAgICBdCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5mcmVlRHJhd0xheWVyLmFkZChsYXN0TGluZSk7CiAgICAgIH0pOwogICAgICB0aGlzLnN0YWdlLm9uKCJtb3VzZXVwIiwgKCkgPT4gewogICAgICAgIGlzUGFpbnQgPSBmYWxzZTsKICAgICAgICB0aGlzLiRlbWl0KCJzYXZlQ3Vyckl0ZW1TdGF0ZSIpOwogICAgICB9KTsKICAgICAgdGhpcy5zdGFnZS5vbigibW91c2Vtb3ZlIiwgKCkgPT4gewogICAgICAgIGxldCBvbGRTY2FsZSA9IHRoaXMuc3RhZ2Uuc2NhbGVYKCk7CiAgICAgICAgaWYgKCFpc1BhaW50KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIOehruS/nee8qeaUvuWKn+iDveiDveato+W4uOS9v+eUqAogICAgICAgIGNvbnN0IHBvcyA9IHRoaXMuc3RhZ2UuZ2V0UG9pbnRlclBvc2l0aW9uKCk7CiAgICAgICAgbGV0IG5ld1BvaW50cyA9IGxhc3RMaW5lCiAgICAgICAgICAucG9pbnRzKCkKICAgICAgICAgIC5jb25jYXQoWwogICAgICAgICAgICBwb3MueCAvIG9sZFNjYWxlIC0gdGhpcy5zdGFnZS54KCkgLyBvbGRTY2FsZSwKICAgICAgICAgICAgcG9zLnkgLyBvbGRTY2FsZSAtIHRoaXMuc3RhZ2UueSgpIC8gb2xkU2NhbGUKICAgICAgICAgIF0pOwogICAgICAgIGxhc3RMaW5lLnBvaW50cyhuZXdQb2ludHMpOwogICAgICAgIHRoaXMuZnJlZURyYXdMYXllci5iYXRjaERyYXcoKTsKICAgICAgfSk7CiAgICAgIGNvbnNvbGUubG9nKCJ0aGlzLnN0YWdlQiIsIHRoaXMuc3RhZ2UpOwogICAgICAvLyB9LCAwKTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["draw.vue"],"names":[],"mappings":";;;;;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"draw.vue","sourceRoot":"src/page/menu","sourcesContent":["<template>\n  <div class=\"menu-draw\">\n    <el-button>画笔和橡皮擦</el-button>\n  </div>\n</template>\n<script>\nimport Konva from \"konva\";\nexport default {\n  name: \"draw\",\n  data() {\n    return {};\n  },\n  props: {\n    freeDrawLayer: {\n      type: Object\n    },\n    stage: {\n      type: Object\n    },\n    mode: {\n      type: String\n    }\n  },\n  watch: {\n    mode() {\n      console.log(\"=====\", this.stage);\n      // if (val === \"brush\" || val === \"eraser\") {\n      //   this.paintEvent();\n      // }\n    },\n    stage() {\n      if (this.mode === \"brush\" || this.mode === \"eraser\") {\n        this.paintEvent();\n      }\n    }\n  },\n  methods: {\n    paintEvent() {\n      let isPaint = false;\n      let lastLine;\n      console.log(\"this.stageA\", this.stage);\n      // setTimeout(() => {\n      this.stage.on(\"mousedown\", () => {\n        isPaint = true;\n        let pos = this.stage.getPointerPosition();\n        let oldScale = this.stage.scaleX();\n        lastLine = new Konva.Line({\n          stroke: \"#df4b26\",\n          strokeWidth: 5,\n          globalCompositeOperation:\n            this.mode === \"brush\" ? \"source-over\" : \"destination-out\",\n          points: [\n            pos.x / oldScale - this.stage.x() / oldScale,\n            pos.y / oldScale - this.stage.y() / oldScale\n          ]\n        });\n        this.freeDrawLayer.add(lastLine);\n      });\n      this.stage.on(\"mouseup\", () => {\n        isPaint = false;\n        this.$emit(\"saveCurrItemState\");\n      });\n      this.stage.on(\"mousemove\", () => {\n        let oldScale = this.stage.scaleX();\n        if (!isPaint) {\n          return;\n        }\n        // 确保缩放功能能正常使用\n        const pos = this.stage.getPointerPosition();\n        let newPoints = lastLine\n          .points()\n          .concat([\n            pos.x / oldScale - this.stage.x() / oldScale,\n            pos.y / oldScale - this.stage.y() / oldScale\n          ]);\n        lastLine.points(newPoints);\n        this.freeDrawLayer.batchDraw();\n      });\n      console.log(\"this.stageB\", this.stage);\n      // }, 0);\n    }\n  }\n};\n</script>\n"]}]}