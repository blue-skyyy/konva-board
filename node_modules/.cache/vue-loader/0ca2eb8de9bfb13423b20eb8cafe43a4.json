{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/components/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/components/index.vue","mtime":1599816203768},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/babel-loader/lib/index.js","mtime":1606707433631},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1592981491866}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGZhYnJpYyB9IGZyb20gImZhYnJpYyI7CmltcG9ydCBoNUNhbnZhcyBmcm9tICIuL21vZHVsZS9oNWNhbnZhcyI7CmltcG9ydCBJdGVtIGZyb20gIi4vSXRlbS5qcyI7CmltcG9ydCB7IGNvbXBvc2VDYW52YXMgfSBmcm9tICIuLi91dGlscy5qcyI7Ci8vIGlzSW1hZ2VWYWlsZCwKY29uc3QgZGVmYXVsdENvbmZpZyA9IHsKICB3aWR0aDogODAwLAogIGhlaWdodDogNTAwCn07CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBoNUNhbnZhcwogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNhbnZhczogbnVsbCwKICAgICAgcG9pbnRzOiBbXSwKICAgICAgYmVnaW5Qb2ludDogbnVsbCwKICAgICAgZW5kUG9pbnQ6IG51bGwsCiAgICAgIGN0eDogbnVsbCwKICAgICAgY2FuRHJhdzogZmFsc2UsCiAgICAgIHByaXZpb3VzUHJlc3N1cmU6IDAsCiAgICAgIGJhc2VMaW5lTGlzdDogWzYsIDEwLCAxNSwgMjVdLAogICAgICBwYXRoU3RyOiAiIiwKICAgICAgY29sb3I6ICJyZWQiLAogICAgICBtb2RlOiAicGVuY2lsIiwKICAgICAgY29uZmlnOiBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0Q29uZmlnKSwKICAgICAgaW1hZ2VzTGlzdDogWwogICAgICAgICJodHRwczovL2ltZy52aXBraWRzdGF0aWMuY29tL2JlZXNjaG9vbC9zZXJ2ZXIvMjAyMDA3MTcvY2NiODQzMmMtYWNmMi00ZjYzLWI1MWQtNDE5NWEzZmRlNTIwLnBuZyIsCiAgICAgICAgImh0dHBzOi8vaW1nLnZpcGtpZHN0YXRpYy5jb20vYmVlc2Nob29sL3NlcnZlci8yMDIwMDcxNy9iMjc5OTY3Yy00ZDk1LTQ2MDMtODk5Yy03NGRiNDA5MmQ1YjgucG5nIgogICAgICBdLAogICAgICBjdXJySW5kZXg6IDAsCiAgICAgIGl0ZW1MaXN0OiBbXSwKICAgICAgY3Vyckl0ZW06IG51bGwsCiAgICAgIGlzRmlyc3RSZW5kZXI6IHRydWUsCiAgICAgIGxvYWRlZFN0YXR1czogW10sCiAgICAgIGJhc2VVcmw6IG51bGwsCiAgICAgIGNvbXBvc2VVcmw6IG51bGwsCiAgICAgIHJlY3Q6IG51bGwsCiAgICAgIGhpc3RvcnlDaGFuZ2luZzogZmFsc2UgLy8g6YG/5YWNYWRkZWTop6blj5EKICAgIH07CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5pbml0Q2FudmFzKCk7CiAgICB0aGlzLnN3aXRjaFRvTmV4dCgpOwogIH0sCiAgbWV0aG9kczogewogICAgcmVtb3ZlUmVjdCgpIHsKICAgICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMucmVjdCk7CiAgICB9LAogICAgdW5kbygpIHsKICAgICAgLy8g6L+U5Zue5LiK5LiA5q2lCiAgICAgIGlmICghdGhpcy5jdXJySXRlbSkgcmV0dXJuOwogICAgICBpZiAodGhpcy5oaXN0b3J5Q2hhbmdpbmcpIHJldHVybjsKICAgICAgbGV0IHN0YXRlID0gdGhpcy5jdXJySXRlbS5nZXRQcmVIaXN0b3J5KCk7CiAgICAgIGlmICghc3RhdGUpIHJldHVybjsKICAgICAgdGhpcy5oaXN0b3J5Q2hhbmdpbmcgPSB0cnVlOwogICAgICBjb25zb2xlLmxvZygic3RhdGUiLCBzdGF0ZSk7CiAgICAgIGNvbnN0IHsgdHlwZSwgZGF0YSB9ID0gc3RhdGU7CiAgICAgIGlmICh0eXBlID09PSAiaDUiKSB7CiAgICAgICAgdGhpcy4kcmVmcy5oNWNhbnZhcy5wdXRJbWFnZURhdGEoZGF0YSk7CiAgICAgICAgdGhpcy5oaXN0b3J5Q2hhbmdpbmcgPSBmYWxzZTsKICAgICAgICBjb25zb2xlLmxvZygidGhpcy5oaXN0b3J5Q2hhbmdpbmctLS1oNSIsIHRoaXMuaGlzdG9yeUNoYW5naW5nKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAiZmFicmljIikgewogICAgICAgIHRoaXMuY2FudmFzLmxvYWRGcm9tSlNPTihkYXRhLCAoKSA9PiB7CiAgICAgICAgICB0aGlzLmhpc3RvcnlDaGFuZ2luZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7CiAgICAgICAgICBjb25zb2xlLmxvZygidGhpcy5oaXN0b3J5Q2hhbmdpbmctLWZhYnJpYyIsIHRoaXMuaGlzdG9yeUNoYW5naW5nKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRyZWZzLmg1Y2FudmFzLnB1dEltYWdlRGF0YShzdGF0ZVswXS5kYXRhKTsKICAgICAgICB0aGlzLmNhbnZhcy5sb2FkRnJvbUpTT04oc3RhdGVbMV0uZGF0YSwgKCkgPT4gewogICAgICAgICAgdGhpcy5oaXN0b3J5Q2hhbmdpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgYWRkUmVjdCgpIHsKICAgICAgdmFyIHJlY3QgPSBuZXcgZmFicmljLlJlY3QoewogICAgICAgIHRvcDogNTAsIC8v6Led56a755S75biD5LiK6L6555qE6Led56a7CiAgICAgICAgbGVmdDogMTAwLCAvL+i3neemu+eUu+W4g+W3puS+p+eahOi3neemu++8jOWNleS9jeaYr+WDj+e0oAogICAgICAgIHdpZHRoOiAxMDAsIC8v55+p5b2i55qE5a695bqmCiAgICAgICAgaGVpZ2h0OiA3MCwgLy/nn6nlvaLnmoTpq5jluqYKICAgICAgICBmaWxsOiAiYmx1ZSIsIC8v5aGr5YWF55qE6aKc6ImyCiAgICAgICAgc3Ryb2tlOiAib3JhbmdlIiwgLy8g6L655qGG5Y6f6ImyCiAgICAgICAgc3Ryb2tlV2lkdGg6IDUsIC8vIOi+ueahhuWkp+WwjwogICAgICAgIHJ4OiA4LCAvL+WchuinkuWNiuW+hAogICAgICAgIHJ5OiA0IC8v5ZyG6KeS5Y2K5b6ECiAgICAgIH0pOwogICAgICB0aGlzLnJlY3QgPSByZWN0OwoKICAgICAgdGhpcy5jYW52YXMuYWRkKHJlY3QpOwogICAgfSwKICAgIGFkZFJlY3QxKCkgewogICAgICB2YXIgcmVjdCA9IG5ldyBmYWJyaWMuUmVjdCh7CiAgICAgICAgdG9wOiA1MCwgLy/ot53nprvnlLvluIPkuIrovrnnmoTot53nprsKICAgICAgICBsZWZ0OiAyMDAsIC8v6Led56a755S75biD5bem5L6n55qE6Led56a777yM5Y2V5L2N5piv5YOP57SgCiAgICAgICAgd2lkdGg6IDIwMCwgLy/nn6nlvaLnmoTlrr3luqYKICAgICAgICBoZWlnaHQ6IDEwMDAsIC8v55+p5b2i55qE6auY5bqmCiAgICAgICAgZmlsbDogInJlZCIsIC8v5aGr5YWF55qE6aKc6ImyCiAgICAgICAgc3Ryb2tlOiAicmVkIiwgLy8g6L655qGG5Y6f6ImyCiAgICAgICAgc3Ryb2tlV2lkdGg6IDUsIC8vIOi+ueahhuWkp+WwjwogICAgICAgIHJ4OiA4LCAvL+WchuinkuWNiuW+hAogICAgICAgIHJ5OiA0IC8v5ZyG6KeS5Y2K5b6ECiAgICAgIH0pOwogICAgICB0aGlzLnJlY3QgPSByZWN0OwoKICAgICAgdGhpcy5jYW52YXMuYWRkKHJlY3QpOwogICAgfSwKICAgIGNvbXBvc2VJbWFnZVRlc3QoKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJ0aGlzLmNhbnZhcy50b0RhdGFVUkwoKSIsIHRoaXMuY2FudmFzLnRvRGF0YVVSTCgpKTsKICAgICAgbGV0IHVybCA9IGNvbXBvc2VDYW52YXMoCiAgICAgICAgdGhpcy5jb25maWcud2lkdGgsCiAgICAgICAgdGhpcy5jb25maWcuaGVpZ2h0LAogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5oNWNhbnZhcyIpLAogICAgICAgIC8vIHRoaXMuY2FudmFzLnRvRGF0YVVSTCgpCiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2NhbnZhcyIpCiAgICAgICAgLy8gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmxvd2VyLWNhbnZhcyIpCiAgICAgICk7CiAgICAgIHRoaXMuY29tcG9zZVVybCA9IHVybDsKICAgICAgY29uc29sZS5sb2coInVybCIsIHVybCk7CiAgICB9LAogICAgZXhwb3J0VGVzdCgpIHsKICAgICAgdGhpcy5iYXNlVXJsID0gdGhpcy5jdXJySXRlbS5oNWV4cHJvdCgpOwogICAgfSwKICAgIHNhdmVTdGF0ZSgpIHsKICAgICAgLy8gdGhpcy4kcmVmcy5oNWNhbnZhcy5zYXZlKCk7CiAgICAgIC8vIHRoaXMuY3Vyckl0ZW0uaDVzYXZlKCk7CiAgICB9LAogICAgcmVTdG9yZVN0YXRlKCkgewogICAgICB0aGlzLmN1cnJJdGVtLmdldGg1U3RhdGUoInVuZG8iKTsKICAgIH0sCiAgICBwcmUoKSB7fSwKICAgIGNoYW5nZU1vZGUobW9kZSkgewogICAgICB0aGlzLm1vZGUgPSBtb2RlOwogICAgfSwKCiAgICBzYXZlKCkgewogICAgICBpZiAoIXRoaXMuY3Vyckl0ZW0pIHJldHVybjsKICAgICAgY29uc29sZS5sb2coIi0tLS0taW4tLS1zYXZlLS0tLS0iKTsKICAgICAgLy8gY29uc29sZS5sb2coIi0tLS0tc2F2ZS0tLS0tZGF0YSIsIGRhdGEpOwogICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTsKICAgICAgbGV0IGRhdGEgPSB0aGlzLmNhbnZhcy50b0pTT04oKTsKICAgICAgdGhpcy5jdXJySXRlbS5zYXZlKCJmYWJyaWMiLCBkYXRhKTsKICAgIH0sCiAgICBkZWFsQWRkKCkgewogICAgICBpZiAodGhpcy5oaXN0b3J5Q2hhbmdpbmcpIHJldHVybjsKICAgICAgY29uc29sZS5sb2coIi0tLS1kZWFsQWRkLS0tLSIpOwogICAgICB0aGlzLnNhdmUoKTsKICAgICAgLy8gbGV0IHN0YXRlID0gSlNPTi5zdHJpbmdpZnkodGhpcy5jYW52YXMudG9KU09OKCkpOwogICAgICAvLyB0aGlzLmN1cnJJdGVtLnNhdmUoImZhYnJpYyIsIHN0YXRlKTsKCiAgICAgIC8vICAgICAgIC8vIOW/veeVpWxvYWRGcm9tSlNPTui/h+eoi+S4reinpuWPkeeahGFkZAogICAgICAvLyBpZiAodGhpcy5zd2l0Y2hpbmcgfHwgdGhpcy5oaXN0b3J5Q2hhbmdpbmcpIHJldHVybjsKICAgICAgLy8gLy8g5b+955Wl5re75Yqg6IOM5pmv5Zu+54mH6Kem5Y+R55qEYWRkCiAgICAgIC8vIGlmIChlLnRhcmdldC5pc0JhY2tncm91bmQpIHJldHVybjsKICAgICAgLy8gaWYgKHRoaXMubW9kZSA9PT0gInBlbmNpbCIgJiYgdGhpcy5teUF1dG9TYXZlKSB7CiAgICAgIC8vICAgLy8g55Sx5LqO55S756yU5Lya6aKR57mB6Kem5Y+R5L+d5a2Y5Ye95pWw77yM6YeN5pawcmVuZGVy77yM6KeG6KeJ5Lya6YCg5oiQ5Y+N5bqU5LiN5Y+K5pe255qE6Zeu6aKY77yM6ZmQ5Yi2MnPmiY3op6blj5HkuIDmrKEKICAgICAgLy8gICB0aGlzLmRlYm91bmNlTWV0aG9kKHRoaXMpOwogICAgICAvLyAgIHJldHVybjsKICAgICAgLy8gfQogICAgICAvLyB0aGlzLm15QXV0b1NhdmUgJiYgdGhpcy5wcmVwYXJlU2F2ZSgpOwogICAgfSwKICAgIGRlYWxNb2RpZnkoKSB7CiAgICAgIGlmICh0aGlzLmhpc3RvcnlDaGFuZ2luZykgcmV0dXJuOwogICAgICAvLyBjb25zb2xlLmxvZygiYWRkZWQiKTsKICAgIH0sCiAgICBkZWFsUmVtb3ZlKCkgewogICAgICBpZiAodGhpcy5oaXN0b3J5Q2hhbmdpbmcpIHJldHVybjsKICAgICAgLy8gY29uc29sZS5sb2coInJlbW92ZWQiKTsKICAgIH0sCgogICAgaW5pdENhbnZhcygpIHsKICAgICAgbGV0IGNhbnZhcyA9IG5ldyBmYWJyaWMuQ2FudmFzKCJjYW52YXMiLCB7CiAgICAgICAgaXNEcmF3aW5nTW9kZTogZmFsc2UsCiAgICAgICAgd2lkdGg6IDgwMCwKICAgICAgICBoZWlnaHQ6IDUwMAogICAgICB9KTsKCiAgICAgIC8vIGNhbnZhcy5vbigib2JqZWN0Om1vZGlmaWVkIiwgKCkgPT4gewogICAgICAvLyAgIGNvbnNvbGUubG9nKCJvYmplY3Q6bW9kaWZpZWQiKTsKICAgICAgLy8gICBsZXQgc3RhdGUgPSBKU09OLnN0cmluZ2lmeShjYW52YXMpOwogICAgICAvLyAgIHRoaXMuY3Vyckl0ZW0uc2F2ZShzdGF0ZSk7CiAgICAgIC8vIH0pOwogICAgICAvLyBjYW52YXMub24oIm9iamVjdDphZGRlZCIsICgpID0+IHsKICAgICAgLy8gICBjb25zb2xlLmxvZygib2JqZWN0OmFkZGVkIik7CiAgICAgIC8vICAgbGV0IHN0YXRlID0gSlNPTi5zdHJpbmdpZnkoY2FudmFzKTsKICAgICAgLy8gICB0aGlzLmN1cnJJdGVtLnNhdmUoc3RhdGUpOwogICAgICAvLyB9KTsKICAgICAgLy8gY2FudmFzLm9uKCJvYmplY3Q6cmVtb3ZlZCIsICgpID0+IHsKICAgICAgLy8gICBjb25zb2xlLmxvZygib2JqZWN0OnJlbW92ZWQiKTsKICAgICAgLy8gfSk7CgogICAgICBjYW52YXMub24oIm9iamVjdDphZGRlZCIsIHRoaXMuZGVhbEFkZCk7CiAgICAgIGNhbnZhcy5vbigib2JqZWN0Om1vZGlmaWVkIiwgdGhpcy5kZWFsTW9kaWZ5KTsKICAgICAgY2FudmFzLm9uKCJvYmplY3Q6cmVtb3ZlZCIsIHRoaXMuZGVhbFJlbW92ZSk7CiAgICAgIC8vIGNhbnZhcy5vbigiYWZ0ZXI6cmVuZGVyIiwgKCkgPT4geyB9KQogICAgICB0aGlzLmNhbnZhcyA9IGNhbnZhczsKCiAgICAgIHRoaXMubG9hZGVkU3RhdHVzID0gbmV3IEFycmF5KHRoaXMuaW1hZ2VzTGlzdC5sZW50aGcpLmZpbGwoZmFsc2UpOwogICAgfSwKICAgIHN3aXRjaFRvTmV4dChpbmRleCkgewogICAgICB0aGlzLnN3aXRjaEltYWdlKGluZGV4KTsKICAgIH0sCgogICAgYXN5bmMgc3dpdGNoSW1hZ2UoaW5kZXgpIHsKICAgICAgLy8g5q+P5Yqg6L295LiA5byg5Zu+54mH5omN5Lya55Sf5oiQ5LiA5Liq5a6e5L6LCiAgICAgIHRoaXMuY3VyckluZGV4ID0gaW5kZXggfHwgMDsKCiAgICAgIGlmICghdGhpcy5sb2FkZWRTdGF0dXNbdGhpcy5jdXJySW5kZXhdKSB7CiAgICAgICAgLy8g6aaW5qyh5Yqg6L29CiAgICAgICAgbGV0IGl0ZW0gPSBuZXcgSXRlbSh7CiAgICAgICAgICB1cmw6IHRoaXMuaW1hZ2VzTGlzdFt0aGlzLmN1cnJJbmRleF0sCiAgICAgICAgICBjYW52YXM6IHRoaXMuY2FudmFzLAogICAgICAgICAgaDVjYW52YXM6IHRoaXMuJHJlZnMuaDVjYW52YXMKICAgICAgICB9KTsKICAgICAgICBpdGVtLmlzSW1hZ2VWYWlsZCgpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgLy8g5Zu+54mH5ZCI5rOVCiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gIm9rIikgewogICAgICAgICAgICBsZXQgY2VudGVyID0gdGhpcy5jYW52YXMuZ2V0Q2VudGVyKCk7CiAgICAgICAgICAgIHRoaXMuY2FudmFzLnNldEJhY2tncm91bmRJbWFnZSgKICAgICAgICAgICAgICB0aGlzLmltYWdlc0xpc3RbdGhpcy5jdXJySW5kZXhdLAogICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbC5iaW5kKHRoaXMuY2FudmFzKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyBzY2FsZVg6IDEuMiwKICAgICAgICAgICAgICAgIC8vIHNjYWxlWTogMS4yLAogICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuY2FudmFzLndpZHRoLAogICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmNhbnZhcy5oZWlnaHQsCiAgICAgICAgICAgICAgICB0b3A6IGNlbnRlci50b3AsCiAgICAgICAgICAgICAgICBsZWZ0OiBjZW50ZXIubGVmdCwKICAgICAgICAgICAgICAgIG9yaWdpblg6ICJjZW50ZXIiLAogICAgICAgICAgICAgICAgb3JpZ2luWTogImNlbnRlciIsCiAgICAgICAgICAgICAgICBjcm9zc09yaWdpbjogImFub255bW91cyIsCiAgICAgICAgICAgICAgICBpc0JhY2tJbWc6IHRydWUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHRoaXMuaXRlbUxpc3QucHVzaChpdGVtKTsKICAgICAgICAgICAgdGhpcy5jdXJySXRlbSA9IGl0ZW07CiAgICAgICAgICAgIHRoaXMubG9hZGVkU3RhdHVzW3RoaXMuY3VyckluZGV4XSA9IHRydWU7CiAgICAgICAgICAgIC8vIOiHquWKqOS/neWtmOS4gOadoeiusOW9lQogICAgICAgICAgICAvLyB0aGlzLmN1cnJJdGVtLmg1c2F2ZSgiaW5pdCIpOwogICAgICAgICAgICBsZXQgaDVkYXRhID0gdGhpcy4kcmVmcy5oNWNhbnZhcy5zYXZlSW1hZ2VEYXRhKCk7CiAgICAgICAgICAgIHRoaXMuY3Vyckl0ZW0uc2F2ZSgiaDUiLCBoNWRhdGEsICJpbml0Iik7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuY3Vyckl0ZW0uc2F2ZSgiZmFicmljIiwgdGhpcy5jYW52YXMudG9KU09OKCksICJpbml0Iik7CiAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g6Z2e6aaW5qyh5Yqg6L29CiAgICAgIH0KICAgIH0sCiAgICAvLyBhc3luYyBzd2l0Y2hJbWFnZXRlc3QoaW5kZXgpIHsKICAgIC8vICAgLy8g5q+P5Yqg6L295LiA5byg5Zu+54mH5omN5Lya55Sf5oiQ5LiA5Liq5a6e5L6LCiAgICAvLyAgIHRoaXMuY3VyckluZGV4ID0gaW5kZXggfHwgMDsKICAgIC8vICAgaWYgKHRoaXMuaXNGaXJzdFJlbmRlcikgewogICAgLy8gICAgIC8vIOmmluasoea4suafkwogICAgLy8gICAgIGxldCBwcm9taXNlTGlzdCA9IFtdOwogICAgLy8gICAgIHRoaXMuaW1hZ2VzTGlzdC5mb3JFYWNoKCh1cmwpID0+IHsKICAgIC8vICAgICAgIHByb21pc2VMaXN0LnB1c2goaXNJbWFnZVZhaWxkKHVybCkpOwogICAgLy8gICAgIH0pOwogICAgLy8gICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChwcm9taXNlTGlzdCk7CiAgICAvLyAgICAgcmVzdWx0LmZvckVhY2goKHApID0+IHsKICAgIC8vICAgICAgIC8vIGlmIChwLnN0YXR1cyA9PT0gImZ1bGZpbGxlZCIpIHsKICAgIC8vICAgICAgIC8vICAgdGhpcy5pdGVtTGlzdC5wdXNoKG5ldyBJdGVtKHsgcDogcmVzLnVybCwgY2FudmFzOiB0aGlzLmNhbnZhcyB9KSk7CiAgICAvLyAgICAgICAvLyB9CiAgICAvLyAgICAgICBpZiAocC5zdGF0dXMgPT09ICJyZWplY3RlZCIgfHwgcC5zdGF0dXMgPT09ICJmdWxmaWxsZWQiKSB7CiAgICAvLyAgICAgICAgIHRoaXMuaXRlbUxpc3QucHVzaCgKICAgIC8vICAgICAgICAgICBuZXcgSXRlbSh7IHVybDogcC52YWx1ZS51cmwsIGNhbnZhczogdGhpcy5jYW52YXMgfSkKICAgIC8vICAgICAgICAgKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICB9KTsKICAgIC8vICAgICB0aGlzLmlzRmlyc3RSZW5kZXIgPSBmYWxzZTsKICAgIC8vICAgfQogICAgLy8gICB0aGlzLmN1cnJJdGVtID0gdGhpcy5pdGVtTGlzdFt0aGlzLmN1cnJJbmRleF07CiAgICAvLyAgIHRoaXMuY3Vyckl0ZW0uaGlzdG9yeUxpc3QucHVzaChKU09OLnN0cmluZ2lmeSh0aGlzLmNhbnZhcykpOwogICAgLy8gICBsZXQgY2VudGVyID0gdGhpcy5jYW52YXMuZ2V0Q2VudGVyKCk7CiAgICAvLyAgIHRoaXMuY2FudmFzLnNldEJhY2tncm91bmRJbWFnZSgKICAgIC8vICAgICB0aGlzLml0ZW1MaXN0W3RoaXMuY3VyckluZGV4XS51cmwsCiAgICAvLyAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsLmJpbmQodGhpcy5jYW52YXMpLAogICAgLy8gICAgIHsKICAgIC8vICAgICAgIC8vIHdpZHRoOiAodGhpcy5jYW52YXMud2lkdGggLyAzKSAqIDIsCiAgICAvLyAgICAgICAvLyBoZWlnaHQ6IHRoaXMuY2FudmFzLmhlaWdodCwKICAgIC8vICAgICAgIC8vIGhlaWdodDogODAwLAogICAgLy8gICAgICAgLy8gb3JpZ2luOiAiY2VudGVyIgogICAgLy8gICAgICAgc2NhbGVYOiAxLAogICAgLy8gICAgICAgc2NhbGVZOiAxLAogICAgLy8gICAgICAgLy8gdG9wOiAwLAogICAgLy8gICAgICAgdG9wOiBjZW50ZXIudG9wLAogICAgLy8gICAgICAgbGVmdDogY2VudGVyLmxlZnQsCiAgICAvLyAgICAgICAvLyBsZWZ0OiAwLAogICAgLy8gICAgICAgb3JpZ2luWDogImNlbnRlciIsCiAgICAvLyAgICAgICBvcmlnaW5ZOiAiY2VudGVyIgogICAgLy8gICAgICAgLy8gb3JpZ2luWDogImNlbnRlciIsCiAgICAvLyAgICAgICAvLyBvcmlnaW5ZOiAidG9wIgogICAgLy8gICAgIH0KICAgIC8vICAgKTsKICAgIC8vICAgdGhpcy4kcmVmcy5oNWNhbnZhcy5zYXZlKCk7CiAgICAvLyB9LAogICAgcGF0aFRvQ3VydmUocGF0aCwgY29udHJvbFBvaW50c051bSA9IDIpIHsKICAgICAgLy8gTSDlvIDlp4sgTCDnu5PmnZ8KICAgICAgbGV0IHN1cHBvcnQgPSBbIk0iLCAiTCJdOwogICAgICBsZXQgY3VydmUgPSB7IDI6ICJRIiwgMzogIkMiIH07CiAgICAgIGxldCBzdHIgPSAiIjsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHsgY29tbWFuZCwgeCwgeSB9ID0gcGF0aFtpXTsKICAgICAgICBpZiAoIXN1cHBvcnQuaW5jbHVkZXMoY29tbWFuZCkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJHtjb21tYW5kfSBpcyBub3Qgc3VwcG9ydCB3aWR0aCBzdGFydGApOwogICAgICAgIH0KICAgICAgICBpZiAoaSAlIGNvbnRyb2xQb2ludHNOdW0gPT09IDApIHsKICAgICAgICAgIC8vIOWJqeS9meeCueaVsOS4jeWkn+e7hOaIkOabsue6v+aXtuS9v+eUqEwKICAgICAgICAgIGxldCBjbWQgPQogICAgICAgICAgICBpICsgY29udHJvbFBvaW50c051bSA8PSBwYXRoLmxlbmd0aCA/IGN1cnZlW2NvbnRyb2xQb2ludHNOdW1dIDogIkwiOwogICAgICAgICAgc3RyICs9IGAgJHtjbWR9ICR7eH0gJHt5fWA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0ciArPSBgICR7eH0gJHt5fWA7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBzdHI7CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <div class=\"canvas-container\">\n      <canvas ref=\"canvas\" id=\"canvas\"></canvas>\n      <h5-canvas\n        :width=\"config.width\"\n        :height=\"config.height\"\n        :color=\"color\"\n        :mode=\"mode\"\n        ref=\"h5canvas\"\n        :item=\"currItem\"\n        class=\"h5canvas\"\n        :fc=\"canvas\"\n      ></h5-canvas>\n    </div>\n    <button @click=\"changeMode('pencil')\">画笔模式</button>\n    <button @click=\"changeMode('eraser')\">橡皮擦模式</button>\n    <button @click=\"saveState\">保存状态</button>\n    <button @click=\"reStoreState\">清除状态</button>\n    <button @click=\"undo\">上一步</button>\n    <button @click=\"switchToNext(1)\">切换图片</button>\n    <button @click=\"exportTest\">导出</button>\n    <button @click=\"composeImageTest\">生成合成图片</button>\n    <button @click=\"addRect\">添加fabric对象</button>\n    <button @click=\"addRect1\">添加fabric对象1</button>\n    <button @click=\"removeRect\">删除fabric对象</button>\n    <img :src=\"baseUrl\" />\n    <img :src=\"composeUrl\" />\n  </div>\n</template>\n\n<script>\nimport { fabric } from \"fabric\";\nimport h5Canvas from \"./module/h5canvas\";\nimport Item from \"./Item.js\";\nimport { composeCanvas } from \"../utils.js\";\n// isImageVaild,\nconst defaultConfig = {\n  width: 800,\n  height: 500\n};\nexport default {\n  components: {\n    h5Canvas\n  },\n  data() {\n    return {\n      canvas: null,\n      points: [],\n      beginPoint: null,\n      endPoint: null,\n      ctx: null,\n      canDraw: false,\n      priviousPressure: 0,\n      baseLineList: [6, 10, 15, 25],\n      pathStr: \"\",\n      color: \"red\",\n      mode: \"pencil\",\n      config: Object.assign({}, defaultConfig),\n      imagesList: [\n        \"https://img.vipkidstatic.com/beeschool/server/20200717/ccb8432c-acf2-4f63-b51d-4195a3fde520.png\",\n        \"https://img.vipkidstatic.com/beeschool/server/20200717/b279967c-4d95-4603-899c-74db4092d5b8.png\"\n      ],\n      currIndex: 0,\n      itemList: [],\n      currItem: null,\n      isFirstRender: true,\n      loadedStatus: [],\n      baseUrl: null,\n      composeUrl: null,\n      rect: null,\n      historyChanging: false // 避免added触发\n    };\n  },\n  mounted() {\n    this.initCanvas();\n    this.switchToNext();\n  },\n  methods: {\n    removeRect() {\n      this.canvas.remove(this.rect);\n    },\n    undo() {\n      // 返回上一步\n      if (!this.currItem) return;\n      if (this.historyChanging) return;\n      let state = this.currItem.getPreHistory();\n      if (!state) return;\n      this.historyChanging = true;\n      console.log(\"state\", state);\n      const { type, data } = state;\n      if (type === \"h5\") {\n        this.$refs.h5canvas.putImageData(data);\n        this.historyChanging = false;\n        console.log(\"this.historyChanging---h5\", this.historyChanging);\n      } else if (type === \"fabric\") {\n        this.canvas.loadFromJSON(data, () => {\n          this.historyChanging = false;\n          this.canvas.renderAll();\n          console.log(\"this.historyChanging--fabric\", this.historyChanging);\n        });\n      } else {\n        this.$refs.h5canvas.putImageData(state[0].data);\n        this.canvas.loadFromJSON(state[1].data, () => {\n          this.historyChanging = false;\n          this.canvas.renderAll();\n        });\n      }\n    },\n    addRect() {\n      var rect = new fabric.Rect({\n        top: 50, //距离画布上边的距离\n        left: 100, //距离画布左侧的距离，单位是像素\n        width: 100, //矩形的宽度\n        height: 70, //矩形的高度\n        fill: \"blue\", //填充的颜色\n        stroke: \"orange\", // 边框原色\n        strokeWidth: 5, // 边框大小\n        rx: 8, //圆角半径\n        ry: 4 //圆角半径\n      });\n      this.rect = rect;\n\n      this.canvas.add(rect);\n    },\n    addRect1() {\n      var rect = new fabric.Rect({\n        top: 50, //距离画布上边的距离\n        left: 200, //距离画布左侧的距离，单位是像素\n        width: 200, //矩形的宽度\n        height: 1000, //矩形的高度\n        fill: \"red\", //填充的颜色\n        stroke: \"red\", // 边框原色\n        strokeWidth: 5, // 边框大小\n        rx: 8, //圆角半径\n        ry: 4 //圆角半径\n      });\n      this.rect = rect;\n\n      this.canvas.add(rect);\n    },\n    composeImageTest() {\n      // console.log(\"this.canvas.toDataURL()\", this.canvas.toDataURL());\n      let url = composeCanvas(\n        this.config.width,\n        this.config.height,\n        document.querySelector(\".h5canvas\"),\n        // this.canvas.toDataURL()\n        document.querySelector(\"#canvas\")\n        // document.querySelector(\".lower-canvas\")\n      );\n      this.composeUrl = url;\n      console.log(\"url\", url);\n    },\n    exportTest() {\n      this.baseUrl = this.currItem.h5exprot();\n    },\n    saveState() {\n      // this.$refs.h5canvas.save();\n      // this.currItem.h5save();\n    },\n    reStoreState() {\n      this.currItem.geth5State(\"undo\");\n    },\n    pre() {},\n    changeMode(mode) {\n      this.mode = mode;\n    },\n\n    save() {\n      if (!this.currItem) return;\n      console.log(\"-----in---save-----\");\n      // console.log(\"-----save-----data\", data);\n      this.canvas.renderAll();\n      let data = this.canvas.toJSON();\n      this.currItem.save(\"fabric\", data);\n    },\n    dealAdd() {\n      if (this.historyChanging) return;\n      console.log(\"----dealAdd----\");\n      this.save();\n      // let state = JSON.stringify(this.canvas.toJSON());\n      // this.currItem.save(\"fabric\", state);\n\n      //       // 忽略loadFromJSON过程中触发的add\n      // if (this.switching || this.historyChanging) return;\n      // // 忽略添加背景图片触发的add\n      // if (e.target.isBackground) return;\n      // if (this.mode === \"pencil\" && this.myAutoSave) {\n      //   // 由于画笔会频繁触发保存函数，重新render，视觉会造成反应不及时的问题，限制2s才触发一次\n      //   this.debounceMethod(this);\n      //   return;\n      // }\n      // this.myAutoSave && this.prepareSave();\n    },\n    dealModify() {\n      if (this.historyChanging) return;\n      // console.log(\"added\");\n    },\n    dealRemove() {\n      if (this.historyChanging) return;\n      // console.log(\"removed\");\n    },\n\n    initCanvas() {\n      let canvas = new fabric.Canvas(\"canvas\", {\n        isDrawingMode: false,\n        width: 800,\n        height: 500\n      });\n\n      // canvas.on(\"object:modified\", () => {\n      //   console.log(\"object:modified\");\n      //   let state = JSON.stringify(canvas);\n      //   this.currItem.save(state);\n      // });\n      // canvas.on(\"object:added\", () => {\n      //   console.log(\"object:added\");\n      //   let state = JSON.stringify(canvas);\n      //   this.currItem.save(state);\n      // });\n      // canvas.on(\"object:removed\", () => {\n      //   console.log(\"object:removed\");\n      // });\n\n      canvas.on(\"object:added\", this.dealAdd);\n      canvas.on(\"object:modified\", this.dealModify);\n      canvas.on(\"object:removed\", this.dealRemove);\n      // canvas.on(\"after:render\", () => { })\n      this.canvas = canvas;\n\n      this.loadedStatus = new Array(this.imagesList.lenthg).fill(false);\n    },\n    switchToNext(index) {\n      this.switchImage(index);\n    },\n\n    async switchImage(index) {\n      // 每加载一张图片才会生成一个实例\n      this.currIndex = index || 0;\n\n      if (!this.loadedStatus[this.currIndex]) {\n        // 首次加载\n        let item = new Item({\n          url: this.imagesList[this.currIndex],\n          canvas: this.canvas,\n          h5canvas: this.$refs.h5canvas\n        });\n        item.isImageVaild().then((res) => {\n          // 图片合法\n          if (res.status === \"ok\") {\n            let center = this.canvas.getCenter();\n            this.canvas.setBackgroundImage(\n              this.imagesList[this.currIndex],\n              this.canvas.renderAll.bind(this.canvas),\n              {\n                // scaleX: 1.2,\n                // scaleY: 1.2,\n                width: this.canvas.width,\n                height: this.canvas.height,\n                top: center.top,\n                left: center.left,\n                originX: \"center\",\n                originY: \"center\",\n                crossOrigin: \"anonymous\",\n                isBackImg: true\n              }\n            );\n            this.itemList.push(item);\n            this.currItem = item;\n            this.loadedStatus[this.currIndex] = true;\n            // 自动保存一条记录\n            // this.currItem.h5save(\"init\");\n            let h5data = this.$refs.h5canvas.saveImageData();\n            this.currItem.save(\"h5\", h5data, \"init\");\n            setTimeout(() => {\n              this.currItem.save(\"fabric\", this.canvas.toJSON(), \"init\");\n            }, 100);\n          }\n        });\n      } else {\n        // 非首次加载\n      }\n    },\n    // async switchImagetest(index) {\n    //   // 每加载一张图片才会生成一个实例\n    //   this.currIndex = index || 0;\n    //   if (this.isFirstRender) {\n    //     // 首次渲染\n    //     let promiseList = [];\n    //     this.imagesList.forEach((url) => {\n    //       promiseList.push(isImageVaild(url));\n    //     });\n    //     const result = await Promise.allSettled(promiseList);\n    //     result.forEach((p) => {\n    //       // if (p.status === \"fulfilled\") {\n    //       //   this.itemList.push(new Item({ p: res.url, canvas: this.canvas }));\n    //       // }\n    //       if (p.status === \"rejected\" || p.status === \"fulfilled\") {\n    //         this.itemList.push(\n    //           new Item({ url: p.value.url, canvas: this.canvas })\n    //         );\n    //       }\n    //     });\n    //     this.isFirstRender = false;\n    //   }\n    //   this.currItem = this.itemList[this.currIndex];\n    //   this.currItem.historyList.push(JSON.stringify(this.canvas));\n    //   let center = this.canvas.getCenter();\n    //   this.canvas.setBackgroundImage(\n    //     this.itemList[this.currIndex].url,\n    //     this.canvas.renderAll.bind(this.canvas),\n    //     {\n    //       // width: (this.canvas.width / 3) * 2,\n    //       // height: this.canvas.height,\n    //       // height: 800,\n    //       // origin: \"center\"\n    //       scaleX: 1,\n    //       scaleY: 1,\n    //       // top: 0,\n    //       top: center.top,\n    //       left: center.left,\n    //       // left: 0,\n    //       originX: \"center\",\n    //       originY: \"center\"\n    //       // originX: \"center\",\n    //       // originY: \"top\"\n    //     }\n    //   );\n    //   this.$refs.h5canvas.save();\n    // },\n    pathToCurve(path, controlPointsNum = 2) {\n      // M 开始 L 结束\n      let support = [\"M\", \"L\"];\n      let curve = { 2: \"Q\", 3: \"C\" };\n      let str = \"\";\n      for (let i = 0; i < path.length; i++) {\n        let { command, x, y } = path[i];\n        if (!support.includes(command)) {\n          throw new Error(`${command} is not support width start`);\n        }\n        if (i % controlPointsNum === 0) {\n          // 剩余点数不够组成曲线时使用L\n          let cmd =\n            i + controlPointsNum <= path.length ? curve[controlPointsNum] : \"L\";\n          str += ` ${cmd} ${x} ${y}`;\n        } else {\n          str += ` ${x} ${y}`;\n        }\n      }\n      return str;\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n.canvas-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border: 5px solid red;\n  position: relative;\n  overflow-y: scroll;\n  #canvas {\n    box-sizing: border-box;\n  }\n  // .h5-canvas {\n  //   border: 1px solid green;\n  //   position: absolute;\n  //   z-index: 999;\n  // }\n}\n</style>\n"]}]}