{"remainingRequest":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/pencil.vue?vue&type=style&index=0&id=084f7cd4&lang=less&scoped=true&","dependencies":[{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/src/page/menu/pencil.vue","mtime":1600414979469},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/css-loader/dist/cjs.js","mtime":1594608463058},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1592981491866},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/postcss-loader/src/index.js","mtime":1591149286800},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/less-loader/dist/cjs.js","mtime":1597049187587},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/cache-loader/dist/cjs.js","mtime":1591588454175},{"path":"/Users/haopeiwei/Documents/hpw/web-board/konva-board/node_modules/vue-loader/lib/index.js","mtime":1592981491866}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoubWVudV9wZW5jaWwgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAucGVuY2lsX2JveCB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDMwcHg7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgMCk7CiAgICBwYWRkaW5nOiA4cHggNnB4OwogICAgYmFja2dyb3VuZDogIzM4M2MzNjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAmOjphZnRlciB7CiAgICAgIGNvbnRlbnQ6ICIiOwogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIHdpZHRoOiAwOwogICAgICBoZWlnaHQ6IDA7CiAgICAgIGJvcmRlci1yaWdodDogMTBweCBzb2xpZCB0cmFuc3BhcmVudDsKICAgICAgYm9yZGVyLWxlZnQ6IDEwcHggc29saWQgdHJhbnNwYXJlbnQ7CiAgICAgIGJvcmRlci1ib3R0b206IDEwcHggc29saWQgIzM4M2MzNjsKICAgICAgdG9wOiAtMTBweDsKICAgICAgbGVmdDogNTAlOwogICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAwKTsKICAgIH0KICAgIC5wZW5jaWxfaXRlbSB7CiAgICAgIG1hcmdpbjogMCAzcHg7CiAgICAgIGJhY2tncm91bmQ6ICNmMmYyZWU7CiAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIH0KICAgIC5hY3RpdmUgewogICAgICBiYWNrZ3JvdW5kOiAjOTk5OwogICAgfQogIH0KfQo="},{"version":3,"sources":["pencil.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"pencil.vue","sourceRoot":"src/page/menu","sourcesContent":["<template>\n  <div class=\"menu_pencil\">\n    <div v-html=\"pencil\" class=\"pencil_icon\" @click.stop=\"dealClick\"></div>\n    <div class=\"pencil_box\" v-show=\"isShow\">\n      <div\n        class=\"pencil_item\"\n        v-for=\"(d, index) in pencilSizeList\"\n        @click.stop=\"changePencilSize(d)\"\n        :key=\"index\"\n        :class=\"{ active: d === pencilSize }\"\n        :style=\"setStyle(index)\"\n      ></div>\n    </div>\n  </div>\n</template>\n<script>\nimport { fabric } from \"fabric\";\nimport icons from \"../icons.js\";\nexport default {\n  name: \"pencil\",\n  props: {\n    mode: {\n      default: \"\",\n      type: String\n    },\n    canvas: {\n      default: () => {},\n      type: Object\n    },\n    color: {\n      default: \"\",\n      type: String\n    },\n    pencilSizeList: {\n      default: () => [],\n      type: Array\n    },\n    pencilSize: {\n      default: 1,\n      type: Number\n    }\n  },\n  data() {\n    return {\n      points: [],\n      canDraw: false,\n      priviousPressure: 0,\n      beginPoint: null,\n      endPoint: null,\n      pressure: null,\n      pencil: icons.pencil,\n      isShow: false,\n      positionStarStr: \"\"\n    };\n  },\n  computed: {\n    setStyle() {\n      return function(index) {\n        return {\n          width: `${4 * (index + 2)}px`,\n          height: `${4 * (index + 2)}px`\n        };\n      };\n    }\n  },\n  methods: {\n    pathEnd() {\n      if (!this.canDraw) return;\n      let ctxCanvasPathString = this.pathToCurve(this.points);\n      ctxCanvasPathString = `${this.positionStarStr} ${ctxCanvasPathString}`;\n      this.positionStarStr = \"\";\n      this.points = [];\n      this.canDraw = false;\n      this.drawPath(ctxCanvasPathString);\n    },\n    getPos(e) {\n      let pointer = {\n        x: e.absolutePointer.x,\n        y: e.absolutePointer.y\n      };\n      return pointer;\n    },\n\n    pathStart({ x, y }) {\n      this.positionStarStr = `M ${x} ${y}`;\n    },\n    onPointup() {\n      if (!this.canDraw) return;\n      this.pathEnd();\n    },\n    onPointdown(e) {\n      this.canDraw = true;\n      let pos = this.getPos(e);\n      this.positionStarStr = `M ${pos.x} ${pos.y}`;\n    },\n    onPointmove(e) {\n      if (!this.canDraw) return;\n      let pos = this.getPos(e);\n      this.points.push({ x: pos.x, y: pos.y, command: \"L\" });\n    },\n    pathToCurve(path, controlPointsNum = 2) {\n      // M 开始 L 结束\n      let support = [\"M\", \"L\"];\n      let curve = { 2: \"Q\", 3: \"C\" };\n      let str = \"\";\n      for (let i = 0; i < path.length; i++) {\n        let { command, x, y } = path[i];\n        if (!support.includes(command)) {\n          throw new Error(`${command} is not support width start`);\n        }\n        if (i % controlPointsNum === 0) {\n          // 剩余点数不够组成曲线时使用L\n          let cmd =\n            i + controlPointsNum <= path.length ? curve[controlPointsNum] : \"L\";\n          str += ` ${cmd} ${x} ${y}`;\n        } else {\n          str += ` ${x} ${y}`;\n        }\n      }\n      return str;\n    },\n\n    drawPath(pathStr) {\n      console.log(\"this.color\", this.color, this.pencilSize);\n      let path = new fabric.Path(pathStr, {\n        fill: null,\n        // stroke: this.color,\n        stroke: \"#b92b27\",\n        strokeWidth: this.pencilSize,\n        strokeLineCap: \"round\",\n        strokeLineJoin: \"round\",\n        absolutePositioned: true,\n        pathOffset: null,\n        evented: true,\n        hasControls: true,\n        hasBorders: true,\n        selectable: true,\n        isDrawingMode: false,\n        className: \"custom_path\"\n      });\n      path.set(\"className\", \"custom_path\");\n      this.canvas.add(path);\n      this.canvas.renderAll();\n    },\n\n    unShow() {\n      this.isShow = false;\n    },\n    changePencilSize(size) {\n      this.$emit(\"changeConfig\", \"pencilSize\", size);\n      this.isShow = false;\n    },\n    dealClick() {\n      this.isShow = true;\n      this.$emit(\"click\");\n    }\n  },\n  watch: {\n    mode(newMode) {\n      if (newMode === \"pencil\") {\n        this.canvas.discardActiveObject();\n        this.pencil = icons.activePencil;\n        this.canvas.isDrawingMode = true;\n        this.canvas.freeDrawingBrush.color = this.color;\n        let container = this.canvas;\n        container.on(\"mouse:down\", this.onPointdown);\n        container.on(\"mouse:move\", this.onPointmove);\n        container.on(\"mouse:up\", this.onPointup);\n      }\n\n      if (newMode !== \"pencil\") {\n        this.canvas.isDrawingMode = false;\n        this.pencil = icons.pencil;\n        this.isShow = false;\n        let container = this.canvas;\n        container.off(\"mouse:down\", this.onPointdown);\n        container.off(\"mouse:move\", this.onPointmove);\n        container.off(\"mouse:up\", this.onPointup);\n      }\n    },\n    pencilSize(val) {\n      this.canvas.freeDrawingBrush.width = val;\n    },\n    color(val) {\n      this.canvas.freeDrawingBrush.color = val;\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n.menu_pencil {\n  position: relative;\n  .pencil_box {\n    position: absolute;\n    top: 30px;\n    display: flex;\n    left: 50%;\n    transform: translate(-50%, 0);\n    padding: 8px 6px;\n    background: #383c36;\n    align-items: center;\n    &::after {\n      content: \"\";\n      position: absolute;\n      padding: 0;\n      width: 0;\n      height: 0;\n      border-right: 10px solid transparent;\n      border-left: 10px solid transparent;\n      border-bottom: 10px solid #383c36;\n      top: -10px;\n      left: 50%;\n      transform: translate(-50%, 0);\n    }\n    .pencil_item {\n      margin: 0 3px;\n      background: #f2f2ee;\n      border-radius: 50%;\n    }\n    .active {\n      background: #999;\n    }\n  }\n}\n</style>\n"]}]}